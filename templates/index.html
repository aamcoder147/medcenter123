<!DOCTYPE html>
<!-- Defines the document type as HTML5 -->
<html lang="ar" dir="rtl"> <!-- Sets the document language to Arabic ('ar') and direction to Right-to-Left ('rtl') -->
<head>
    <!-- Head section containing metadata and links to external resources -->
    <meta charset="UTF-8">
    <!-- Declares the character encoding for the document as UTF-8, which supports Arabic characters -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Configures the viewport for responsive design, ensuring proper scaling on different devices -->
    <title>صحتنا - احجز موعد عيادتك بسلاسة</title> <!-- The title displayed in the browser tab, translated to Arabic -->
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Links to the Font Awesome library for using icons -->
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Links to Google Fonts (Lato and Open Sans). Note: Ensure these fonts support Arabic or consider adding an Arabic font like Cairo or Tajawal -->
    <!-- Alternative Arabic Font (Example - Add if needed)
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    -->

    <style>
        /* CSS styles defined within a <style> block */

        /* --- :root Variables --- */
        /* Defines CSS custom properties (variables) globally for easy theme management */
        :root {
            /* Background Colors */
            --bg-primary: #ffffff;          /* Primary background color (white) */
            --bg-secondary: #f9fafb;        /* Secondary background color (light gray) */
            --bg-accent-light: #e0f2f2;     /* Light accent background */
            --bg-accent-very-light: #f0fafa; /* Very light accent background */
            /* Border Colors */
            --border-color: #e5e7eb;        /* Standard border color */
            --border-color-strong: #d1d5db; /* Stronger border color */
            /* Text Colors */
            --text-dark: #1f2937;           /* Dark text color (for headings, primary content) */
            --text-medium: #4b5563;         /* Medium text color (for subtitles, descriptions) */
            --text-light: #ffffff;          /* Light text color (often used on dark backgrounds) */
            /* Accent Colors */
            --accent-primary: #007A7A;      /* Primary accent color (teal) */
            --accent-primary-dark: #005F5F; /* Darker primary accent color */
            --accent-primary-light: #4DB6AC;/* Lighter primary accent color */
            --accent-warm: #F2A900;         /* Warm accent color (yellow/gold for ratings) */
            --accent-warm-dark: #D99700;    /* Darker warm accent color */
            /* Status Colors */
            --success: #10b981;             /* Success status color (green) */
            --error: #ef4444;               /* Error status color (red) */
            --info: #3b82f6;                /* Informational status color (blue) */
            /* Shadow Colors */
            --shadow-color: rgba(0, 50, 50, 0.06);       /* Light shadow color */
            --shadow-color-medium: rgba(0, 50, 50, 0.1); /* Medium shadow color */
            --shadow-color-strong: rgba(0, 50, 50, 0.15);/* Strong shadow color */
            /* Transitions & Animations */
            --transition-speed: 0.3s;           /* Standard transition duration */
            --transition-ease: ease-in-out;     /* Standard transition timing function */
            --scroll-animation-duration: 0.6s;  /* Duration for scroll reveal animations */
            --stagger-delay: 0.12s;             /* Delay between staggered animations */
            --counter-animation-duration: 1500ms; /* Duration for the stats counter animation */
            --collapse-transition-speed: 0.4s;  /* Speed for collapsible section open/close animation (Updated) */
        }

        /* --- Base & Global Styles --- */
        html {
            scroll-behavior: smooth; /* Enables smooth scrolling when navigating via links */
        }
        * { /* Universal selector: Applies to all elements */
            margin: 0;                /* Resets default margin */
            padding: 0;               /* Resets default padding */
            box-sizing: border-box;   /* Includes padding and border in the element's total width and height */
        }
        body {
            background-color: var(--bg-secondary);    /* Sets the default background color for the page */
            color: var(--text-dark);                /* Sets the default text color */
            font-family: 'Open Sans', sans-serif;   /* Sets the primary font family */
            /* Consider adding an Arabic font first: font-family: 'Cairo', 'Open Sans', sans-serif; */
            line-height: 1.6;                       /* Sets the default line spacing */
            overflow-x: hidden;                     /* Prevents horizontal scrolling */
            -webkit-font-smoothing: antialiased;    /* Improves font rendering on WebKit browsers (Chrome, Safari) */
            -moz-osx-font-smoothing: grayscale;     /* Improves font rendering on Firefox (macOS) */
            padding-bottom: 80px; /* Adds space at the bottom, might be needed if footer is not sticky/fixed */
        }
        .container { /* Class for centering content */
            width: 90%;                /* Sets the width to 90% of the parent */
            max-width: 1280px;         /* Sets the maximum width */
            margin: 0 auto;            /* Centers the container horizontally */
            padding: 0 1rem;           /* Adds horizontal padding */
        }
        .section-padding { /* Utility class for standard vertical section padding */
            padding: 5rem 0;
        }
        .section-padding-sm { /* Utility class for smaller vertical section padding */
            padding: 3rem 0;
        }
        .section-title { /* Styling for main section titles */
            text-align: center;           /* Centers the text */
            margin-bottom: 3rem;          /* Space below the title */
            font-size: 2rem;              /* Font size of the title */
            font-weight: 700;             /* Font weight (bold) */
            color: var(--text-dark);      /* Text color */
            font-family: 'Lato', sans-serif; /* Specific font for titles */
            /* Consider Arabic font: font-family: 'Lato', 'Cairo', sans-serif; */
            position: relative;           /* Needed for the pseudo-element positioning */
            padding-bottom: 0.8rem;       /* Space below the text, above the underline */
        }
        .section-title::after { /* Creates the underline effect below the section title */
            content: '';                  /* Required for pseudo-elements */
            position: absolute;           /* Positions relative to the .section-title */
            bottom: 0;                    /* Positions at the bottom */
            left: 50%;                    /* Starts at the horizontal center */
            transform: translateX(-50%);  /* Centers the element precisely */
            width: 70px;                  /* Width of the underline */
            height: 4px;                  /* Height (thickness) of the underline */
            background-color: var(--accent-primary); /* Color of the underline */
            border-radius: 2px;           /* Rounds the corners of the underline */
        }
        .section-subtitle { /* Styling for section subtitles */
            text-align: center;           /* Centers the text */
            color: var(--text-medium);    /* Text color */
            max-width: 600px;             /* Limits the width for readability */
            margin: -2rem auto 3rem auto; /* Negative top margin to pull it closer to title, auto horizontal margins for centering, bottom margin for spacing */
            font-size: 1.05rem;           /* Font size */
        }

        /* --- Subtle Section Background Gradients --- */
        /* Adds slight gradient backgrounds to differentiate sections subtly */
        .featured-plcs-section, .doctors-section, .site-reviews-section { background: linear-gradient(to bottom, var(--bg-primary) 0%, #fdfdfd 100%); }
        .featured-facility-types-section { background: linear-gradient(to bottom, var(--bg-secondary) 0%, #f7f8fa 100%); }
        .how-it-works-section { background: linear-gradient(to bottom, var(--bg-primary) 0%, #fbfcfc 100%); }
        .trust-factors-section, #site-review-form-section { background: linear-gradient(to bottom, var(--bg-accent-very-light) 0%, #eafafa 100%); }

        /* --- Accessibility: Focus Styles --- */
        /* Provides clear visual indication for keyboard navigation */
        *:focus-visible { /* Styles applied when an element receives focus via keyboard */
            outline: 2px solid var(--accent-primary); /* Adds a solid outline */
            outline-offset: 2px;                      /* Adds space between the element and the outline */
            box-shadow: 0 0 0 3px rgba(0, 122, 122, 0.25); /* Adds a softer glow effect */
            border-radius: 4px;                       /* Rounds the corners of the focus indicator */
        }
        /* Override default focus styles for specific input elements */
        select:focus, input[type="text"]:focus {
            outline: none; /* Remove the default browser outline */
        }
        select:focus-visible, input[type="text"]:focus-visible { /* Apply custom focus style only for keyboard focus */
            outline: none; /* Ensure default outline is removed */
            border-color: var(--accent-primary); /* Change border color on focus */
            box-shadow: 0 0 0 3px rgba(0, 122, 122, 0.15); /* Add a subtle glow */
        }
        .btn:focus-visible, button.collapsible-header:focus-visible { /* Custom focus for buttons */
            box-shadow: 0 2px 4px var(--shadow-color), 0 0 0 3px rgba(0, 122, 122, 0.25); /* Combines existing shadow with focus glow */
        }
        .specialty-card:focus-visible, .facility-type-card:focus-visible, .plc-card:focus-visible { /* Custom focus for clickable cards */
            outline: 2px solid var(--accent-primary);
            outline-offset: 1px;
            box-shadow: 0 8px 15px var(--shadow-color-medium), 0 0 0 3px rgba(0, 122, 122, 0.15);
        }
        .doctor-card:focus-visible { /* Custom focus for doctor cards */
            outline: 2px solid var(--accent-primary);
            outline-offset: 2px;
            box-shadow: 0 8px 15px var(--shadow-color-strong), 0 0 0 3px rgba(0, 122, 122, 0.15);
        }

        /* --- Animations --- */
        /* Defines keyframe animations used throughout the site */
        @keyframes fadeInUp { /* Fades element in while moving it up */
            from { opacity: 0; transform: translateY(30px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeInLeft { /* Fades element in while moving it from left */
            from { opacity: 0; transform: translateX(35px); } /* Adjusted for RTL */
            to   { opacity: 1; transform: translateX(0); }
        }
        html[dir="ltr"] @keyframes fadeInLeft { /* Original for LTR */
             from { opacity: 0; transform: translateX(-35px); }
             to { opacity: 1; transform: translateX(0); }
        }
        @keyframes fadeInRight { /* Fades element in while moving it from right */
            from { opacity: 0; transform: translateX(-35px); } /* Adjusted for RTL */
            to   { opacity: 1; transform: translateX(0); }
        }
        html[dir="ltr"] @keyframes fadeInRight { /* Original for LTR */
            from { opacity: 0; transform: translateX(35px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes zoomIn { /* Fades element in while scaling it up */
            from { opacity: 0; transform: scale(0.85); }
            to   { opacity: 1; transform: scale(1); }
        }
        @keyframes blinkCursor { /* Simulates a blinking typing cursor */
            50% { border-color: transparent; } /* Makes the cursor border disappear mid-animation */
        }

        /* Scroll Reveal Base Class */
        .reveal-on-scroll {
            opacity: 0;                  /* Initially hidden */
            will-change: opacity, transform; /* Optimizes animation performance */
            animation-fill-mode: forwards; /* Keeps the final state of the animation */
        }
        .reveal-on-scroll.is-visible { /* Class added by JavaScript when element is in viewport */
            animation-name: fadeInUp;                 /* Default animation */
            animation-duration: var(--scroll-animation-duration); /* Animation speed */
            animation-timing-function: ease-out;      /* Animation curve */
        }
        /* Specific reveal animations */
        .reveal-left.is-visible { animation-name: fadeInLeft; }  /* Use slide-in from left */
        .reveal-right.is-visible { animation-name: fadeInRight; } /* Use slide-in from right */
        .reveal-zoom.is-visible { animation-name: zoomIn; }      /* Use zoom-in animation */

        /* --- Navbar --- */
        .navbar {
            display: flex;                     /* Enables flexbox layout */
            justify-content: space-between;   /* Pushes logo and buttons to opposite ends */
            align-items: center;               /* Vertically aligns items in the center */
            padding: 1rem 5%;                  /* Vertical and horizontal padding (percentage for responsiveness) */
            background: var(--bg-primary);     /* Background color */
            position: sticky;                  /* Makes the navbar stick to the top on scroll */
            top: 0;                            /* Sticks to the very top */
            z-index: 1000;                     /* Ensures navbar stays above other content */
            transition: box-shadow var(--transition-speed) var(--transition-ease), /* Smooth transitions for shadow, padding, and background */
                        padding var(--transition-speed) var(--transition-ease),
                        background-color var(--transition-speed) var(--transition-ease);
            border-bottom: 1px solid var(--border-color); /* Adds a subtle line below the navbar */
        }
        .navbar.scrolled { /* Styles applied when the page is scrolled */
            box-shadow: 0 4px 10px var(--shadow-color-medium); /* Adds a shadow */
            padding: 0.7rem 5%;                 /* Slightly reduces padding */
            background: rgba(255, 255, 255, 0.97); /* Makes background slightly transparent */
            backdrop-filter: blur(8px);         /* Applies a blur effect to content behind the navbar */
            border-bottom-color: transparent;   /* Hides the bottom border when shadow is visible */
        }
        .logo {
            font-size: 1.8rem;                 /* Font size */
            font-weight: 700;                  /* Font weight */
            color: var(--accent-primary);      /* Logo color */
            font-family: 'Lato', sans-serif;   /* Logo font */
            /* Consider Arabic font */
            text-decoration: none;             /* Removes underline from the link */
            display: flex;                     /* Enables flex layout for icon and text */
            align-items: center;               /* Vertically aligns icon and text */
            gap: 0.6rem;                       /* Space between icon and text */
            transition: transform var(--transition-speed) var(--transition-ease); /* Smooth scaling transition */
            margin-left: auto; /* Pushes buttons left in RTL (original was margin-right) */
        }
        html[dir="ltr"] .logo {
             margin-right: auto; /* Keeps pushing buttons right in LTR */
             margin-left: 0; /* Reset margin-left for LTR */
        }
        .logo i { /* Styles for the icon within the logo */
            font-size: 1.6rem; /* Icon size */
        }
        .logo:hover {
            transform: scale(1.03); /* Slightly enlarges the logo on hover */
        }
        .nav-login-buttons {
            display: flex;        /* Uses flex layout */
            gap: 1rem;            /* Space between buttons */
            align-items: center;  /* Vertically aligns buttons */
            margin-right: 1.5rem; /* Space from logo in RTL (original was margin-left) */
        }
         html[dir="ltr"] .nav-login-buttons {
             margin-left: 1.5rem; /* Ensure some space from logo in LTR */
             margin-right: 0; /* Reset margin-right for LTR */
        }

        /* --- Buttons --- */
        .btn { /* Base button styles */
            padding: 0.7rem 1.5rem;    /* Padding inside the button */
            border-radius: 6px;        /* Rounded corners */
            cursor: pointer;           /* Changes cursor to indicate interactivity */
            font-weight: 600;          /* Font weight */
            font-size: 0.95rem;        /* Font size */
            text-align: center;        /* Centers text inside the button */
            transition: all var(--transition-speed) var(--transition-ease); /* Smooth transitions for all properties */
            border: 1px solid transparent; /* Default transparent border */
            text-decoration: none;     /* Removes underline if button is a link */
            display: inline-flex;      /* Allows flex alignment for icon and text */
            align-items: center;       /* Vertically centers icon and text */
            justify-content: center;   /* Horizontally centers icon and text */
            gap: 0.6rem;               /* Space between icon and text */
            line-height: 1.2;          /* Line height */
            box-shadow: 0 2px 4px var(--shadow-color); /* Adds a subtle shadow */
        }
        .btn:hover { /* Styles on hover */
            transform: translateY(-2px);                /* Lifts the button slightly */
            box-shadow: 0 5px 12px var(--shadow-color-medium); /* Increases shadow intensity */
        }
        .btn:active { /* Styles when button is clicked */
            transform: translateY(0px);               /* Resets the lift effect */
            box-shadow: 0 2px 4px var(--shadow-color); /* Resets shadow to base */
        }
        .btn[disabled] { /* Styles for disabled buttons */
            cursor: not-allowed;           /* Indicates the button is inactive */
            opacity: 0.6;                  /* Reduces opacity */
            background-color: #ccc !important; /* Overrides specific background colors */
            border-color: #ccc !important;     /* Overrides specific border colors */
            box-shadow: none;              /* Removes shadow */
            pointer-events: none;          /* Disables all pointer interactions */
        }
        .btn-primary { /* Primary button style (e.g., main action) */
            background-color: var(--accent-primary); /* Primary accent color */
            color: var(--text-light);              /* Light text color */
            border-color: var(--accent-primary);   /* Border matches background */
            margin: 0;                             /* Reset margin if needed */
        }
        .btn-primary:hover:not([disabled]) { /* Hover style for enabled primary button */
            background-color: var(--accent-primary-dark); /* Darker accent color */
            border-color: var(--accent-primary-dark);     /* Darker border color */
        }
        .btn-secondary { /* Secondary button style (e.g., clear, less important actions) */
            background-color: var(--bg-primary);      /* White background */
            color: var(--text-medium);                /* Medium text color */
            border-color: var(--border-color-strong); /* Strong border color */
            box-shadow: none;                         /* No default shadow for cleaner look */
        }
        .btn-secondary:hover:not([disabled]) { /* Hover style for enabled secondary button */
            background-color: var(--bg-secondary);      /* Light gray background */
            border-color: var(--text-medium);           /* Medium border color */
            color: var(--text-dark);                    /* Darker text color */
        }
        .btn-link { /* Link-style button (looks like text) */
            background: none;                    /* No background */
            border: none;                        /* No border */
            box-shadow: none;                    /* No shadow */
            color: var(--accent-primary);        /* Accent text color */
            padding: 0;                          /* No padding */
            font-weight: 600;                    /* Standard button weight */
        }
        .btn-link:hover { /* Hover style for link button */
            color: var(--accent-primary-dark);   /* Darker text color */
            text-decoration: underline;        /* Adds underline on hover */
        }
        .btn-small { /* Smaller button variant */
            padding: 0.4rem 0.9rem;   /* Reduced padding */
            font-size: 0.85rem;       /* Smaller font size */
            gap: 0.4rem;              /* Reduced gap */
        }

        /* --- Hero Section --- */
        .hero-section {
            background: linear-gradient(135deg, var(--bg-accent-very-light) 20%, var(--bg-primary) 70%);
            padding: 6rem 5% 5rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            overflow: hidden;
        }
        /* Applying fade-in animation to hero elements with delays */
        .hero-title, .hero-subtitle, .typing-effect-container {
            opacity: 0;                               /* Start hidden */
            animation: fadeInUp 0.8s ease-out 0.2s forwards; /* Fade in up animation */
            /* `forwards` keeps the final state visible */
        }
        .hero-subtitle { animation-delay: 0.35s; } /* Subtitle fades in slightly later */
        .typing-effect-container { animation-delay: 0.5s; } /* Typing effect starts after subtitle */
        .hero-title {
            font-size: 2.8rem;                 /* Large font size for main heading */
            margin-bottom: 1rem;               /* Space below the title */
            color: var(--text-dark);           /* Dark text color */
            font-weight: 700;                  /* Bold font weight */
            font-family: 'Lato', sans-serif;   /* Specific title font */
             /* Consider Arabic font */
            line-height: 1.3;                  /* Line spacing */
        }
        .hero-title span { /* Styles the highlighted part of the title */
            color: var(--accent-primary);      /* Accent color */
        }
        .hero-subtitle {
            font-size: 1.2rem;                 /* Font size */
            color: var(--text-medium);         /* Medium text color */
            margin-bottom: 2rem;               /* Space below the subtitle */
            max-width: 700px;                  /* Max width for readability */
            margin-left: auto;                 /* Centers the subtitle */
            margin-right: auto;                /* Centers the subtitle */
        }
        .typing-effect-container { /* Container for the animated typing text */
            min-height: 32px;                   /* Ensures space is reserved even when text is short */
            margin-bottom: 3rem;                /* Space below the typing text */
            font-size: 1.2rem;                  /* Font size */
            color: var(--accent-primary-dark);  /* Dark accent color */
            font-weight: 600;                   /* Font weight */
        }
        #text { /* The span element holding the typing text */
            border-left: 3px solid var(--accent-primary); /* Cursor effect in RTL */
            padding-left: 6px;                   /* Space between text and cursor */
            border-right: none;                 /* Remove right border for RTL */
            display: inline-block;             /* Needed for border and padding */
            white-space: nowrap;               /* Prevents text from wrapping */
            overflow: hidden;                  /* Hides text until typed */
            vertical-align: bottom;            /* Aligns with baseline */
            animation: blinkCursor 0.7s infinite steps(1); /* Blinking cursor animation */
        }
        html[dir="ltr"] #text { /* Revert cursor for LTR */
            border-right: 3px solid var(--accent-primary);
            padding-right: 6px;
            border-left: none;
            padding-left: 0;
        }

        /* --- Search Area Container --- */
        .search-area-container {
            border: 1px solid var(--border-color-strong); /* Border around the container */
            border-radius: 12px;                        /* Rounded corners */
            padding: 2.5rem 2rem;                       /* Inner padding */
            margin: 3rem auto 0 auto;                   /* Top margin, centered horizontally */
            background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent white background */
            backdrop-filter: blur(4px);                 /* Blur effect behind */
            max-width: 1100px;                          /* Maximum width */
            box-shadow: 0 8px 25px rgba(0, 50, 50, 0.1);/* Shadow effect */
            display: flex;                              /* Use flex layout */
            flex-direction: column;                     /* Stack children vertically */
            gap: 1.5rem;                                /* Space between child elements (form, buttons) */
            align-items: center;                        /* Center items horizontally (buttons container) */
            opacity: 0;                                 /* Start hidden for animation */
            animation: fadeInUp 0.8s ease-out 0.65s forwards; /* Fade in animation, delayed */
        }
        .search-form { /* The form containing search inputs */
            display: grid;                              /* Use grid layout */
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Responsive grid columns */
            gap: 1.5rem;                                /* Space between grid items */
            width: 100%;                                /* Take full width of the container */
            align-items: center;                        /* Align items vertically in grid rows */
        }
        .input-group { position: relative; width: 100%; }
        .input-group i { position: absolute; left: 1rem; padding: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-medium); font-size: 1em; transition: color var(--transition-speed) var(--transition-ease); pointer-events: none; }        /* Prevents icon from interfering with input clicks */
        
         html[dir="ltr"] .input-group i { /* Revert icon position for LTR */
             left: 1rem;
             right: 2rem;
         }
        select, input[type="text"] { /* Styles for select dropdowns and text inputs */
            width: 100%;                             /* Full width */
            padding: 0.9rem 2.8rem 0.9rem 0.9rem;     /* Padding (right increased for icon in RTL) */
            border: 1px solid var(--border-color);    /* Border */
            border-radius: 8px;                       /* Rounded corners */
            background: var(--bg-primary);            /* White background */
            color: var(--text-dark);                  /* Text color */
            font-size: 1rem;                          /* Font size */
            transition: border-color var(--transition-speed) var(--transition-ease), /* Smooth transition for border and shadow */
                        box-shadow var(--transition-speed) var(--transition-ease);
            height: 48px;                             /* Fixed height for consistency */
        }
        html[dir="ltr"] select, html[dir="ltr"] input[type="text"] { /* Revert padding for LTR */
             padding: 0.9rem 0.9rem 0.9rem 2.8rem;
         }

        select { /* Specific styles for select dropdowns */
            appearance: none;                         /* Remove default browser appearance */
            /* Custom dropdown arrow using SVG background */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%234b5563' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M7.646 11.854a.5.5 0 0 0 .708 0l4-4a.5.5 0 0 0-.708-.708L8 10.793 4.354 7.146a.5.5 0 1 0-.708.708l4 4z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;             /* Prevent tiling */
            background-position: left 1rem center;    /* Position arrow on the left (for RTL) */
            background-size: 1em;                     /* Size of the arrow */
            padding-left: 3rem;                       /* Add padding on the left for the arrow */
            padding-right: 0.9rem;                    /* Reset right padding */
            cursor: pointer;                          /* Indicate it's clickable */
        }
         html[dir="ltr"] select { /* Revert arrow position and padding for LTR */
            background-position: right 1rem center;
            padding-right: 3rem;
             padding-left: 0.9rem;
         }
        .input-group:focus-within i { /* Change icon color when the input/select within the group has focus */
            color: var(--accent-primary);
        }
        .search-button-container { /* Container for search and clear buttons */
            display: flex;         /* Use flex layout */
            justify-content: center; /* Center buttons horizontally */
            flex-wrap: wrap;       /* Allow buttons to wrap on smaller screens */
            width: 100%;           /* Full width */
            margin-top: 1rem;      /* Space above the buttons */
            gap: 1rem;             /* Space between buttons */
        }
        .search-button-container .btn { /* Styles for buttons within this container */
            flex-grow: 0;           /* Don't grow to fill space */
            flex-basis: auto;       /* Base width is determined by content */
            padding: 0.8rem 1.8rem; /* Specific padding */
            font-size: 1rem;        /* Specific font size */
            min-width: 140px;       /* Minimum width */
        }
        .search-button-container .btn-secondary { /* Override default secondary button for clear */
            background-color: var(--bg-primary); /* White background */
            color: var(--text-medium);           /* Medium text color */
            border-color: var(--border-color-strong); /* Stronger border */
        }
        .search-button-container .btn-secondary:hover:not([disabled]) { /* Hover for clear */
            background-color: var(--bg-secondary); /* Light gray background */
            border-color: var(--text-medium);      /* Medium border */
            color: var(--text-dark);               /* Darker text */
        }

        /* --- Collapsible Section Styles --- */
        .collapsible-section {
            border: 1px solid var(--border-color); /* Border around the section */
            border-radius: 50px;                    /* Rounded corners */
            margin-bottom: 1.5rem;                 /* Space below the section */
            background-color: var(--bg-primary);   /* White background */
            box-shadow: 0 2px 4px var(--shadow-color); /* Subtle shadow */
            overflow: hidden;                      /* Prevents content overflow during transition */
        }
        button.collapsible-header {
            display: flex;                         /* Use flex layout */
            justify-content: space-between;        /* Push title and icon apart */
            align-items: center;                   /* Vertically align title and icon */
            width: 100%;                           /* Full width */
            padding: 1.2rem 1.5rem;                /* Padding inside the header */
            background-color: transparent;         /* No background color */
            border: none;                          /* No default button border */
            text-align: right; /* Align text to the right for RTL */
            cursor: pointer;                       /* Indicate interactivity */
            font-family: inherit;                  /* Use the body's font */
            transition: background-color var(--transition-speed) ease-in-out; /* Smooth background transition on hover */
        }
         html[dir="ltr"] button.collapsible-header {
             text-align: left; /* Revert text alignment for LTR */
         }
        /* Add bottom border ONLY when closed */
         .collapsible-section:not(.is-open) button.collapsible-header {
             border-bottom: 1px solid var(--border-color); /* Show border when section is closed */
         }
        button.collapsible-header:hover {
            background-color: var(--bg-secondary); /* Light gray background on hover */
        }
        .collapsible-title {
            font-size: 1.4rem;                 /* Font size */
            font-weight: 700;                  /* Bold */
            color: var(--text-dark);           /* Dark text color */
            font-family: 'Lato', sans-serif;   /* Specific font */
            /* Consider Arabic font */
            margin: 0;                         /* Remove default margin */
        }
        .collapsible-icon { /* The chevron icon */
            font-size: 1.1rem;                  /* Icon size */
            color: var(--text-medium);         /* Icon color */
            transition: transform var(--collapse-transition-speed) ease-in-out; /* Smooth rotation */
            margin-right: 1rem;                 /* Space to the right of the icon (for RTL) */
             margin-left: 0;
        }
        html[dir="ltr"] .collapsible-icon {
             margin-left: 1rem; /* Space to the left of the icon (for LTR) */
             margin-right: 0;
         }
        .collapsible-section.is-open .collapsible-icon { /* When section is open */
            transform: rotate(180deg);         /* Rotate icon */
            color: var(--accent-primary);      /* Change icon color */
        }
        .collapsible-content { /* Container for the content that hides/shows */
            display: grid;                     /* Use grid layout for smooth height transition */
            grid-template-rows: 0fr;           /* Start collapsed (0 fraction of the available space) */
            transition: grid-template-rows var(--collapse-transition-speed) ease-in-out, /* Animate row height */
                        padding-top var(--collapse-transition-speed) ease-in-out, /* Animate top padding */
                        padding-bottom var(--collapse-transition-speed) ease-in-out; /* Animate bottom padding */
            padding-left: 1.5rem;              /* Consistent horizontal padding */
            padding-right: 1.5rem;             /* Consistent horizontal padding */
            padding-top: 0;                    /* Start with no vertical padding */
            padding-bottom: 0;                 /* Start with no vertical padding */
            background-color: var(--bg-primary);/* Ensure background matches section */
        }
        /* Inner wrapper needed for grid transition to work correctly with nested content */
        .collapsible-content-inner {
             overflow: hidden; /* Prevents content from spilling out during transition */
        }
        .collapsible-section.is-open .collapsible-content { /* When section is open */
            grid-template-rows: 1fr;           /* Expand to 1 fraction (auto height based on content) */
            padding-top: 2rem;                 /* Add vertical padding when open */
            padding-bottom: 2rem;              /* Add vertical padding when open */
            border-top: 1px solid var(--border-color); /* Add a separator line above content */
        }

        /* --- How It Works Section --- */
        .how-it-works-grid, .how-it-works-grid-standalone { /* Grid container for steps */
            display: grid;                           /* Use grid layout */
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Responsive columns */
            gap: 2.5rem;                             /* Space between grid items */
            text-align: center;                      /* Center text within each step */
            margin-top: 4rem;                        /* Space below section title/subtitle */
        }
        .how-it-works-step { /* Individual step card */
            padding: 2rem;                           /* Padding inside the card */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth hover transitions */
            background: var(--bg-primary);           /* White background */
            border-radius: 8px;                      /* Rounded corners */
            box-shadow: 0 4px 8px var(--shadow-color); /* Subtle shadow */
            border: 1px solid var(--border-color);   /* Border */
        }
        .how-it-works-step .icon { /* Icon within the step card */
            font-size: 3rem;                        /* Large icon size */
            color: var(--accent-primary);           /* Accent color */
            margin-bottom: 1.5rem;                  /* Space below the icon */
            display: inline-block;                  /* Allows margin */
            transition: transform 0.3s ease;        /* Smooth transform transition on hover */
        }
        .how-it-works-step h3 { /* Step title */
            font-size: 1.2rem;     /* Font size */
            font-weight: 700;      /* Bold */
            margin-bottom: 0.8rem; /* Space below title */
            color: var(--text-dark); /* Dark text color */
        }
        .how-it-works-step p { /* Step description */
            color: var(--text-medium); /* Medium text color */
            font-size: 0.95rem;        /* Font size */
        }
        .how-it-works-step:hover { /* Hover effect for step card */
            transform: translateY(-10px);            /* Lift the card */
            box-shadow: 0 10px 20px var(--shadow-color-medium); /* Increase shadow */
        }
        .how-it-works-step:hover .icon { /* Hover effect for icon */
            transform: scale(1.15) rotate(8deg); /* Enlarge and rotate icon (flipped for RTL) */
            color: var(--accent-primary-dark);    /* Darker color */
        }
        html[dir="ltr"] .how-it-works-step:hover .icon {
            transform: scale(1.15) rotate(-8deg); /* Original rotation for LTR */
        }
        .how-it-works-section { /* Section-specific style */
            border-top: 1px solid var(--border-color); /* Adds separator line above */
        }

        /* --- Featured Grids --- */
        /* Common grid styles for featured items */
        .featured-specialties-grid, .featured-facility-types-grid, .featured-plcs-grid {
            display: grid;                          /* Use grid layout */
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Responsive columns */
            gap: 1.8rem;                            /* Space between items */
        }
        .clear-filter-button-container { /* Container for the "View All" button below PLC grid */
            text-align: center; /* Center the button */
            margin-top: 2.5rem; /* Space above the button */
        }

        /* --- Individual Cards (Base) --- */
        .specialty-card, .facility-type-card, .plc-card { /* Base styles for small clickable cards */
             background: var(--bg-primary);     /* White background */
             border: 1px solid var(--border-color); /* Border */
             border-radius: 8px;                /* Rounded corners */
             text-align: center;                /* Center text */
             transition: all var(--transition-speed) var(--transition-ease); /* Smooth transitions */
             box-shadow: 0 2px 5px var(--shadow-color); /* Subtle shadow */
             display: flex;                     /* Use flex layout */
             flex-direction: column;            /* Stack content vertically */
             align-items: center;               /* Center content horizontally */
             cursor: pointer;                   /* Indicate interactivity */
             justify-content: space-between;    /* Distribute space between content (e.g., push title down) */
             overflow: hidden;                  /* Hide overflow */
             position: relative;                /* Needed for potential absolute positioned children (like checkmark) */
             padding: 1rem;                     /* Base padding */
        }

        /* --- Facility Type Card Specifics (Smaller) --- */
         .facility-type-card {
             min-height: 140px;     /* Fixed minimum height, makes them uniform and shorter */
             padding: 0.8rem;       /* Slightly less padding */
         }
         .facility-type-card .icon { /* Icon in facility type card */
             font-size: 2.2rem;          /* Slightly smaller icon */
             margin-top: 0.8rem;         /* Space above icon */
             color: var(--accent-primary-light); /* Lighter accent color */
             transition: all 0.3s ease; /* Smooth transition */
             flex-grow: 1;              /* Allow icon to take up available vertical space */
             display: flex;             /* Use flex to center icon */
             align-items: center;       /* Vertically center icon within its space */
             justify-content: center;   /* Horizontally center icon */
         }
        .facility-type-card h4 { /* Title in facility type card */
             font-size: 0.95rem;        /* Slightly smaller text */
             font-weight: 600;          /* Font weight */
             color: var(--text-dark);   /* Text color */
             line-height: 1.3;          /* Line spacing */
             padding: 0 0.5rem;         /* Horizontal padding for title */
             margin-top: auto;          /* Pushes title to the bottom */
             margin-bottom: 0.5rem;     /* Space below title */
             transition: color 0.3s ease;/* Smooth color transition on hover */
        }

        /* --- PLC Card Specifics (Larger) --- */
        .plc-card { /* Clinic/Place Card */
            min-height: 240px; /* Minimum height, larger than facility type */
            padding: 0;        /* Remove base padding, handle internally */
        }
        .plc-card .icon { /* Fallback icon shown if image fails */
            font-size: 2.5rem;          /* Icon size */
            color: var(--accent-primary-light); /* Icon color */
            margin-top: 1rem;           /* Space above */
            transition: all 0.3s ease; /* Smooth transition */
            flex-grow: 1;              /* Takes available space */
            display: flex;             /* Needed for alignment */
            align-items: center;       /* Vertical center */
            justify-content: center;   /* Horizontal center */
        }
         .plc-card h4 { /* Title in PLC card */
            font-size: 1.0rem;        /* Standard font size */
            font-weight: 600;         /* Font weight */
            color: var(--text-dark);  /* Text color */
            line-height: 1.3;         /* Line spacing */
            padding: 0 1rem;          /* Horizontal padding */
            margin-top: auto;         /* Pushes title down */
            margin-bottom: 0rem;      /* Space before button container */
            transition: color 0.3s ease;/* Smooth color transition */
         }
         .plc-photo { /* Image for the PLC */
             width: 100%;                 /* Full width */
             height: 120px;               /* Fixed height */
             object-fit: cover;           /* Scales image to cover area, cropping if needed */
             display: block;              /* Treat as block element */
             border-bottom: 1px solid var(--border-color); /* Line below photo */
             margin-bottom: 0.8rem;       /* Space below photo */
             transition: transform 0.3s ease; /* Smooth scaling on hover */
         }
         /* Adjust title margin if icon is shown instead of photo */
         .plc-card .icon + h4 { margin-top: 0.8rem; }
         .plc-details-button-container { /* Container for the 'View Details' button */
             width: 100%;               /* Full width */
             margin-top: 0.8rem;        /* Space above button */
             padding: 0 1rem 1rem 1rem; /* Padding around button (bottom heavy) */
         }
         .plc-details-btn { /* The 'View Details' button itself */
             width: 100%; /* Button takes full width within its padding container */
             margin: 0 auto; /* Center if width was restricted (not needed here) */
         }

        /* --- Shared Hover/Selected Styles --- */
        .specialty-card:hover, .facility-type-card:hover, .plc-card:hover { /* Hover styles for all small cards */
            transform: translateY(-8px) scale(1.03);   /* Lift and slightly enlarge */
            border-color: var(--accent-primary);       /* Change border color */
            box-shadow: 0 8px 18px var(--shadow-color-medium); /* Increase shadow */
        }
        .specialty-card:hover h4, .facility-type-card:hover h4, .plc-card:hover h4 { /* Title color on hover */
            color: var(--accent-primary);
        }
        .specialty-card:hover .icon, .facility-type-card:hover .icon, .plc-card:hover .icon { /* Icon style on hover */
            color: var(--accent-primary);      /* Change icon color */
            transform: scale(1.18);            /* Enlarge icon */
        }
        .plc-card:hover .plc-photo { /* Image style on hover */
            transform: scale(1.05);            /* Slightly enlarge image */
        }

        /* --- Selected Card Style --- */
        /* Styles applied when a facility type or PLC card is clicked/selected */
        .facility-type-card.card-selected, .plc-card.card-selected {
            border-color: var(--accent-primary-dark); /* Darker border */
            box-shadow: 0 6px 12px var(--shadow-color-medium); /* Slightly different shadow */
            background-color: var(--bg-accent-very-light); /* Very light accent background */
            transform: translateY(-5px) scale(1.02); /* Slightly lifted/scaled */
            position: relative;                      /* Needed for the ::after checkmark */
        }
        .facility-type-card.card-selected h4, .plc-card.card-selected h4 { /* Title style when selected */
            color: var(--accent-primary-dark);     /* Darker accent color */
            font-weight: 700;                      /* Bold title */
        }
        .facility-type-card.card-selected::after, .plc-card.card-selected::after { /* Checkmark indicator */
            content: '\f00c';                       /* Font Awesome checkmark unicode */
            font-family: 'Font Awesome 6 Free';     /* Font Awesome font family */
            font-weight: 900;                       /* Font weight for solid icon */
            position: absolute;                     /* Position relative to the card */
            top: 8px;                               /* Position from top */
            left: 8px;                              /* Position from left (for RTL) */
            right: auto;                             /* Reset right */
            font-size: 0.8rem;                      /* Size of checkmark */
            color: var(--text-light);               /* White checkmark */
            background-color: var(--accent-primary);/* Accent background */
            border-radius: 50%;                     /* Circular background */
            width: 22px;                            /* Width of circle */
            height: 22px;                           /* Height of circle */
            display: flex;                          /* Use flex to center icon */
            align-items: center;                    /* Vertical center */
            justify-content: center;                /* Horizontal center */
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);  /* Small shadow for depth */
            z-index: 2;                             /* Ensure it's above other card content */
            animation: zoomIn 0.3s ease-out;        /* Animate checkmark appearance */
        }
        html[dir="ltr"] .facility-type-card.card-selected::after,
        html[dir="ltr"] .plc-card.card-selected::after { /* Revert position for LTR */
            right: 8px;
            left: auto;
        }
        .facility-type-card.card-selected:hover, .plc-card.card-selected:hover { /* Hover style while selected */
            transform: translateY(-6px) scale(1.02); /* Slightly more lift */
            box-shadow: 0 8px 18px var(--shadow-color-medium); /* Consistent hover shadow */
            border-color: var(--accent-primary-dark); /* Keep dark border */
            background-color: var(--bg-accent-very-light); /* Keep light background */
        }

        /* --- Trust Factors --- */
        .trust-factors-grid { /* Grid container for trust factors */
            display: grid;                           /* Use grid */
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Responsive columns */
            gap: 2rem;                               /* Space between items */
        }
        .trust-factor { /* Individual trust factor item */
            display: flex;                           /* Use flex for icon and text layout */
            align-items: flex-start;               /* Align items to the top */
            gap: 1.5rem;                             /* Space between icon and text content */
            padding: 1.5rem;                         /* Padding inside the item */
            background: rgba(255, 255, 255, 0.6); /* Semi-transparent white background */
            border-radius: 8px;                      /* Rounded corners */
            transition: background-color 0.3s ease;/* Smooth background transition */
            border: 1px solid transparent;         /* Transparent border initially */
        }
        .trust-factor:hover { /* Hover style */
            background: var(--bg-primary);         /* Solid white background */
            border-color: var(--border-color);     /* Show border */
        }
        .trust-factor .icon { /* Icon within trust factor */
            font-size: 2rem;                     /* Icon size */
            color: var(--accent-primary);        /* Accent color */
            flex-shrink: 0;                      /* Prevent icon from shrinking */
            margin-top: 0.1rem;                  /* Slight top margin for alignment */
        }
        .trust-factor h4 { /* Title */
            font-size: 1.15rem;   /* Font size */
            font-weight: 700;     /* Bold */
            margin-bottom: 0.4rem;/* Space below title */
        }
        .trust-factor p { /* Description */
            color: var(--text-medium); /* Medium text color */
            font-size: 0.95rem;        /* Font size */
        }

        /* --- Stats Section --- */
        .stats-section {
            background: var(--accent-primary); /* Accent background color */
            color: var(--text-light);          /* Light text color */
        }
        .stats-grid { /* Grid for statistics items */
            display: grid;                         /* Use grid */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Responsive columns */
            gap: 2rem;                             /* Space between items */
            text-align: center;                    /* Center content */
        }
        .stat-item { /* Individual stat item */
            padding: 1rem; /* Padding */
        }
        .stat-item .icon { /* Icon */
            font-size: 2.8rem;             /* Large icon */
            margin-bottom: 1rem;           /* Space below icon */
            opacity: 0.85;                 /* Slightly transparent */
            transition: transform 0.3s ease;/* Smooth hover transition */
        }
        .stat-item:hover .icon { /* Icon hover effect */
            transform: scale(1.1); /* Slightly enlarge */
        }
        .stat-item .stat-number { /* The animated number */
            font-size: 2.8rem;               /* Large font size */
            font-weight: 700;                /* Bold */
            font-family: 'Lato', sans-serif; /* Specific font */
             /* Consider Arabic font */
            margin-bottom: 0.3rem;           /* Space below number */
        }
        .stat-item .stat-label { /* The label below the number */
            font-size: 1rem;      /* Font size */
            font-weight: 600;     /* Semi-bold */
            opacity: 0.9;         /* Slightly transparent */
        }

        /* --- Site Reviews --- */
        .site-reviews-grid { /* Grid for displaying user reviews */
            display: grid;                             /* Use grid */
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Responsive columns */
            gap: 2rem;                                 /* Space between reviews */
        }
        .site-review-card { /* Individual review card */
            background: var(--bg-secondary);         /* Light gray background */
            border: 1px solid var(--border-color);   /* Standard border */
            border-right: 4px solid var(--accent-primary-light); /* Accent border on right (for RTL) */
            border-left: none;                      /* Remove left border */
            border-radius: 8px;                      /* Rounded corners */
            padding: 2rem;                           /* Padding inside */
            position: relative;                      /* For quote icon positioning */
            box-shadow: 0 4px 10px var(--shadow-color); /* Shadow */
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease; /* Smooth transitions */
            display: flex;                           /* Use flex */
            flex-direction: column;                /* Stack content vertically */
        }
         html[dir="ltr"] .site-review-card { /* Revert border for LTR */
             border-left: 4px solid var(--accent-primary-light);
             border-right: none;
         }
        .site-review-card:hover { /* Hover style */
            transform: translateY(-8px);            /* Lift card */
            box-shadow: 0 10px 22px var(--shadow-color-medium); /* Increase shadow */
            border-right-color: var(--accent-primary); /* Darker accent border (RTL) */
             /* border-left-color: var(--accent-primary); */ /* Original LTR hover */
        }
        html[dir="ltr"] .site-review-card:hover { /* Revert hover border for LTR */
             border-left-color: var(--accent-primary);
             border-right-color: var(--accent-primary-light); /* Reset right */
         }
        .site-review-card::before { /* Decorative quote icon */
            content: '\f10e';                      /* Font Awesome closing quote unicode (adjusted for RTL appearance) */
            /* Use '\f10d' (opening quote) for LTR */
            font-family: 'Font Awesome 6 Free';    /* Font Awesome font */
            font-weight: 900;                      /* Solid icon */
            font-size: 3rem;                       /* Icon size */
            color: var(--accent-primary);          /* Accent color */
            opacity: 0.1;                          /* Very transparent */
            position: absolute;                    /* Position relative to card */
            top: 0.8rem;                           /* Position from top */
            right: 1.2rem;                         /* Position from right (for RTL) */
             left: auto;
            z-index: 0;                            /* Behind other content */
        }
         html[dir="ltr"] .site-review-card::before { /* Revert position for LTR */
            content: '\f10d'; /* Opening quote */
            left: 1.2rem;
             right: auto;
         }
        .site-review-card .stars { /* Container for star rating */
            display: flex;              /* Use flex for stars */
            gap: 4px;                   /* Space between stars */
            font-size: 1.3em;           /* Size of stars */
            margin-bottom: 1.2rem;      /* Space below stars */
            justify-content: flex-start; /* Align stars to the start (right in RTL) */
            position: relative;         /* Ensure stars are above pseudo-element */
            z-index: 1;
        }
        /* Star colors */
        .site-review-card .stars .fas.fa-star,         /* Full star */
        .site-review-card .stars .fas.fa-star-half-alt { /* Half star */
            color: var(--accent-warm);                  /* Warm accent color */
        }
        .site-review-card .stars .far.fa-star {        /* Empty star */
            color: var(--border-color-strong);         /* Gray color */
        }
        .site-review-comment { /* The user's comment */
            font-style: italic;           /* Italicize */
            color: var(--text-medium);    /* Medium text color */
            margin-bottom: 1.5rem;      /* Space below comment */
            position: relative;         /* Ensure text is above quote icon */
            z-index: 1;
            flex-grow: 1;               /* Allow comment to take available space */
            font-size: 1.05rem;         /* Font size */
        }
        .site-review-author { /* Container for author info */
            display: flex;             /* Use flex */
            align-items: center;       /* Vertically align icon and name */
            gap: 1rem;                 /* Space between icon and name */
            margin-top: auto;          /* Pushes author info to the bottom */
            z-index: 1;                /* Ensure above quote icon */
            padding-top: 1rem;         /* Space above author info */
            border-top: 1px solid var(--border-color); /* Separator line */
        }
        .site-review-author i { /* Author icon */
            font-size: 1.5rem;                /* Icon size */
            color: var(--text-medium);        /* Icon color */
            width: 40px;                      /* Fixed width */
            height: 40px;                     /* Fixed height */
            display: flex;                    /* Use flex to center icon inside */
            align-items: center;              /* Vertical center */
            justify-content: center;          /* Horizontal center */
            background-color: var(--border-color); /* Background color */
            border-radius: 50%;               /* Make it circular */
            flex-shrink: 0;                   /* Prevent shrinking */
        }
        .site-review-author h5 { /* Author name */
            font-size: 1.05rem;   /* Font size */
            font-weight: 700;     /* Bold */
            margin: 0;            /* Remove default margin */
            color: var(--text-dark);/* Dark text color */
        }
        .site-review-author span { /* Hidden span (purpose unclear from original code) */
            display: none;
        }

        /* --- Review Form --- */
        #site-review-form-section .form-container { /* Container for the feedback form */
            max-width: 700px;                   /* Max width */
            margin: 0 auto;                     /* Center horizontally */
            background-color: var(--bg-primary);/* White background */
            padding: 3rem;                      /* Padding */
            border-radius: 12px;                /* Rounded corners */
            box-shadow: 0 6px 18px var(--shadow-color-medium); /* Shadow */
            border: 1px solid var(--border-color);/* Border */
        }
        #site-review-form-section h3 { /* Form title */
            text-align: center;      /* Center */
            font-size: 1.8rem;       /* Font size */
            border-bottom: none;     /* Remove potential inherited border */
            margin-bottom: 2.5rem;   /* Space below title */
            color: var(--text-dark); /* Text color */
        }
        #site-review-form-section h3::after { /* Hide underline from general .section-title style if applied */
            display: none;
        }
        #site-review-form-section .form-group { /* Grouping for label and input */
            margin-bottom: 1.8rem; /* Space between form groups */
        }
        #site-review-form-section label { /* Form labels */
            font-weight: 600;         /* Semi-bold */
            margin-bottom: 0.6rem;    /* Space below label */
            display: block;           /* Make label take its own line */
            color: var(--text-dark);  /* Text color */
        }
        #site-review-form-section input[type="text"], /* Text input */
        #site-review-form-section textarea { /* Text area */
            width: 100%;                        /* Full width */
            padding: 0.9rem 1rem;               /* Padding */
            border: 1px solid var(--border-color);/* Border */
            border-radius: 8px;                 /* Rounded corners */
            font-size: 1rem;                    /* Font size */
            background: var(--bg-primary);      /* Background color */
            color: var(--text-dark);            /* Text color */
        }
        #site-review-form-section textarea { /* Text area specific */
            min-height: 130px; /* Minimum height */
            resize: vertical;  /* Allow vertical resizing only */
        }
        #site-review-form-section .rating-input { /* Container for star rating input */
            display: flex;             /* Use flex */
            justify-content: center;   /* Center horizontally */
            align-items: center;       /* Center vertically */
            gap: 8px;                  /* Space between stars */
            margin-bottom: 1.5rem;     /* Space below rating */
            /* Row-reverse puts the 5th star first visually, matching hover logic */
            flex-direction: row-reverse;
        }
        #site-review-form-section .rating-input input[type="radio"] {
            display: none; /* Hide the actual radio buttons */
        }
        #site-review-form-section .rating-input label { /* The star labels */
            font-size: 2rem;                 /* Star size */
            color: var(--border-color-strong);/* Default gray color */
            cursor: pointer;                 /* Indicate interactivity */
            transition: color 0.2s ease, transform 0.2s ease; /* Smooth transitions */
        }
        #site-review-form-section .rating-input label:hover { /* Hover effect on individual star */
            transform: scale(1.15); /* Enlarge */
        }
        /* This complex selector handles coloring stars based on hover and selection */
        #site-review-form-section .rating-input input[type="radio"]:checked ~ label, /* Colors stars up to the checked one */
        #site-review-form-section .rating-input label:hover ~ label { /* Colors stars up to the hovered one (including the hovered one) */
            color: var(--accent-warm); /* Warm accent color */
            transform: scale(1.15);    /* Enlarge */
        }
        #site-review-form button[type="submit"] { /* Submit button */
            background-color: var(--accent-primary-dark); /* Darker accent color */
            width: 100%; /* Full width */
        }

        /* --- Doctors Grid --- */
        .doctors-grid {
            display: grid;                          /* Use grid layout */
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); /* Responsive columns */
            gap: 1.8rem;                            /* Space between doctor cards */
            align-items: stretch;                   /* Make cards in the same row stretch to equal height */
        }

        /* --- Doctor Card --- */
        .doctor-card { /* Individual doctor card */
            cursor: pointer;                        /* Indicate interactivity (though booking is via button) */
            background: var(--bg-primary);        /* White background */
            border-radius: 10px;                    /* Rounded corners */
            overflow: hidden;                       /* Prevents content spilling */
            border: 1px solid var(--border-color);  /* Border */
            display: flex;                          /* Use flex layout */
            flex-direction: column;               /* Stack sections vertically */
            padding: 1.2rem;                        /* Padding inside card */
            transition: transform var(--transition-speed) var(--transition-ease), /* Smooth transitions */
                        box-shadow var(--transition-speed) var(--transition-ease),
                        border-color var(--transition-speed) var(--transition-ease);
            box-shadow: 0 4px 10px var(--shadow-color); /* Shadow */
            height: 100%;                           /* Take full height available in grid row */
        }
        .doctor-card:hover { /* Hover style */
            transform: translateY(-6px);            /* Lift card */
            border-color: var(--accent-primary-light);/* Lighter accent border */
            box-shadow: 0 10px 20px var(--shadow-color-medium); /* Increase shadow */
        }
        .doctor-card-top { /* Top section with photo and primary info */
            display: flex;          /* Use flex layout */
            align-items: flex-start;/* Align items to the top */
            gap: 1rem;              /* Space between photo and info */
            margin-bottom: 1rem;    /* Space below top section */
            width: 100%;            /* Full width */
        }
        .doctor-photo { /* Doctor's photo */
            width: 75px;                       /* Fixed width */
            height: 75px;                      /* Fixed height */
            border-radius: 50%;                /* Circular shape */
            object-fit: cover;                 /* Cover area, crop if needed */
            display: block;                    /* Display as block */
            flex-shrink: 0;                    /* Prevent photo shrinking */
            border: 2px solid var(--border-color); /* Border around photo */
            transition: border-color var(--transition-speed) var(--transition-ease), /* Smooth transitions */
                        transform var(--transition-speed) var(--transition-ease);
        }
        .doctor-card:hover .doctor-photo { /* Photo hover style */
            border-color: var(--accent-primary); /* Accent border */
            transform: scale(1.05);            /* Slightly enlarge */
        }
        .doctor-primary-info { /* Container for name, specialization, rating */
            display: flex;              /* Use flex */
            flex-direction: column;   /* Stack vertically */
            align-items: flex-start; /* Align text to start (right in RTL) */
            flex-grow: 1;             /* Take available horizontal space */
            min-width: 0;             /* Prevent overflow issues in flex */
            line-height: 1.4;         /* Line spacing */
        }
        .doctor-primary-info h3 { /* Doctor's name */
            color: var(--text-dark);       /* Dark text color */
            margin-bottom: 0.15rem;        /* Small space below name */
            font-size: 1.15rem;            /* Font size */
            font-weight: 700;              /* Bold */
            transition: color var(--transition-speed) var(--transition-ease); /* Smooth color change */
        }
        .doctor-card:hover .doctor-primary-info h3 { /* Name hover style */
            color: var(--accent-primary-dark); /* Darker accent color */
        }
        .doctor-primary-info .specialization { /* Doctor's specialization */
            color: var(--accent-primary);    /* Accent color */
            font-weight: 600;                /* Semi-bold */
            margin-bottom: 0.5rem;           /* Space below specialization */
            font-size: 0.9rem;               /* Font size */
        }
        .doctor-primary-info .rating-display { /* Container for stars and review count */
            display: flex;         /* Use flex */
            align-items: center;   /* Vertically align */
            gap: 0.4rem;           /* Space between stars and count */
            margin-bottom: 0;      /* No space below */
            font-size: 0.85rem;    /* Font size */
        }
        .doctor-primary-info .rating-display .stars { /* Star icons */
            display: flex;     /* Use flex */
            gap: 2px;          /* Small gap between stars */
            font-size: 1em;    /* Size relative to parent (.rating-display) */
        }
        /* Star colors */
        .doctor-primary-info .rating-display .stars .fas.fa-star,
        .doctor-primary-info .rating-display .stars .fas.fa-star-half-alt {
            color: var(--accent-warm);
        }
        .doctor-primary-info .rating-display .stars .far.fa-star {
            color: var(--border-color-strong);
        }
        .doctor-primary-info .rating-display .review-count { /* Text showing number of reviews */
            color: var(--text-medium); /* Medium text color */
            font-size: 0.8rem;         /* Small font size */
        }
        .doctor-primary-info .rating-display .no-reviews { /* Text shown if no reviews */
            font-style: italic;        /* Italic */
            color: var(--text-medium); /* Medium color */
            font-size: 0.8rem;         /* Small font size */
        }
        .doctor-info { /* Bottom section containing details and book button */
            padding-top: 1rem;                      /* Space above this section */
            border-top: 1px solid var(--border-color);/* Separator line */
            width: 100%;                            /* Full width */
            display: flex;                          /* Use flex */
            flex-direction: column;               /* Stack vertically */
            flex-grow: 1;                           /* Takes remaining vertical space */
            margin-top: auto;                       /* Pushes to bottom if top content is short */
        }
        .doctor-info-columns { /* Container for the two detail columns */
            display: flex;            /* Use flex */
            width: 100%;              /* Full width */
            gap: 1rem;                /* Space between columns */
            margin-bottom: 1rem;    /* Space below columns */
            flex-grow: 1;             /* Allows columns to take space */
        }
        .doctor-info-left { /* Left column (location, clinic, facility) */
            flex: 1 1 55%;         /* Flex properties: grow, shrink, basis */
            display: flex;           /* Use flex */
            flex-direction: column;/* Stack vertically (though usually just .doctor-details) */
            min-width: 0;          /* Prevent flex overflow */
        }
        .doctor-details { /* Details paragraph */
            font-size: 0.85rem;       /* Font size */
            color: var(--text-medium);/* Text color */
            line-height: 1.5;         /* Line spacing */
            margin-bottom: 0;         /* No bottom margin */
            width: 100%;              /* Full width */
            text-align: right; /* Align text right for RTL */
        }
        html[dir="ltr"] .doctor-details {
            text-align: left; /* Revert align for LTR */
        }
        .doctor-details p { /* Each line item */
            margin-bottom: 0.4rem;   /* Space between lines */
            display: flex;           /* Use flex */
            align-items: center;     /* Vertically align icon and text */
            justify-content: flex-start; /* Align items to start (right for RTL) */
        }
        html[dir="ltr"] .doctor-details p {
             justify-content: flex-start; /* Keeps it aligned left in LTR */
         }
        .doctor-details i { /* Icons in details */
            margin-left: 0.6rem; /* Space after icon (RTL) */
             margin-right: 0;
            color: var(--accent-primary-light); /* Icon color */
            width: 1.3em;                      /* Fixed width */
            text-align: center;                /* Center icon within its width */
            transition: color var(--transition-speed) var(--transition-ease); /* Smooth color change */
            flex-shrink: 0;                    /* Prevent icon shrinking */
        }
         html[dir="ltr"] .doctor-details i { /* Revert icon margin for LTR */
             margin-right: 0.6rem;
             margin-left: 0;
         }
        .doctor-card:hover .doctor-details i { /* Icon hover color */
            color: var(--accent-primary);
        }
        /* Specific icon colors for clarity */
        .doctor-details i.fa-map-pin,
        .doctor-details i.fa-map-marker-alt,
        .doctor-details i.fa-hospital,
        .doctor-details i.fa-clinic-medical {
            color: var(--accent-primary);
        }
        .doctor-details p:last-child { /* Remove margin from last line item */
            margin-bottom: 0;
        }
        .vertical-divider { /* Divider line between columns */
            border-right: 1px solid var(--border-color); /* Border on right (RTL) */
             border-left: none;
            align-self: stretch; /* Stretch to fill column height */
            margin: 0 0.2rem;   /* Horizontal space around divider */
        }
        html[dir="ltr"] .vertical-divider { /* Revert border for LTR */
            border-left: 1px solid var(--border-color);
             border-right: none;
        }
        .doctor-info-right { /* Right column (availability) */
            flex: 1 1 40%;        /* Flex properties */
            display: flex;          /* Use flex */
            flex-direction: column; /* Stack vertically */
            min-width: 0;         /* Prevent flex overflow */
        }
        .availability-details { /* Container for availability text */
            font-size: 0.85rem;       /* Font size */
            color: var(--text-medium);/* Text color */
            margin-bottom: 0;         /* No bottom margin */
            width: 100%;              /* Full width */
            text-align: right; /* Align right for RTL */
        }
        html[dir="ltr"] .availability-details {
             text-align: left; /* Align left for LTR */
         }
        .availability-details .availability-title { /* "Availability:" title */
            display: flex;            /* Use flex */
            align-items: center;      /* Vertically align */
            gap: 0.5rem;              /* Space between icon and text */
            font-weight: 600;         /* Semi-bold */
            color: var(--text-dark);  /* Dark text color */
            margin-bottom: 0.4rem;    /* Space below title */
        }
        .availability-details .availability-title i { /* Icon in title */
            color: var(--accent-primary); /* Accent color */
            font-size: 1em;           /* Icon size */
        }
        .availability-details p { /* Each availability line */
            margin-bottom: 0.3rem;     /* Space between lines */
            padding-right: 0;          /* Reset padding if any */
             padding-left: 0;
            line-height: 1.4;          /* Line spacing */
        }
        .availability-details p:last-child { /* Remove margin from last line */
            margin-bottom: 0;
        }
        .book-btn { /* "Book Now" button */
            margin-top: auto;            /* Pushes button to the bottom */
            padding-top: 0.8rem;         /* Adds space above the button inside .doctor-info */
            width: auto;                 /* Auto width based on content */
            font-size: 0.9rem;           /* Font size */
            padding: 0.5rem 1.2rem;      /* Button padding */
            align-self: flex-start;    /* Aligns button to start (right for RTL) */
        }
        html[dir="ltr"] .book-btn {
             align-self: flex-start; /* Keeps it aligned left in LTR */
         }

        /* --- No Results Message --- */
        #noResultsMessage {
            color: var(--text-medium);    /* Text color */
            text-align: center;           /* Center content */
            padding: 6rem 1rem;           /* Vertical and horizontal padding */
            font-size: 1.15rem;           /* Font size */
            display: none;                /* Hidden by default */
        }
        #noResultsMessage i { /* Icon in the message */
            display: block;            /* Makes icon take its own line */
            font-size: 4rem;           /* Large icon size */
            margin-bottom: 1.5rem;     /* Space below icon */
            color: var(--border-color-strong); /* Icon color */
            animation: zoomIn 0.8s ease-out; /* Zoom-in animation */
        }
        #noResultsMessage p { /* Paragraph text */
            line-height: 1.6; /* Line spacing */
        }

        /* --- Footer --- */
        .footer {
            background: #1A202C;           /* Dark background */
            color: #a0aec0;                /* Light gray text color */
            padding: 5rem 5% 2rem;         /* Top, horizontal, bottom padding */
            margin-top: 0;                 /* Reset top margin */
            border-top: 5px solid var(--accent-primary); /* Accent color top border */
        }
        .footer-content { /* Container for footer sections */
            max-width: 1280px;         /* Max width */
            margin: 0 auto 4rem auto; /* Center horizontally, space below content */
            display: grid;             /* Use grid */
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); /* Responsive columns */
            gap: 3.5rem;               /* Space between footer sections */
        }
        .footer-section h3 { /* Footer section titles */
            color: var(--text-light);       /* White text color */
            margin-bottom: 1.5rem;          /* Space below title */
            font-size: 1.25rem;             /* Font size */
            font-weight: 700;               /* Bold */
            position: relative;             /* For underline positioning */
            padding-bottom: 0.7rem;         /* Space for underline */
        }
        .footer-section h3::after { /* Underline for footer titles */
            content: '';                 /* Required for pseudo-element */
            position: absolute;          /* Position relative to h3 */
            bottom: 0;                   /* Position at bottom */
            right: 0;                    /* Position at right (for RTL) */
             left: auto;
            width: 45px;                 /* Width of underline */
            height: 3px;                 /* Thickness of underline */
            background-color: var(--accent-primary); /* Accent color */
            border-radius: 1px;          /* Slightly rounded */
        }
         html[dir="ltr"] .footer-section h3::after { /* Revert position for LTR */
             left: 0;
             right: auto;
         }
        .footer-section p { /* Paragraphs in footer */
            font-size: 0.95rem;   /* Font size */
            line-height: 1.7;     /* Line spacing */
            margin-bottom: 1rem;  /* Space below paragraph */
        }
        .footer-links { /* Container for lists of links */
            display: flex;             /* Use flex */
            flex-direction: column;  /* Stack links vertically */
            gap: 0.9rem;               /* Space between links */
        }
        .footer-links a { /* Individual footer links */
            color: #cbd5e0;                /* Lighter gray color */
            text-decoration: none;         /* Remove underline */
            transition: color var(--transition-speed) var(--transition-ease), /* Smooth transitions */
                        padding-right var(--transition-speed) var(--transition-ease), /* Adjusted padding for RTL */
                        transform var(--transition-speed) var(--transition-ease);
            display: flex;                 /* Use flex for icon and text */
            align-items: center;           /* Vertically align */
            gap: 0.7rem;                   /* Space between icon and text */
        }
         html[dir="ltr"] .footer-links a {
             transition: color var(--transition-speed) var(--transition-ease),
                         padding-left var(--transition-speed) var(--transition-ease), /* Original LTR */
                         transform var(--transition-speed) var(--transition-ease);
         }
        .footer-links a i { /* Icons in footer links */
            font-size: 0.8em;         /* Small icon */
            opacity: 0.7;             /* Slightly transparent */
            transition: opacity 0.3s ease; /* Smooth opacity transition */
        }
        .footer-links a:hover { /* Link hover style */
            color: var(--text-light); /* White text */
            padding-right: 8px;       /* Indent text on hover (RTL) */
             padding-left: 0;
            transform: translateX(-2px);/* Move slightly right (RTL) */
            text-decoration: none;   /* Ensure no underline */
        }
         html[dir="ltr"] .footer-links a:hover { /* Revert LTR hover */
             padding-left: 8px;
             padding-right: 0;
             transform: translateX(2px);
         }
        .footer-links a:hover i { /* Icon hover style */
            opacity: 1; /* Make icon fully opaque */
        }
        .social-links { /* Container for social media icons */
            display: flex;     /* Use flex */
            gap: 1.3rem;       /* Space between icons */
            margin-top: 1.5rem;/* Space above icons */
        }
        .social-links a { /* Individual social media icon links */
            font-size: 1.6rem; /* Icon size */
            color: #cbd5e0;    /* Icon color */
            transition: color var(--transition-speed) var(--transition-ease), /* Smooth transitions */
                        transform var(--transition-speed) var(--transition-ease);
        }
        .social-links a:hover { /* Social icon hover style */
            color: var(--accent-primary-light); /* Lighter accent color */
            transform: translateY(-4px) rotate(5deg); /* Lift and rotate (adjust rotation for RTL if desired) */
        }
        html[dir="ltr"] .social-links a:hover {
             transform: translateY(-4px) rotate(-5deg); /* Original LTR rotation */
         }
        .copyright { /* Copyright text at the bottom */
            text-align: center;        /* Center text */
            padding-top: 2.5rem;       /* Space above copyright */
            border-top: 1px solid #4a5568; /* Separator line */
            color: #a0aec0;            /* Text color */
            font-size: 0.9rem;         /* Font size */
        }

        /* --- Flash Messages --- */
        /* Styles for temporary messages shown to the user (e.g., success, error) */
        .flash-messages {
            position: fixed;        /* Fixed position relative to viewport */
            top: 90px;              /* Position from top */
            left: 20px;             /* Position from left (RTL) */
             right: auto;
            z-index: 1050;          /* High z-index to appear above most content */
            width: clamp(300px, 90%, 420px); /* Responsive width */
        }
        html[dir="ltr"] .flash-messages { /* Revert position for LTR */
             right: 20px;
             left: auto;
        }
        .flash-message {
            padding: 1rem 1.5rem;   /* Padding */
            margin-bottom: 1rem;    /* Space between multiple messages */
            border-radius: 8px;     /* Rounded corners */
            font-weight: 600;       /* Semi-bold */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.18); /* Shadow */
            opacity: 0;             /* Start hidden */
            transform: translateX(-100%); /* Start off-screen left (RTL) */
            animation: slideInFadeOut 5s ease-in-out forwards; /* Animation */
            border: 1px solid transparent; /* Base border */
            display: flex;          /* Use flex */
            align-items: center;    /* Vertically align icon and text */
            gap: 1rem;              /* Space between icon and text */
            background-color: var(--bg-primary); /* White background */
        }
        html[dir="ltr"] .flash-message {
             transform: translateX(100%); /* Start off-screen right (LTR) */
             /* Adjust animation if needed */
        }
        .flash-message::before { /* Icon shown before the message text */
            font-family: "Font Awesome 6 Free"; /* Font Awesome font */
            font-weight: 900;                   /* Solid icon weight */
            font-size: 1.3em;                   /* Icon size */
        }
        .flash-message.success { /* Success message style */
            border-right: 6px solid var(--success); /* Accent border (RTL) */
             border-left: none;
            color: #046c4e;                         /* Text color */
        }
        html[dir="ltr"] .flash-message.success {
             border-left: 6px solid var(--success);
             border-right: none;
        }
        .flash-message.success::before {
            content: '\f058'; /* Checkmark circle icon */
            color: var(--success); /* Icon color */
        }
        .flash-message.error { /* Error message style */
            border-right: 6px solid var(--error); /* Accent border (RTL) */
            border-left: none;
            color: #9b1c1c;                        /* Text color */
        }
         html[dir="ltr"] .flash-message.error {
             border-left: 6px solid var(--error);
             border-right: none;
         }
        .flash-message.error::before {
            content: '\f071'; /* Warning triangle icon */
            color: var(--error); /* Icon color */
        }
        .flash-message.info { /* Info message style */
            border-right: 6px solid var(--info); /* Accent border (RTL) */
             border-left: none;
            color: #1e40af;                      /* Text color */
        }
        html[dir="ltr"] .flash-message.info {
            border-left: 6px solid var(--info);
            border-right: none;
        }
        .flash-message.info::before {
            content: '\f05a'; /* Info circle icon */
            color: var(--info); /* Icon color */
        }
        /* Animation for flash messages */
        @keyframes slideInFadeOut {
            0%   { opacity: 0; transform: translateX(-100%); } /* Start hidden off-left (RTL) */
            10%  { opacity: 1; transform: translateX(0); }    /* Slide in */
            90%  { opacity: 1; transform: translateX(0); }    /* Stay visible */
            100% { opacity: 0; transform: translateX(-100%); } /* Slide out left (RTL) */
        }
         html[dir="ltr"] @keyframes slideInFadeOut { /* Adjust animation for LTR */
             0% { opacity: 0; transform: translateX(100%); }
             10% { opacity: 1; transform: translateX(0); }
             90% { opacity: 1; transform: translateX(0); }
             100% { opacity: 0; transform: translateX(100%); }
         }

        /* --- Floating 'Go to Results' Button --- */
        #goToResultsBtn {
            position: fixed;          /* Fixed position */
            bottom: 25px;             /* Position from bottom */
            left: 25px;               /* Position from left (RTL) */
             right: auto;
            z-index: 999;             /* High z-index */
            background-color: var(--accent-primary-dark); /* Background color */
            color: var(--text-light); /* Text color */
            border: none;             /* No border */
            border-radius: 8px;     /* Rounded corners */
            padding: 0.7rem 1.2rem;   /* Padding */
            font-size: 0.95rem;       /* Font size */
            font-weight: 600;         /* Semi-bold */
            cursor: pointer;          /* Indicate clickability */
            box-shadow: 0 4px 12px rgba(0, 50, 50, 0.25); /* Shadow */
            display: inline-flex;     /* Use flex for icon/text */
            align-items: center;      /* Vertically align */
            gap: 0.6rem;              /* Space between icon/text */
            transition: transform var(--transition-speed) var(--transition-ease), /* Smooth transitions */
                        background-color var(--transition-speed) var(--transition-ease);
            /* Initially hidden - controlled by JS */
            display: none; /* Hide by default, JS will show it */
        }
        html[dir="ltr"] #goToResultsBtn { /* Revert position for LTR */
             right: 25px;
             left: auto;
         }
        #goToResultsBtn:hover {
            background-color: var(--accent-primary); /* Lighter background on hover */
            transform: translateY(-3px);           /* Lift button */
            box-shadow: 0 6px 15px rgba(0, 50, 50, 0.3); /* Increase shadow */
        }
        #goToResultsBtn:focus-visible { /* Custom focus style */
            outline: 2px solid var(--accent-primary); /* Outline */
            outline-offset: 3px;                       /* Space for outline */
            box-shadow: 0 4px 12px rgba(0, 50, 50, 0.25), 0 0 0 3px rgba(0, 122, 122, 0.25); /* Combine shadow and focus ring */
        }
         /* Icon needs spacing adjusted for RTL */
         #goToResultsBtn i {
            margin-left: 0; /* Original LTR gap handled by `gap` now */
             /* Ensure the icon itself is oriented correctly if needed, e.g., rotate arrow */
             transform: scaleX(-1); /* Flip the arrow horizontally for RTL */
        }
         html[dir="ltr"] #goToResultsBtn i {
            transform: scaleX(1); /* Normal orientation for LTR */
        }


        /* --- Responsive Design --- */
        /* Styles applied at different screen sizes */

        /* Medium screens (tablets, smaller desktops) */
        @media (max-width: 1024px) {
             /* Card Grid Adjustments */
             .featured-facility-types-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1.5rem; } /* Slightly smaller min width, less gap */
             .featured-plcs-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }

            .doctors-grid { gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); } /* Adjust doctor grid */
            .doctor-card { padding: 1.1rem; } /* Slightly less padding */
            .doctor-photo { width: 70px; height: 70px; } /* Smaller photo */
            .doctor-card-top { gap: 0.9rem; margin-bottom: 0.9rem;} /* Less gap/margin */
            .doctor-primary-info h3 { font-size: 1.1rem;} /* Smaller name */
            .doctor-info { padding-top: 0.9rem;} /* Less top padding */
            .doctor-info-columns { gap: 1rem; } /* Less gap between columns */
            .doctor-details { font-size: 0.83rem;} /* Smaller details text */
            .availability-details { font-size: 0.83rem; } /* Smaller availability text */
            .book-btn { font-size: 0.88rem; } /* Smaller book button text */
            .search-button-container .btn { min-width: 130px; padding: 0.8rem 1.5rem; } /* Smaller search buttons */
        }

        /* Small screens (large phones, small tablets) */
        @media (max-width: 768px) {
             /* Card Grid Adjustments */
             .featured-facility-types-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; } /* Even smaller cards */
             .featured-plcs-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
             .facility-type-card { min-height: 130px; } /* Adjust height */
             .plc-card { min-height: 220px; } /* Adjust height */
             .plc-photo { height: 110px; } /* Adjust photo height */

            .doctors-grid { grid-template-columns: 1fr; gap: 1.2rem;} /* Stack doctor cards */
            .doctor-photo { width: 65px; height: 65px; } /* Smaller photo */
            .doctor-card-top { gap: 0.8rem; margin-bottom: 0.8rem;} /* Less gap/margin */
            .doctor-primary-info h3 { font-size: 1.05rem;} /* Smaller name */
            .doctor-info { padding-top: 0.8rem; } /* Less padding */
            .doctor-info-columns { flex-direction: column; gap: 0.8rem; margin-bottom: 1rem; } /* Stack detail columns */
            .doctor-info-left, .doctor-info-right { flex-basis: auto; width: 100%; } /* Columns take full width when stacked */
            .vertical-divider { display: none; } /* Hide divider when columns stack */
             .availability-details { margin-top: 0.2rem; } /* Add small margin when stacked */
             .doctor-details { margin-bottom: 0.5rem;} /* Add bottom margin to first column when stacked */
            .book-btn { align-self: center; margin-top: 1rem; } /* Center the book button */
            .search-button-container { max-width: 400px; margin-left: auto; margin-right: auto; } /* Limit button container width */
            .search-button-container .btn { flex-grow: 1; flex-basis: 0; } /* Make search buttons fill width */
            #goToResultsBtn { font-size: 0.85rem; padding: 0.6rem 1rem; bottom: 20px; left: 20px; gap: 0.5rem; } /* Adjust floating button (RTL pos) */
            html[dir="ltr"] #goToResultsBtn { right: 20px; left: auto; } /* LTR position */
            .featured-facility-types-section .section-title { font-size: 1.8rem; } /* Adjust non-collapsible title size */
            .collapsible-title { font-size: 1.3rem; } /* Smaller collapsible title */
            .collapsible-header { padding: 1rem 1.2rem; } /* Adjust header padding */
            .collapsible-content { padding-left: 1.2rem; padding-right: 1.2rem; } /* Adjust content padding */
            .collapsible-section.is-open .collapsible-content { padding-top: 1.5rem; padding-bottom: 1.5rem; } /* Adjust open content padding */

        }

        /* Extra small screens (phones) */
        @media (max-width: 480px) {
             /* --- Navbar Responsive Adjustments --- */
             .navbar { padding: 0.8rem 5%; } /* Consistent padding */
             .navbar.scrolled { padding: 0.6rem 5%; }
             .logo { font-size: 1.5rem; gap: 0.4rem; } /* Smaller logo */
             .logo i { font-size: 1.3rem; }
             .nav-login-buttons { /* Stack login buttons */
                 flex-direction: column;  /* Stack vertically */
                 align-items: flex-start; /* Align to the left (RTL) */
                  /* align-items: flex-end; Original LTR */
                 gap: 0.6rem;              /* Space between stacked buttons */
                 margin-right: 1rem;        /* Space from logo (RTL) */
                  margin-left: 0;
             }
             html[dir="ltr"] .nav-login-buttons { /* Revert alignment/margin for LTR */
                  align-items: flex-end;
                  margin-left: 1rem;
                  margin-right: 0;
             }
             .nav-login-buttons .btn { /* Style stacked buttons */
                 width: auto;            /* Allow button to size naturally */
                 min-width: 110px;       /* Ensure minimum tappable width */
                 font-size: 0.85rem;     /* Smaller text */
                 padding: 0.5rem 1rem;   /* Adjust padding */
                 text-align: center;     /* Center text */
             }
             /* Optionally hide 'For Providers' button if space is extremely limited
             .nav-login-buttons .btn-secondary { display: none; } */

             /* Card Grid Adjustments */
             .featured-facility-types-grid { grid-template-columns: repeat(2, 1fr); gap: 0.8rem; } /* Force 2 columns */
             .featured-plcs-grid { grid-template-columns: repeat(2, 1fr); gap: 0.8rem; } /* Force 2 columns */
             .facility-type-card { min-height: 120px; padding: 0.6rem; } /* Adjust size/padding */
             .facility-type-card .icon { font-size: 1.8rem; } /* Smaller icon */
             .facility-type-card h4 { font-size: 0.85rem; } /* Smaller title */
             .plc-card { min-height: 190px; } /* Adjust size */
             .plc-photo { height: 90px; margin-bottom: 0.5rem; } /* Smaller photo */
             .plc-card h4 { font-size: 0.9rem; padding: 0 0.6rem; } /* Smaller title, less padding */
             .plc-details-button-container { padding: 0 0.6rem 0.6rem 0.6rem; margin-top: 0.5rem; } /* Adjust button container */
             .btn-small.plc-details-btn { font-size: 0.75rem; padding: 0.3rem 0.7rem; } /* Smaller details button */

             /* Doctor Card adjustments */
            .doctors-grid { gap: 1rem; } /* Less gap */
            .doctor-card { padding: 0.9rem; } /* Less padding */
            .doctor-card-top { gap: 0.7rem; margin-bottom: 0.7rem; } /* Less gap/margin */
            .doctor-photo { width: 60px; height: 60px; } /* Smaller photo */
            .doctor-primary-info h3 { font-size: 1rem; } /* Smaller name */
            .doctor-primary-info .specialization { font-size: 0.8rem; margin-bottom: 0.3rem; } /* Smaller spec text */
            .doctor-primary-info .rating-display { font-size: 0.8rem; } /* Smaller rating text */
            .doctor-info { padding-top: 0.7rem;} /* Less padding */
            .doctor-info-columns { gap: 0.6rem; } /* Less gap when stacked */
            .doctor-details { font-size: 0.8rem; } /* Smaller text */
            .availability-details { font-size: 0.8rem; } /* Smaller text */
            .book-btn { font-size: 0.85rem; padding: 0.4rem 1rem; } /* Smaller button */
            /* Search Button adjustments */
            .search-button-container { flex-direction: column; align-items: center; max-width: 300px; } /* Stack buttons */
            .search-button-container .btn { width: 100%; max-width: 300px; flex-grow: 0; } /* Make buttons full width */
            /* Collapsible adjustments */
            .collapsible-header { padding: 1rem 1.2rem;} /* Consistent padding */
            .collapsible-title { font-size: 1.2rem; } /* Smaller title */
            .collapsible-icon { font-size: 1rem;} /* Smaller icon */
            .collapsible-content { padding-left: 1.2rem; padding-right: 1.2rem; } /* Consistent padding */
            .collapsible-section.is-open .collapsible-content { padding-top: 1.5rem; padding-bottom: 1.5rem; } /* Consistent padding */
            /* Title adjustments */
            .featured-facility-types-section .section-title { font-size: 1.5rem; margin-bottom: 2rem;} /* Smaller title */
            /* Floating Button Adjustments */
             #goToResultsBtn { /* Slightly smaller floating button */
                padding: 0.5rem 0.9rem;
                font-size: 0.8rem;
                gap: 0.4rem;
                bottom: 15px;
                left: 15px; /* RTL position */
                 right: auto;
            }
            html[dir="ltr"] #goToResultsBtn { /* LTR position */
                right: 15px;
                left: auto;
             }
            #goToResultsBtn i { /* Ensure icon isn't too large and flipped correctly */
                 font-size: 1em;
                 transform: scaleX(-1); /* Flip arrow horizontally */
            }
            html[dir="ltr"] #goToResultsBtn i {
                 transform: scaleX(1); /* Reset flip for LTR */
             }
        }

    </style>
    <!-- End of CSS styles -->

</head>
<body>
    <!-- Body of the HTML document -->

    <!-- Flash Messages Container -->
    <div class="flash-messages">
        <!-- This container will hold temporary messages (success, error, info) -->
        {# Flask/Jinja specific block: Renders flashed messages passed from the backend server #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {# Check if there are any messages to display #}
            {% if messages %}
                {# Loop through each message tuple (category, message) #}
                {% for category, message in messages %}
                    {# Determine the CSS class based on the category, defaulting to 'info' #}
                    {% set category_class = category if category in ['success', 'error', 'info'] else 'info' %}
                    {# Render the message div with the appropriate class #}
                    <div class="flash-message {{ category_class }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        {# End of Flask/Jinja block #}
    </div>
    <!-- Flash Messages Container End -->

    <!-- Navbar Start -->
    <nav class="navbar" id="navbar">
        <!-- Main navigation bar -->
        <!-- Logo linking to the homepage -->
        <a href="/" class="logo">
            <i class="fas fa-heart-pulse"></i> <!-- Icon for the logo -->
            صحتنا <!-- Translated Logo text: CareConnect -->
        </a>
        <!-- Container for Login/Provider Buttons -->
        <div class="nav-login-buttons">
            <!-- Button linking to the 'For Providers' page/login -->
            <button class="btn btn-secondary btn-small" onclick="window.location.href='/doctor-login'">تسجيل الدخول للأطباء</button> <!-- Translated: For Providers -->
            <!-- Button linking to the 'Patient Login' page/login -->
            <button class="btn btn-primary btn-small" onclick="window.location.href='/patient-login'">حجوزاتي</button> <!-- Translated: Patient Login -->
        </div>
    </nav>
    <!-- Navbar End -->

    <!-- Hero Section Start -->
    <section class="hero-section" id="search-section">
        <!-- Main section at the top of the page, includes title and search -->

             <!-- Main headline, translated -->
             <h1 class="hero-title">ابحث واحجز <span>مواعيد العيادات</span>، بسهولة.</h1>
             <!-- Subtitle providing more context, translated -->
             <p class="hero-subtitle">استفد من شبكة من الأطباء والمتخصصين الموثوقين بالقرب منك. رحلتك الصحية تبدأ هنا.</p>
             <!-- Container for the animated typing effect -->
             <div class="typing-effect-container">
                <!-- The actual text that gets animated by JavaScript -->
                <span id="text"></span>
            </div>

                <!-- Container to group the search/filter components -->
                <div class="container">

                    <!-- Collapsible Section for Clinics & Centers Start -->
                    <div class="collapsible-section">
                       <!-- Button to toggle the collapsible content -->
                       <button type="button" class="collapsible-header" aria-expanded="false" aria-controls="plcs-content">
                           <!-- Title of the collapsible section, translated -->
                           <h3 class="collapsible-title">انقر لعرض اشهر المستشفيات و المستوصفات في عدن</h3>
                           <!-- Chevron icon indicating state (down = closed, up = open) -->
                           <i class="fas fa-chevron-down collapsible-icon"></i>
                       </button>
                       <!-- Content area that is hidden/shown -->
                       <div class="collapsible-content" id="plcs-content">
                            <!-- Inner wrapper essential for the grid height transition -->
                            <div class="collapsible-content-inner">
                                <!-- Title for Facility Types section inside collapsible, translated -->
                                <h2 class="section-title reveal-on-scroll" style="font-size: 1.6rem; margin-bottom: 2rem;">اختر النوع</h2>
                                <!-- Grid to display different types of facilities -->
                                <div class="featured-facility-types-grid">
                                    {# Jinja check: If facility_types list exists and is not empty #}
                                    {% if facility_types %}
                                       {# Jinja loop: Iterate over each facility type #}
                                       {% for f_type in facility_types %}
                                            {# Individual card for a facility type, applies reveal animation #}
                                            <div class="facility-type-card reveal-on-scroll"
                                                 data-facility-type="{{ f_type }}" {# Store type name in data attribute #}
                                                 onclick="setFacilityTypeFilterAndSearch('{{ f_type }}', this)" {# JS function on click #}
                                                 role="button" {# ARIA role #}
                                                 tabindex="0" {# Make it focusable #}
                                                 aria-pressed="false"> {# ARIA state for selection #}

                                                {# Jinja logic to select an icon based on the facility type name #}
                                                {% set icon_class = 'fas fa-clinic-medical' %} {# Default icon #}
                                                {# Check keywords in the type name (lowercase) to assign a specific icon #}
                                                {% if 'hospital' in f_type|lower %}{% set icon_class = 'fas fa-hospital' %}
                                                {% elif 'clinic' in f_type|lower %}{% set icon_class = 'fas fa-clinic-medical' %}
                                                {% elif 'center' in f_type|lower or 'centre' in f_type|lower or 'hub' in f_type|lower %}{% set icon_class = 'fas fa-building' %}
                                                {% elif 'post' in f_type|lower %}{% set icon_class = 'fas fa-plus-square' %}
                                                {% elif 'lab' in f_type|lower %}{% set icon_class = 'fas fa-flask-vial' %}
                                                {% endif %}
                                                <!-- Icon element with the determined class -->
                                                <i class="{{ icon_class }} icon"></i>
                                                <!-- Facility type name -->
                                                <h4>{{ f_type }}</h4>
                                            </div>
                                       {% endfor %}
                                       {# End of Jinja loop #}
                                    {% else %}
                                        <!-- Message shown if facility types couldn't be loaded -->
                                        <p class="section-subtitle" style="grid-column: 1 / -1;">تعذر تحميل أنواع المنشآت.</p> {# Translated: Could not load facility types. #}
                                    {% endif %}
                                    {# End of Jinja if block #}
                                </div>

                                <!-- Title for Featured Clinics section inside collapsible, translated -->
                                <h2 class="section-title reveal-on-scroll" style="font-size: 1.6rem; margin-top: 3rem; margin-bottom: 2rem;">اخترالمنشأة التي تريد الحجز منها</h2>
                                <!-- Grid to display featured clinics/places -->
                               <div class="featured-plcs-grid">
                                   {# Jinja check: If plcs list exists and is not empty #}
                                   {% if plcs %}
                                       {# Jinja loop: Iterate over each place/clinic name #}
                                       {% for plc in plcs %}
                                           {# Jinja variable: Create a URL-friendly 'slug' from the PLC name #}
                                           {% set plc_slug = plc | lower | replace(' ', '_') | replace('&', 'and') | replace('.', '') | replace("'", '') %}
                                           {# Individual card for a PLC, applies reveal animation #}
                                           <div class="plc-card reveal-on-scroll"
                                                data-plc-name="{{ plc }}" {# Store PLC name in data attribute #}
                                                onclick="setPlcFilterAndSearch('{{ plc }}', this)" {# JS function on click #}
                                                role="button" {# ARIA role #}
                                                tabindex="0" {# Make it focusable #}
                                                aria-pressed="false"> {# ARIA state for selection #}

                                                <!-- Image for the PLC -->
                                                <img src="{{ url_for('static', filename='plc_photos/' + plc_slug + '.jpg') }}" {# Jinja URL generator for static image #}
                                                     alt="صورة {{ plc }}" {# Alt text, translated: Photo of [PLC Name] #}
                                                     class="plc-photo"
                                                     loading="lazy" {# Lazy load image for performance #}
                                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"> {# JS fallback: hide image, show icon if image fails #}
                                                <!-- Fallback Icon (hidden by default) -->
                                                <i class="fas fa-hospital-user icon" style="display: none;"></i>
                                                <!-- PLC name -->
                                                <h4>{{ plc }}</h4>
                                                <!-- Container for the "View Details" button -->
                                                <div class="plc-details-button-container">
                                                    <!-- Link/Button to view details of the PLC -->
                                                    <a href="{{ url_for('center_details', plc_name=plc) }}" {# Jinja URL generator for PLC details page #}
                                                       class="btn btn-secondary btn-small plc-details-btn"
                                                       onclick="event.stopPropagation();"> {# Prevent click bubbling to the card's main onclick #}
                                                       <i class="fas fa-info-circle"></i> <!-- Icon -->
                                                       عرض التفاصيل <!-- Translated: View Details -->
                                                   </a>
                                                </div>
                                            </div>
                                       {% endfor %}
                                       {# End of Jinja loop #}
                                   {% else %}
                                       <!-- Message shown if PLCs couldn't be loaded -->
                                       <p class="section-subtitle" style="grid-column: 1 / -1;">تعذر تحميل العيادات.</p> {# Translated: Could not load clinics. #}
                                   {% endif %}
                                   {# End of Jinja if block #}
                               </div>
                               <!-- Button container below the PLC grid -->
                               <div class="clear-filter-button-container">
                                   <!-- Button to clear the PLC filter and show all -->
                                   <button class="btn btn-secondary" onclick="clearPlcFilterAndSearch()">عرض جميع العيادات والمراكز</button> <!-- Translated: View All Clinics & Centers -->
                               </div>
                            </div> <!-- End .collapsible-content-inner -->
                        </div> <!-- End .collapsible-content -->
                   </div> <!-- End .collapsible-section for PLCs -->

                    <!-- Doctor Search Form Area Start -->
                    <div> <!-- Wrapper div for the doctor search form -->
                        <!-- Title for the doctor search section, translated -->
                        <h2 class="section-title" style="margin-bottom: 1.5rem; font-size: 1.6rem;">ابحث عن طبيبك</h2>
                        <!-- Search form, submits via JavaScript (preventDefault) -->
                        <form class="search-form" id="searchForm" onsubmit="event.preventDefault(); searchDoctors(null, false, true);">
                            <!-- Input Group for Province Selection -->

                            <!-- Input Group for Governorate Selection -->
                            <div class="input-group">
                                <i class="fas fa-map-location-dot"></i> <!-- Icon -->
                                <select id="governorate" aria-label="اختر الولاية/المديرية"> <!-- Select dropdown, ARIA label translated -->
                                    <option value="">كل المديريات</option> <!-- Default option, translated -->
                                    {# Jinja check and loop for Governorates #}
                                    {% if governorates %}
                                        {% for gov in governorates %}
                                            <option value="{{ gov }}">{{ gov }}</option>
                                        {% endfor %}
                                    {% else %}
                                        <!-- Loading message if data isn't ready -->
                                        <option value="" disabled>جار التحميل...</option> {# Translated: Loading... #}
                                    {% endif %}
                                </select>
                            </div>
                            <!-- Input Group for Specialization Selection -->
                            <div class="input-group">
                                <i class="fas fa-stethoscope"></i> <!-- Icon -->
                                <select id="specialization" aria-label="اختر التخصص"> <!-- Select dropdown, ARIA label translated -->
                                    <option value="">كل التخصصات</option> <!-- Default option, translated -->
                                    {# Jinja check and loop for Specializations #}
                                    {% if specialties %}
                                        {% for spec in specialties %}
                                            <option value="{{ spec }}">{{ spec }}</option>
                                        {% endfor %}
                                    {% else %}
                                        <!-- Loading message -->
                                        <option value="" disabled>جار التحميل...</option> {# Translated: Loading... #}
                                    {% endif %}
                                </select>
                            </div>
                            <!-- Input Group for Facility Type Selection -->
                            <div class="input-group">
                                <i class="fas fa-hospital"></i> <!-- Icon -->
                                <select id="facilityType" aria-label="اختر نوع المنشأة"> <!-- Select dropdown, ARIA label translated -->
                                    <option value="">كل أنواع المنشآت</option> <!-- Default option, translated -->
                                    {# Jinja check and loop for Facility Types #}
                                    {% if facility_types %}
                                        {% for f_type in facility_types %}
                                            <option value="{{ f_type }}">{{ f_type }}</option>
                                        {% endfor %}
                                    {% else %}
                                        <!-- Loading message -->
                                        <option value="" disabled>جار التحميل...</option> {# Translated: Loading... #}
                                    {% endif %}
                                </select>
                            </div>
                            <!-- Input Group for Doctor/Clinic Name -->
                            <div class="input-group">
                                <i class="fas fa-user-doctor"></i> <!-- Icon -->
                                <!-- Text input for searching by name -->
                                <input type="text" id="doctorName" placeholder="اسم الطبيب، العيادة..." aria-label="اسم الطبيب أو العيادة"> <!-- Placeholder and ARIA label translated -->
                            </div>
                        </form>
                        <!-- Container for Search and Clear Buttons -->
                        <div class="search-button-container">
                            <!-- Search Button, triggers JS search function -->
                            <button type="button" class="btn btn-primary search-btn" onclick="searchDoctors(null, false, true)">
                                <i class="fas fa-search"></i> ابحث عن رعاية <!-- Translated: Find Care -->
                            </button>
                            <!-- Clear Filters Button, triggers JS clear function -->
                            <button type="button" id="clearFiltersBtn" class="btn btn-secondary" onclick="clearAllFilters()">
                                <i class="fas fa-eraser"></i> مسح الفلاتر <!-- Translated: Clear Filters -->
                            </button>
                        </div>
                    </div> <!-- End Doctor Search Form Area -->
                </div> <!-- End .container for search area -->
   </section>
    <!-- Hero Section End -->

    <!-- Featured PLCs Section Placeholder (Content moved inside collapsible) -->
    <!-- This section is now visually empty as its content was moved into the collapsible area. Kept for potential structural reasons or future use. -->
    <section class="featured-plcs-section section-padding-sm" style="padding-top: 0; padding-bottom: 0; height: 0; overflow: hidden;">
        <!-- Content moved into the collapsible section above -->
    </section>
    <!-- Featured PLCs Section End -->

    <!-- Doctors Results Section Start -->
    <section class="doctors-section section-padding" id="doctors-results">
        <!-- Section where search results (doctor cards) are displayed -->
        <div class="container">
            <!-- Title that appears above the results, initially hidden, translated -->
            <h2 class="section-title" id="resultsTitle" style="display: none;">الأطباء المتاحون</h2>
            <!-- Grid container where JavaScript will insert doctor cards -->
            <div class="doctors-grid" id="resultsContainer" aria-live="polite">
                <!-- 'aria-live="polite"' informs screen readers about updates here -->
                <!-- Doctor cards will be inserted here by JavaScript -->
            </div>
            <!-- Message shown when no doctors match the search criteria, initially hidden -->
            <div id="noResultsMessage" style="display: none;" aria-live="assertive">
                 <!-- 'aria-live="assertive"' informs screen readers immediately about this important message -->
                <i class="fas fa-user-times"></i> <!-- Icon indicating no results -->
                <!-- No results message text, translated -->
                <p>لم نتمكن من العثور على أطباء يطابقون معاييرك.<br>حاول تعديل الفلاتر أعلاه أو مسحها.</p>
            </div>
         </div>
    </section>
    <!-- Doctors Results Section End -->

    <!-- How It Works Section Start -->
    <section class="how-it-works-section section-padding">
        <!-- Section explaining the booking process -->
        <div class="container">
            <!-- Section title, translated -->
            <h2 class="section-title reveal-on-scroll">الحجز في 3 خطوات بسيطة</h2>
            <!-- Section subtitle, translated -->
            <p class="section-subtitle reveal-on-scroll">إيجاد الرعاية الصحية أصبح أسهل من أي وقت مضى.</p>
            <!-- Grid for the steps -->
            <div class="how-it-works-grid-standalone">
                 <!-- Step 1 Card -->
                 <div class="how-it-works-step reveal-on-scroll">
                    <i class="fas fa-search-location icon"></i> <!-- Icon -->
                    <h3>1. ابحث </h3> <!-- Title, translated -->
                    <p>استخدم الموقع، التخصص، نوع المنشأة، أو الاسم.</p> <!-- Description, translated -->
                </div>
                 <!-- Step 2 Card -->
                 <div class="how-it-works-step reveal-on-scroll">
                    <i class="fas fa-calendar-check icon"></i> <!-- Icon -->
                    <h3>2. اختر واحجز</h3> <!-- Title, translated -->
                    <p>شاهد المواعيد المتاحة فوراً واحجز فور.</p> <!-- Description, translated -->
                </div>
                 <!-- Step 3 Card -->
                 <div class="how-it-works-step reveal-on-scroll">
                    <i class="fas fa-notes-medical icon"></i> <!-- Icon -->
                    <h3>3. زر العيادة</h3> <!-- Title, translated -->
                    <p>احضر موعدك و شاركنا رأيك و تقييمك للطبيب لمساعدة غيرك.</p> <!-- Description, translated -->
                </div>
            </div>
        </div>
    </section>
    <!-- How It Works Section End -->

     <!-- Trust Factors Section Start -->
    <section class="trust-factors-section section-padding">
        <!-- Section highlighting reasons to use the service -->
        <div class="container">
            <!-- Section title, translated -->
            <h2 class="section-title reveal-on-scroll">لماذا تختار منصة صحتنا؟</h2>
            <!-- Grid for trust factors -->
            <div class="trust-factors-grid">
                <!-- Trust Factor 1 -->
                <div class="trust-factor reveal-on-scroll reveal-left">
                    <i class="fas fa-user-shield icon"></i> <!-- Icon -->
                    <div>
                        <h4>أطباء موثوقون</h4> <!-- Title, translated -->
                        <p> أطباء ومتخصصين مرخصين تم التحقق منهم للجودة.</p> <!-- Description, translated -->
                    </div>
                </div>
                <!-- Trust Factor 2 -->
                <div class="trust-factor reveal-on-scroll reveal-right">
                    <i class="fas fa-calendar-alt icon"></i> <!-- Icon -->
                    <div>
                        <h4>حجز سهل عبر الإنترنت</h4> <!-- Title, translated -->
                        <p>احجز المواعيد في أي وقت 24/7، بدون متاعب، من أي جهاز.</p> <!-- Description, translated -->
                    </div>
                </div>
                <!-- Trust Factor 3 -->
                <div class="trust-factor reveal-on-scroll reveal-left">
                    <i class="fas fa-clock icon"></i> <!-- Icon -->
                    <div>
                        <h4>توفر فوري</h4> <!-- Title, translated -->
                        <p>شاهد المواعيد المتاحة فورًا وقم بالتأميد على موعدك على الفور.</p> <!-- Description, translated -->
                    </div>
                </div>
                <!-- Trust Factor 4 -->
                <div class="trust-factor reveal-on-scroll reveal-right">
                    <i class="fas fa-lock icon"></i> <!-- Icon -->
                    <div>
                        <h4>آمن وخاص</h4> <!-- Title, translated -->
                        <p>معلوماتك الصحية تبقى سرية وآمنة.</p> <!-- Description, translated -->
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Trust Factors Section End -->

    <!-- Stats Section Start -->
    <section class="stats-section section-padding-sm">
        <!-- Section displaying key statistics -->
        <div class="container">
            <!-- Grid for stat items -->
            <div class="stats-grid">
                <!-- Stat Item 1: Verified Doctors -->
                <div class="stat-item reveal-on-scroll reveal-zoom">
                    <i class="fas fa-user-doctor icon"></i> <!-- Icon -->
                    <!-- Number, data-target used by JS animation -->
                    <div class="stat-number" data-target="{{ stats.doctor_count | default(0) }}">
                        {{ stats.doctor_count | default(0) }} {# Jinja: Display doctor count, default to 0 if not available #}
                    </div>
                    <div class="stat-label">أطباء موثوقون</div> <!-- Label, translated -->
                </div>
                <!-- Stat Item 2: Specialties Available -->
                <div class="stat-item reveal-on-scroll reveal-zoom">
                    <i class="fas fa-stethoscope icon"></i> <!-- Icon -->
                    <!-- Number -->
                    <div class="stat-number" data-target="{{ stats.specialty_count | default(0) }}">
                        {{ stats.specialty_count | default(0) }} {# Jinja: Display specialty count, default 0 #}
                    </div>
                    <div class="stat-label">التخصصات المتاحة</div> <!-- Label, translated -->
                </div>
                <!-- Stat Item 3: Appointments Booked -->
                <div class="stat-item reveal-on-scroll reveal-zoom">
                    <i class="fas fa-calendar-check icon"></i> <!-- Icon -->
                    <!-- Number -->
                    <div class="stat-number" data-target="{{ stats.total_bookings | default(0) }}">
                        {{ stats.total_bookings | default(0) }} {# Jinja: Display booking count, default 0 #}
                    </div>
                    <div class="stat-label">المواعيد المحجوزة</div> <!-- Label, translated -->
                </div>
                <!-- Stat Item 4: Patient Reviews -->
                <div class="stat-item reveal-on-scroll reveal-zoom">
                    <i class="fas fa-star icon"></i> <!-- Icon -->
                    <!-- Number -->
                    <div class="stat-number" data-target="{{ stats.review_count | default(0) }}">
                         4.7
                    </div>
                    <div class="stat-label">تقييمات المستخدمين</div> <!-- Label, translated -->
                </div>
            </div>
        </div>
    </section>
    <!-- Stats Section End -->

    <!-- Site Reviews Display Section Start -->
    <section class="site-reviews-section section-padding" id="site-reviews-section">
        <!-- Section to display general platform reviews -->
        <div class="container">
            <!-- Section title, translated -->
            <h2 class="section-title reveal-on-scroll">ماذا يقول الناس عنا</h2>
            <!-- Section subtitle, translated -->
            <p class="section-subtitle reveal-on-scroll">ردود الفعل العامة حول منصتنا وخدماتنا.</p>
            <!-- Grid for review cards -->
            <div class="site-reviews-grid">
                {# --- Jinja check: Is site_reviews defined and not empty? --- #}
                {% if site_reviews and site_reviews|length > 0 %}
                    {# --- Jinja loop: Iterate through each review --- #}
                    {% for review in site_reviews %}
                        <!-- Individual review card with animation -->
                        <div class="site-review-card reveal-on-scroll">
                            <!-- Star rating display -->
                            <div class="stars" title="{{ review.rating }}/5 نجوم"> {# Title attribute translated #}
                                {# --- Jinja: Accessing stars requires context processor or passing function --- #}
                                {# --- Assuming get_stars is available or replacing with direct logic --- #}
                                {# Example Direct Logic (replace if get_stars function exists and is passed): #}
                                {% set rating = review.rating | float %}
                                {% set full_stars = rating | round(0, 'floor') | int %}
                                {% set half_star = 1 if (rating - full_stars) >= 0.5 else 0 %}
                                {% set empty_stars = 5 - full_stars - half_star %}
                                {% for _ in range(full_stars) %}<i class="fas fa-star"></i>{% endfor %}
                                {% if half_star %}<i class="fas fa-star-half-alt"></i>{% endif %}
                                {% for _ in range(empty_stars) %}<i class="far fa-star"></i>{% endfor %}
                                {# --- End of Example Direct Logic --- #}
                            </div>
                            <!-- Review comment text, truncated -->
                            <p class="site-review-comment">"{{ review.comment | default('لم يتم تقديم تعليق.') | truncate(250) }}"</p> {# Default translated, original truncation kept #}
                            <!-- Author information section -->
                            <div class="site-review-author">
                                <i class="fas fa-user-check"></i> <!-- Icon -->
                                <!-- Author details -->
                                <div class="author-info">
                                    <!-- Reviewer name, defaults to 'Verified User', translated -->
                                    <h5>{{ review.reviewer_name | default('مستخدم موثق') | title }}</h5>
                                </div>
                            </div>
                        </div>
                    {% endfor %} {# End of the loop #}
                {% else %} {# If site_reviews is empty or not defined #}
                    <!-- Message shown if no reviews are available, translated -->
                    <p class="section-subtitle" style="grid-column: 1 / -1; margin-top: 2rem;">لم يتم إرسال أي ملاحظات حول المنصة حتى الآن. كن أول من يشارك أفكاره!</p>
                {% endif %} {# End of the main if block #}
            </div>
        </div>
    </section>
    <!-- Site Reviews Display Section End -->

    <!-- Site Review FORM Section Start -->
    <section class="section-padding" id="site-review-form-section">
        <!-- Section containing the form to submit platform feedback -->
        <div class="container">
            <!-- Form container with styling -->
            <div class="form-container reveal-on-scroll">
                 <!-- Form title, translated -->
                 <h3>شارك ملاحظاتك حول منصة صحتنا</h3>
                 <!-- Form definition, posts to 'submit_site_review' endpoint -->
                 <form id="site-review-form" method="POST" action="{{ url_for('submit_site_review') }}">
                    <!-- Form Group for Name -->
                    <div class="form-group">
                        <label for="siteReviewerName">اسمك:</label> <!-- Label, translated -->
                        <input type="text" id="siteReviewerName" name="reviewer_name" required placeholder="مثال: جين د."> <!-- Input, placeholder translated -->
                    </div>
                    <!-- Form Group for Rating -->
                    <div class="form-group">
                        <label>التقييم العام:</label> <!-- Label, translated -->
                        <!-- Star rating input container -->
                        <div class="rating-input">
                            <!-- Radio buttons (hidden) and labels (stars) for 5-star rating -->
                            <!-- The 'row-reverse' flex-direction and '~' selector handle the hover/check logic -->
                            <input type="radio" id="siteStar5" name="rating" value="5" required><label for="siteStar5" title="5 نجوم - ممتاز">★</label> <!-- Title translated -->
                            <input type="radio" id="siteStar4" name="rating" value="4"><label for="siteStar4" title="4 نجوم - جيد">★</label> <!-- Title translated -->
                            <input type="radio" id="siteStar3" name="rating" value="3"><label for="siteStar3" title="3 نجوم - متوسط">★</label> <!-- Title translated -->
                            <input type="radio" id="siteStar2" name="rating" value="2"><label for="siteStar2" title="2 نجوم - مقبول">★</label> <!-- Title translated -->
                            <input type="radio" id="siteStar1" name="rating" value="1"><label for="siteStar1" title="1 نجمة - ضعيف">★</label> <!-- Title translated -->
                        </div>
                    </div>
                    <!-- Form Group for Comments -->
                    <div class="form-group">
                        <label for="siteComment">تعليقاتك (اختياري):</label> <!-- Label, translated -->
                        <textarea id="siteComment" name="comment" rows="5" placeholder="أخبرنا عن تجربتك في استخدام منصة .." maxlength="1000"></textarea> <!-- Textarea, placeholder translated -->
                    </div>
                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> إرسال الملاحظات <!-- Translated: Submit Feedback -->
                    </button>
                 </form>
             </div>
         </div>
    </section>
    <!-- Site Review FORM Section End -->

    <!-- Footer Start -->
    <footer class="footer">
        <!-- Page footer section -->
        <div class="container">
            <!-- Main content area of the footer, laid out in a grid -->
            <div class="footer-content">
                <!-- Footer Section 1: About CareConnect -->
                <div class="footer-section reveal-on-scroll">
                    <h3><i class="fas fa-heart-pulse"></i>صحتنا</h3> <!-- Title, translated -->
                    <p>تبسيط الوصول إلى الرعاية الصحية. ابحث واحجز الأطباء الموثوقين بالقرب منك.</p> <!-- Description, translated -->
                    <p><i class="fas fa-phone" style="margin-left: 0.5rem;"></i> XXXXXX-1-977+</p> <!-- Phone icon adjusted margin for RTL -->
                     <p><i class="fas fa-envelope" style="margin-left: 0.5rem;"></i> support@careconnect.com</p> <!-- Email icon adjusted margin for RTL -->
                 </div>
                <!-- Footer Section 2: Quick Links -->
                <div class="footer-section reveal-on-scroll">
                    <h3>روابط سريعة</h3> <!-- Title, translated -->
                    <div class="footer-links">
                        <a href="/"><i class="fas fa-home"></i> الرئيسية</a> <!-- Link, translated -->
                        <a href="#search-section"><i class="fas fa-search"></i> البحث عن طبيب</a> <!-- Link, translated -->
                        <a href="/patient-login"><i class="fas fa-user-circle"></i> بوابة المريض</a> <!-- Link, translated -->
                        <a href="#"><i class="fas fa-question-circle"></i> الأسئلة الشائعة</a> <!-- Link, translated -->
                        <a href="#site-reviews-section"><i class="fas fa-comments"></i> الملاحظات</a> <!-- Link, translated -->
                    </div>
                </div>
                <!-- Footer Section 3: For Providers -->
                <div class="footer-section reveal-on-scroll">
                    <h3>للمزودين</h3> <!-- Title, translated -->
                    <div class="footer-links">
                        <a href="/doctor-login"><i class="fas fa-clinic-medical"></i> دخول المزود</a> <!-- Link, translated -->
                        <a href="#"><i class="fas fa-notes-medical"></i> إضافة عيادة</a> <!-- Link, translated -->
                        <a href="#"><i class="fas fa-cogs"></i> الميزات</a> <!-- Link, translated -->
                        <a href="#"><i class="fas fa-hands-helping"></i> الشراكة</a> <!-- Link, translated -->
                    </div>
                </div>
                <!-- Footer Section 4: Follow Us & Legal -->
                <div class="footer-section reveal-on-scroll">
                    <h3>تابعنا</h3> <!-- Title, translated -->
                    <p>ابق على اطلاع:</p> <!-- Text, translated -->
                    <div class="social-links">
                        <!-- Social media icon links -->
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-x-twitter"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                    <h3 style="margin-top: 1.5rem;">قانوني</h3> <!-- Title, translated -->
                    <div class="footer-links">
                        <a href="#"><i class="fas fa-user-shield"></i> سياسة الخصوصية</a> <!-- Link, translated -->
                        <a href="#"><i class="fas fa-file-contract"></i> شروط الخدمة</a> <!-- Link, translated -->
                    </div>
                </div>
            </div> <!-- End .footer-content -->
        </div> <!-- End .container for footer content -->
        <!-- Copyright notice -->

        </footer>
    <!-- Footer End -->

    <!-- Floating "Go to Results" Button -->
    <!-- This button appears (controlled by JS) after a search to easily navigate to the results -->
     <button id="goToResultsBtn" aria-label="اذهب إلى نتائج البحث" title="اذهب إلى نتائج البحث"> <!-- ARIA label and title translated -->
         <i class="fas fa-arrow-down"></i> <!-- Icon (Arrow pointing down) -->
         اذهب إلى النتائج <!-- Button text, translated -->
     </button>

    <!-- JavaScript Start -->
    <script>
        /**
         * CareConnect Frontend Script
         * Handles: Navbar scroll, Dynamic content (Doctors), Card selections, Animations, Forms, Initialization, Collapsible Sections, Floating Button, Doctor Sorting.
         */

        // --- Constants & Global Variables ---
        // Configuration values used throughout the script

        // SCROLL_THRESHOLD: Number of pixels scrolled down before the navbar changes style.
        const SCROLL_THRESHOLD = 50;
        // STAGGER_BASE_DELAY: Base delay in milliseconds between animating consecutive items (e.g., doctor cards).
        const STAGGER_BASE_DELAY = 100; // Slightly faster stagger
        // COUNTER_ANIMATION_DURATION: Duration in milliseconds for the stats counter animation. Fetched from CSS variable or defaults to 1500ms.
        const COUNTER_ANIMATION_DURATION = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--counter-animation-duration').trim() || '1500', 10);
        // DEBOUNCE_DELAY: Delay in milliseconds before triggering a search after user stops typing in the search input. Prevents excessive searches.
        const DEBOUNCE_DELAY = 400;

        // intersectionObserver: Holds the Intersection Observer instance used for triggering scroll animations. Initialized later.
        let intersectionObserver;
        // searchTimeoutId: Stores the timeout ID for the debounced search function. Allows clearing the timeout if user types again quickly.
        let searchTimeoutId = null;
        // currentSelectedFacilityType: Stores the currently selected facility type card's value. Null if none selected.
        let currentSelectedFacilityType = null;
        // currentSelectedPlcName: Stores the currently selected PLC (clinic/place) card's name. Null if none selected.
        let currentSelectedPlcName = null;
        // isInitialLoadSearch: Flag to track if the search function is being run during the initial page load (to prevent unnecessary scrolling).
        let isInitialLoadSearch = true;
        // showGoToResultsButtonTimeout: Timeout ID for showing the floating button, prevents it appearing instantly.
        let showGoToResultsButtonTimeout = null; // Added for managing button visibility delay

        // --- Backend Data ---
        // Data passed from the backend (Flask/Jinja template) to the frontend JavaScript.

        // allDoctorsData: Array containing data for all doctors. Defaulted to an empty array if nothing is passed. Needs careful handling if data might not be an array.
        const allDoctorsData = Array.isArray({{ doctors | default([]) | tojson | safe }}) ? {{ doctors | default([]) | tojson | safe }} : [];
        // allGovernorates: Array of governorate names for the filter dropdown. Empty array if none provided.
        const allGovernorates = {{ governorates | tojson | safe if governorates else '[]' }};
        // allSpecialties: Array of specialization names for the filter dropdown. Empty array if none provided.
        const allSpecialties = {{ specialties | tojson | safe if specialties else '[]' }};
        // allFacilityTypes: Array of facility type names for cards and the filter dropdown. Empty array if none provided.
        const allFacilityTypes = {{ facility_types | tojson | safe if facility_types else '[]' }};
        // allPlcs: Array of PLC (clinic/place) names for cards and potential name filtering. Empty array if none provided.
        const allPlcs = {{ plcs | tojson | safe if plcs else '[]' }};
        // pageStats: Object containing statistics for the stats counter section. Empty object if none provided.
        const pageStats = {{ stats | tojson | safe if stats else '{}' }};

        // --- DOM Element References ---
        // Getting references to frequently used HTML elements for better performance and cleaner code.

        // navbar: The main navigation bar element.
        const navbar = document.getElementById('navbar');
        // copyrightYearEl: The span element in the footer where the current year is displayed.
        const copyrightYearEl = document.getElementById('copyright-year');
        // resultsContainer: The div where doctor cards are dynamically inserted.
        const resultsContainer = document.getElementById('resultsContainer');
        // noResultsMessage: The div displayed when no search results are found.
        const noResultsMessage = document.getElementById('noResultsMessage');
        // resultsTitle: The H2 title displayed above the search results (e.g., "Found X Doctors").
        const resultsTitle = document.getElementById('resultsTitle');
        // resultsSection: The entire section containing the doctors grid and no-results message. Used for scrolling.
        const resultsSection = document.getElementById('doctors-results');
        // heroSection: The top hero section containing the search inputs. Used for scrolling back on clear.
        const heroSection = document.getElementById('search-section');
        // textElement: The span element used for the typing animation in the hero section.
        const textElement = document.getElementById("text");
        // doctorNameInput: The text input field for searching by doctor or clinic name.
        const doctorNameInput = document.getElementById('doctorName');
        // facilityTypeSelect: The dropdown select for filtering by facility type.
        const facilityTypeSelect = document.getElementById('facilityType');
        // specializationSelect: The dropdown select for filtering by specialization.
        const specializationSelect = document.getElementById('specialization');
        // governorateSelect: The dropdown select for filtering by governorate.
        const governorateSelect = document.getElementById('governorate');
        // provinceSelect: The dropdown select for filtering by province.
        const provinceSelect = document.getElementById('province');
        // searchButton: The main search button ("Find Care").
        const searchButton = document.querySelector('.search-btn');
        // clearFiltersButton: The button to clear all search filters.
        const clearFiltersButton = document.getElementById('clearFiltersBtn');
        // collapsibleHeaders: A NodeList of all elements that toggle collapsible sections.
        const collapsibleHeaders = document.querySelectorAll('.collapsible-header');
        // goToResultsBtn: The floating button to scroll down to the results section.
        const goToResultsBtn = document.getElementById('goToResultsBtn');


        // --- Navbar Scroll Effect & Copyright Year ---

        // Add 'scrolled' class to navbar when scrolling down past the threshold.
        if (navbar) { // Check if the navbar element exists
            window.addEventListener('scroll', () => { // Listen for scroll events on the window
                // Toggle the 'scrolled' class based on vertical scroll position (window.scrollY)
                navbar.classList.toggle('scrolled', window.scrollY > SCROLL_THRESHOLD);
            });
        }
        // Set the current year in the footer copyright notice.
        if (copyrightYearEl) { // Check if the copyright year element exists
            copyrightYearEl.textContent = new Date().getFullYear(); // Set its text content to the current year
        }


        // --- Collapsible Section Logic (Using Grid for Smooth Height) ---

        // Add click event listeners to all collapsible headers.
        collapsibleHeaders.forEach(header => { // Loop through each header button
            header.addEventListener('click', () => { // Add a click listener
                // Find the closest parent '.collapsible-section'
                const section = header.closest('.collapsible-section');
                if (!section) return; // Exit if the section element is not found

                // Find the icon within the header
                const icon = header.querySelector('.collapsible-icon');
                // Check if the section is currently open by looking for the 'is-open' class
                const isOpen = section.classList.contains('is-open');

                // Toggle the 'aria-expanded' attribute for accessibility
                header.setAttribute('aria-expanded', !isOpen);

                if (isOpen) {
                    // If it's open, remove the 'is-open' class to collapse it
                    section.classList.remove('is-open');
                    // Change the icon from 'up' chevron to 'down' chevron
                    if(icon) icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                } else {
                    // If it's closed, add the 'is-open' class to expand it
                    section.classList.add('is-open');
                    // Change the icon from 'down' chevron to 'up' chevron
                    if(icon) icon.classList.replace('fa-chevron-down', 'fa-chevron-up');

                    // If the scroll animation observer is active, observe newly visible elements within the opened section
                    if (intersectionObserver) {
                        const contentInner = section.querySelector('.collapsible-content-inner');
                        if (contentInner) {
                            // Find elements needing animation that are not yet visible and observe them
                            contentInner.querySelectorAll('.reveal-on-scroll:not(.is-visible)').forEach(el => intersectionObserver.observe(el));
                        }
                    }
                }
            });
        });


        // --- Floating "Go to Results" Button Logic ---

        // Add click listener to the "Go to Results" button.
        if (goToResultsBtn) { // Check if the button exists
            goToResultsBtn.addEventListener('click', () => { // Add click listener
                if (resultsSection) { // Check if the results section element exists
                    // Scroll the results section into view smoothly
                    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            // Function to show/hide the floating button based on whether results are visible
            function toggleGoToResultsButtonVisibility() {
                 if (!resultsSection || !goToResultsBtn) return; // Exit if elements don't exist

                 // Check if the results section is somewhat visible in the viewport
                 const resultsRect = resultsSection.getBoundingClientRect();
                 // Show button if the *top* of the results section is above the viewport bottom (or fully scrolled past)
                 // AND the *bottom* of the results section is below the viewport top (or partially visible)
                 const shouldBeVisible = resultsRect.top < window.innerHeight && resultsRect.bottom > 0;

                 // Additionally, ensure search wasn't the initial page load AND there are results (grid is displayed)
                 const hasResults = resultsContainer && resultsContainer.style.display === 'grid';

                 // Use timeout to avoid button flashing on load/rapid scrolls
                 clearTimeout(showGoToResultsButtonTimeout);

                 if (shouldBeVisible && hasResults && !isInitialLoadSearch) {
                      // Debounce showing the button slightly
                      showGoToResultsButtonTimeout = setTimeout(() => {
                           goToResultsBtn.style.display = 'inline-flex'; // Show the button
                       }, 200); // Small delay
                  } else {
                      goToResultsBtn.style.display = 'none'; // Hide the button
                  }
            }

            // Check visibility on scroll and potentially resize
            window.addEventListener('scroll', toggleGoToResultsButtonVisibility);
            window.addEventListener('resize', toggleGoToResultsButtonVisibility);
            // Initial check might be needed if results are visible on load without scroll
             // setTimeout(toggleGoToResultsButtonVisibility, 500); // Run after potential initial search/display
        }


        // --- Debounced Search Function ---
        // This function delays the execution of `searchDoctors` until the user stops typing for DEBOUNCE_DELAY milliseconds.
        function searchDoctorsDebounced() {
            clearTimeout(searchTimeoutId); // Clear any previous pending search timeout
            // Set a new timeout to call searchDoctors after the delay
            searchTimeoutId = setTimeout(() => {
                // Call searchDoctors without scroll, as this is typically triggered by input changes
                searchDoctors(null, false, false);
            }, DEBOUNCE_DELAY);
        }


        // --- Doctor Search/Filter ---
        // Main function to filter and display doctors based on selected criteria.
        // event: The event object (optional, used if triggered by input changes).
        // isInitial: Boolean flag indicating if this is the initial page load search.
        // triggerScroll: Boolean flag indicating if the page should scroll to the results after searching.
        function searchDoctors(event = null, isInitial = false, triggerScroll = false) {
            // Debug log
            // console.log("Attempting search...");

             // --- Pre-computation Checks ---
             // Check if doctor data is loaded and valid before proceeding.
             if (!allDoctorsData) { // Check if the data variable exists
                 console.error("Doctor data is not available yet.");
                 return; // Stop execution if data is missing
             }
             if (!Array.isArray(allDoctorsData)) { // Ensure the data is actually an array
                console.error("Doctor data is not an array:", allDoctorsData);
                return; // Stop execution if data is not an array
             }

             // Prevent multiple rapid clicks on the search button.
             // Check if the button exists and is currently disabled, and if this is not the initial load.
             if ((searchButton && searchButton.disabled) && !isInitial) return;

             // --- UI Updates (Start) ---
             // Disable search and clear buttons immediately to prevent multiple clicks during processing.
             // Update search button text/icon to indicate searching.
             if (searchButton) { // Check if the button exists
                searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جار البحث...'; // Change text/icon (Translated: Searching...)
                searchButton.disabled = true; // Disable the button
             }
             if (clearFiltersButton) clearFiltersButton.disabled = true; // Disable the clear button

             // --- State Update ---
             isInitialLoadSearch = isInitial; // Update the global flag

             // --- Get Filter Values ---
             // Retrieve current values from all filter inputs/selects. Use default empty strings if element doesn't exist.
             const province = provinceSelect?.value || '';
             const governorate = governorateSelect?.value || '';
             const specialization = specializationSelect?.value || '';
             const facilityType = facilityTypeSelect?.value || '';
             const nameQuery = doctorNameInput?.value.toLowerCase().trim() || ''; // Get name query, convert to lowercase, remove whitespace

            // Debug log
             // console.log(`Searching with (initial=${isInitial}, scroll=${triggerScroll}):`, { province, governorate, specialization, facilityType, nameQuery });

             // --- Asynchronous Processing ---
             // Use requestAnimationFrame to ensure the UI updates (button disabling) are rendered before the potentially blocking filter logic runs.
             requestAnimationFrame(() => {
                 let filteredDoctors = []; // Initialize array to hold filtered results
                 try {
                     // --- Filtering Logic ---
                     // Filter the main `allDoctorsData` array.
                     filteredDoctors = allDoctorsData.filter(doctor => {
                         // Basic check for invalid doctor objects within the array.
                         if (!doctor) return false; // Skip if doctor is null or undefined

                         // Safely access doctor properties using optional chaining (?.) and provide default empty strings ('') for comparison.
                         const dProvince = doctor.province || '';      // Doctor's province
                         const dGov = doctor.governorate || '';        // Doctor's governorate
                         const dSpec = doctor.specialization || '';   // Doctor's specialization
                         const dFac = doctor.facility_type || '';     // Doctor's facility type
                         const dName = (doctor.name || '').toLowerCase(); // Doctor's name (lowercase)
                         const dClinic = (doctor.plc || '').toLowerCase(); // Doctor's clinic name (lowercase)

                         // --- Match Conditions ---
                         // Check if each filter criterion matches the doctor's data.
                         // An empty filter value means that filter is not applied (match is true).
                         const provMatch = !province || dProvince === province;                 // Province matches if filter is empty or equal
                         const govMatch = !governorate || dGov === governorate;                 // Governorate matches if filter is empty or equal
                         const specMatch = !specialization || dSpec === specialization;           // Specialization matches if filter is empty or equal
                         const facMatch = !facilityType || dFac === facilityType;               // Facility type matches if filter is empty or equal
                         // Name query matches if it's empty OR if it's included in the doctor's name OR the clinic's name.
                         const nameMatch = !nameQuery || dName.includes(nameQuery) || dClinic.includes(nameQuery);

                         // Return true only if ALL conditions are met.
                         return provMatch && govMatch && specMatch && facMatch && nameMatch;
                     });

                     // Debug log
                      // console.log("Found doctors after filter:", filteredDoctors.length);

                     // --- Display Results ---
                     // Call the function to render the filtered doctors to the page.
                     displayResults(filteredDoctors);

                 } catch (error) { // Catch any errors during filtering or display
                     console.error("Error during doctor filtering or display:", error);
                     // Optionally display an error message to the user in the results area.
                     if(resultsContainer) resultsContainer.innerHTML = '<p style="color: var(--error); text-align: center; padding: 2rem;">حدث خطأ أثناء البحث. يرجى المحاولة مرة أخرى.</p>'; // Error message translated
                     // Hide the 'no results' message and title in case of an error.
                     if(noResultsMessage) noResultsMessage.style.display = 'none';
                     if(resultsTitle) resultsTitle.style.display = 'none';
                 } finally { // Code that runs regardless of whether an error occurred or not
                     // --- UI Updates (End) ---
                     // Re-enable the search and clear buttons now that processing is complete.
                     // console.log("Re-enabling buttons..."); // Debug log
                     if (searchButton) { // Check if button exists
                        searchButton.innerHTML = '<i class="fas fa-search"></i> ابحث عن رعاية'; // Restore original text/icon (Translated: Find Care)
                        searchButton.disabled = false; // Re-enable button
                     }
                     if (clearFiltersButton) clearFiltersButton.disabled = false; // Re-enable clear button

                     // --- Conditional Scroll to Results ---
                     // Scroll only if `triggerScroll` is true and it wasn't the initial page load.
                     if (!isInitialLoadSearch && triggerScroll) {
                         // console.log("Scroll check: Triggered and not initial load."); // Debug log
                         if (filteredDoctors.length > 0 && resultsSection) {
                              // console.log("Scrolling to results triggered..."); // Debug log
                             // If results were found, scroll smoothly to the start of the results section after a short delay.
                             setTimeout(() => {
                                resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' });
                             }, 150); // Delay allows rendering before scroll starts
                         } else if (filteredDoctors.length === 0 && noResultsMessage) {
                              // console.log("Scrolling to 'No Results' triggered..."); // Debug log
                             // If no results were found, scroll smoothly to the "No Results" message.
                             setTimeout(() => {
                                noResultsMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                             }, 150); // Delay
                         }
                     }

                     // After a search completes (either initial or user-triggered), check if the Go To Results button should be shown/hidden
                      setTimeout(toggleGoToResultsButtonVisibility, 300); // Delay to ensure DOM is updated
                 }
                 // --- State Update ---
                 // Mark subsequent searches as not initial load searches after the first one finishes.
                 isInitialLoadSearch = false;
            }); // End of requestAnimationFrame
        }


        // --- Clear All Search Filters ---
        // Resets all search inputs and re-runs the search to show all doctors.
        function clearAllFilters() {
            // console.log("Clearing all search filters."); // Debug log

            // Reset dropdowns and text input to their default state.
            if (provinceSelect) provinceSelect.value = '';         // Reset province dropdown
            if (governorateSelect) governorateSelect.value = '';   // Reset governorate dropdown
            if (specializationSelect) specializationSelect.value = ''; // Reset specialization dropdown
            if (facilityTypeSelect) facilityTypeSelect.value = '';   // Reset facility type dropdown
            if (doctorNameInput) doctorNameInput.value = '';         // Clear name input field

            // Reset state variables for card selections.
            currentSelectedFacilityType = null;
            currentSelectedPlcName = null;

            // Visually deselect any selected facility type or PLC cards.
            updateCardSelection(null, 'facility-type-card'); // Deselect facility type cards
            updateCardSelection(null, 'plc-card');          // Deselect PLC cards

            // Reset the visibility filter on PLC cards (show all).
            filterPlcCardsByFacilityType(null);

            // Trigger a new search to display all doctors, WITHOUT scrolling.
            searchDoctors(null, false, false);

            // Scroll the view back up to the search area gently.
            const searchArea = document.getElementById('search-section'); // Get the hero/search section
            if(searchArea) { // Check if it exists
                // Use a small timeout to ensure search finishes before scrolling
                setTimeout(() => {
                     searchArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 50);
            }
             // Hide the 'Go To Results' button immediately when filters are cleared
             if(goToResultsBtn) goToResultsBtn.style.display = 'none';
        }


        // --- Star Rating HTML Generator ---
        // Generates HTML string for star rating display based on a numeric rating.
        // rating: The average rating number (e.g., 4.5, 3.0).
        function getStarsHTML(rating) {
             // console.log("getStarsHTML called with rating:", rating, typeof rating); // Debug log

             // --- Input Validation ---
             // Check if the rating is valid (a number between 0 and 5).
             if (rating === null || typeof rating !== 'number' || isNaN(rating) || rating < 0 || rating > 5) {
                 // console.log("Invalid rating, returning default stars."); // Debug log
                 // Return default HTML for 5 empty stars if rating is invalid.
                 return '<span class="stars" title="لا يوجد تقييم بعد"><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i></span>'; // Title translated
             }

             // --- Star Calculation ---
             // Clamp the rating to be within the 0-5 range.
             const safeRating = Math.max(0, Math.min(5, rating));
             // Calculate the number of full stars.
             const full = Math.floor(safeRating);
             // Determine if a half star is needed (threshold of 0.4).
             const half = (safeRating - full) >= 0.4 ? 1 : 0;
             // Calculate the number of empty stars needed to reach 5 total.
             const empty = 5 - full - half;

             // --- HTML Generation ---
             // Start the HTML string with a span container and a title attribute for accessibility.
             let html = `<span class="stars" title="${safeRating.toFixed(1)}/5 نجوم">`; // Title translated
             // Add full star icons.
             html += '<i class="fas fa-star"></i>'.repeat(full);
             // Add a half star icon if needed.
             html += half ? '<i class="fas fa-star-half-alt"></i>' : '';
             // Add empty star icons.
             html += '<i class="far fa-star"></i>'.repeat(empty);
             // Close the span container.
             html += '</span>';

             // console.log("Generated stars HTML:", html); // Debug log
             // Return the complete HTML string.
             return html;
        }


        // --- Display Search Results ---
        // Renders the filtered list of doctors onto the page.
        // doctors: An array of doctor objects to display.
        function displayResults(doctors) {
            // console.log("Starting displayResults with doctors:", doctors); // Debug log

            // --- Element Existence Check ---
            // Ensure necessary DOM elements for display are available.
            if (!resultsContainer || !noResultsMessage || !resultsTitle) {
                console.error("Missing display elements for results (resultsContainer, noResultsMessage, or resultsTitle).");
                return; // Exit if elements are missing
            }

            // --- Clear Previous Results ---
            resultsContainer.innerHTML = '';    // Remove any existing doctor cards
            resultsContainer.style.opacity = '0'; // Set opacity to 0 to prepare for fade-in animation

            // --- Sorting ---
             // Create a mutable copy and sort doctors by average rating (descending: higher rated first).
             // Handle cases where rating might be null, undefined, or NaN by treating them as the lowest (-1).
             const sortedDoctors = [...doctors].sort((a, b) => {
                 // Get rating for doctor A, default to -1 if invalid/missing
                 const ratingA = (a?.average_rating === null || a?.average_rating === undefined || isNaN(a.average_rating)) ? -1 : a.average_rating;
                 // Get rating for doctor B, default to -1 if invalid/missing
                 const ratingB = (b?.average_rating === null || b?.average_rating === undefined || isNaN(b.average_rating)) ? -1 : b.average_rating;
                 // Sort descending: return positive if B > A, negative if A > B, zero if equal
                 return ratingB - ratingA;
            });
            // console.log("Sorted doctors:", sortedDoctors); // Debug log

            // --- Display Logic ---
            if (sortedDoctors.length === 0) {
                 // --- No Results ---
                 // console.log("Displaying 'No Results' message."); // Debug log
                noResultsMessage.style.display = 'block'; // Show the "No Results" message
                resultsContainer.style.display = 'none'; // Hide the (empty) grid container
                resultsTitle.style.display = 'none';    // Hide the results title
                // Hide the floating button if no results
                 if(goToResultsBtn) goToResultsBtn.style.display = 'none';
            } else {
                 // --- Results Found ---
                 // console.log(`Displaying ${sortedDoctors.length} doctor cards.`); // Debug log
                noResultsMessage.style.display = 'none'; // Hide the "No Results" message
                resultsContainer.style.display = 'grid'; // Ensure the grid container is visible
                resultsTitle.style.display = 'block';  // Show the results title
                // Set the results title text dynamically (pluralized, translated).
                 resultsTitle.textContent = `تم العثور على ${sortedDoctors.length} ${sortedDoctors.length !== 1 ? 'أطباء' : 'طبيب'}`; // Found X Doctor(s)

                 // --- Loop and Create Cards ---
                 // Iterate through the sorted list of doctors.
                sortedDoctors.forEach((doctor, index) => {
                    // Skip if doctor object is invalid or lacks an ID.
                    if (!doctor || !doctor.id) {
                         // console.warn("Skipping invalid doctor object:", doctor); // Debug log
                        return; // Continue to the next iteration
                    }

                    // Create a new div element for the doctor card.
                    const card = document.createElement('div');
                    // Add CSS classes for styling and scroll animation.
                    card.className = 'doctor-card reveal-on-scroll';
                    // Apply a staggered animation delay based on the doctor's index in the list.
                    card.style.animationDelay = `${index * STAGGER_BASE_DELAY}ms`;

                    // --- Safely Access Doctor Properties ---
                    // Use optional chaining (?.) and default values ('', null) for robustness.
                    const photoUrl = doctor.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(doctor.name || 'Doctor')}&background=e0f2f2&color=005f5f&size=150`; // Photo URL or fallback avatar
                    const name = doctor.name || 'اسم الطبيب غير متوفر'; // Name or default (translated)
                    const spec = doctor.specialization || 'ممارسة عامة'; // Specialization or default (translated)
                    const ratingValue = doctor.average_rating;          // Rating value (might be number, null, undefined)
                    const reviewCount = doctor.review_count || 0;       // Review count, default to 0
                    const prov = doctor.province || '';                 // Province
                    const gov = doctor.governorate || '';              // Governorate
                    const facType = doctor.facility_type || 'غير متوفر'; // Facility type or default (translated)
                    const avail = doctor.availability1shortform || null; // Availability string (short form)
                    const clinic = doctor.plc || null;                  // Clinic/PLC name
                    const bookingUrl = `/booking/${doctor.id}`;         // URL for the booking page

                    // --- Generate Rating HTML ---
                    let ratingHTML = ''; // Initialize rating HTML string
                    // Check if there are reviews and the rating is a valid number.
                    if (reviewCount > 0 && typeof ratingValue === 'number' && !isNaN(ratingValue)) {
                         // Generate HTML with stars and review count (pluralized, translated)
                        ratingHTML = `<div class="rating-display">${getStarsHTML(ratingValue)} <span class="review-count">(${reviewCount} ${reviewCount !== 1 ? 'تقييمات' : 'تقييم'})</span></div>`;
                    } else {
                        // Generate HTML indicating no reviews yet (translated).
                        ratingHTML = `<div class="rating-display"><span class="review-count no-reviews"><i class="far fa-star" style="color: var(--text-medium); margin-right: 4px; margin-left: 4px;"></i>لا يوجد تقييمات بعد</span></div>`; // Icon margin added for RTL/LTR spacing
                    }

                    // --- Generate Details HTML (Left Column - Right in RTL) ---
                    let detailsLeftHTML = `<div class="doctor-details">`; // Start details container
                    // Add location string if province or governorate exists.
                    if (prov || gov) {
                        detailsLeftHTML += `<p><i class="fas fa-map-marker-alt"></i> ${prov}${prov && gov ? '، ' : ''}${gov}</p>`; // Province, Governorate
                    }
                    // Add clinic name if it exists.
                    if (clinic) {
                        detailsLeftHTML += `<p><i class="fas fa-clinic-medical"></i> ${clinic}</p>`; // Clinic Name
                    }
                    // Add facility type.
                    detailsLeftHTML += `<p><i class="fas fa-hospital"></i> المنشأة: ${facType}</p>`; // Facility: Type (Translated)
                    detailsLeftHTML += `</div>`; // Close details container

                    // --- Generate Availability HTML (Right Column - Left in RTL) ---
                    let availabilityRightHTML = ''; // Initialize availability HTML
                    // Check if availability string exists and is not empty.
                    if (avail && typeof avail === 'string' && avail.trim() !== '') {
                        // Split the availability string by comma, trim parts, filter empty ones, wrap in <p> tags.
                        const availabilityLines = avail.split(',')
                            .map(part => part.trim()) // Remove extra spaces
                            .filter(part => part !== '') // Remove empty parts
                            .map(part => `<p>${part}</p>`) // Wrap each part in paragraph tags
                            .join(''); // Join the paragraphs back into a single string

                        // If valid lines were generated, create the availability block.
                        if (availabilityLines) {
                            availabilityRightHTML = `<div class="availability-details"><div class="availability-title"><i class="far fa-clock"></i>التوفر:</div>${availabilityLines}</div>`; // Title translated
                        } else {
                            // Fallback if processing resulted in no lines (e.g., string was just ', ,')
                             availabilityRightHTML = `<div class="availability-details"><div class="availability-title"><i class="far fa-clock"></i>التوفر:</div><p>اضغط على "احجز الآن" للتفاصيل</p></div>`; // Title & Fallback translated
                        }
                    } else {
                        // Fallback if no availability string was provided.
                         availabilityRightHTML = `<div class="availability-details"><div class="availability-title"><i class="far fa-clock"></i>التوفر:</div><p>غير محدد</p></div>`; // Title & Fallback translated
                    }

                    // --- Assemble Card HTML ---
                    // Construct the inner HTML of the doctor card using template literals.
                    card.innerHTML = `
                        <div class="doctor-card-top"> <!-- Top part: Photo, Name, Spec, Rating -->
                            <img src="${photoUrl}" class="doctor-photo" alt="صورة ${name}" loading="lazy" onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=e0f2f2&color=005f5f&size=150';"> <!-- Photo/Fallback -->
                            <div class="doctor-primary-info"> <!-- Name, Spec, Rating -->
                                <h3>${name}</h3>
                                <p class="specialization">${spec}</p>
                                ${ratingHTML} <!-- Generated rating stars/text -->
                            </div>
                        </div>
                        <div class="doctor-info"> <!-- Bottom part: Details, Availability, Button -->
                            <div class="doctor-info-columns"> <!-- Columns for details/availability -->
                                <div class="doctor-info-left"> <!-- First column -->
                                    ${detailsLeftHTML} <!-- Generated location/facility details -->
                                </div>
                                <div class="vertical-divider"></div> <!-- Divider -->
                                <div class="doctor-info-right"> <!-- Second column -->
                                    ${availabilityRightHTML} <!-- Generated availability details -->
                                </div>
                            </div>
                            <!-- Booking button -->
                            <button class="btn btn-primary book-btn" onclick="window.location.href='${bookingUrl}'">
                                <i class="far fa-calendar-check"></i> احجز الآن <!-- Translated: Book Now -->
                            </button>
                        </div>`;

                     // console.log("Appending card for doctor:", doctor.id); // Debug log
                     // Append the fully constructed card to the results container.
                    resultsContainer.appendChild(card);
                }); // End of forEach loop

                 // console.log("Finished appending cards. Setting up observer and fading in."); // Debug log
                // Re-initialize the Intersection Observer to watch the newly added cards for animations.
                setupScrollObserver();
                // Fade in the results container smoothly after a very short delay.
                setTimeout(() => { resultsContainer.style.opacity = '1'; }, 50);

                 // After displaying results, check visibility for the Go To Results button
                 // Check needs to happen after potential layout shifts from adding cards
                 // setTimeout(toggleGoToResultsButtonVisibility, 300); // Re-enable check if button logic needs it here

            } // End of else (results found)
        } // End of displayResults function


        // --- Card Selection & Filtering Helpers ---

        // Function to visually update card selection states (add/remove 'card-selected' class).
        // selectedCard: The card element that was clicked (or null to deselect all).
        // categoryClass: The CSS class identifying the type of card (e.g., 'facility-type-card').
        function updateCardSelection(selectedCard, categoryClass) {
            // Find all cards of the specified category.
            document.querySelectorAll(`.${categoryClass}`).forEach(card => {
                // Remove the 'card-selected' class and reset ARIA state from all cards first.
                card.classList.remove('card-selected');
                card.setAttribute('aria-pressed', 'false');
            });
            // If a specific card was clicked and belongs to the category:
            if (selectedCard && selectedCard.classList.contains(categoryClass)) {
                // Add the 'card-selected' class and set ARIA state to 'true'.
                selectedCard.classList.add('card-selected');
                selectedCard.setAttribute('aria-pressed', 'true');
            }
        }

        // Function to show/hide PLC cards based on a selected facility type.
        // selectedType: The facility type string to filter by (or null to show all).
        function filterPlcCardsByFacilityType(selectedType) {
             // Get all PLC card elements.
            const plcCards = document.querySelectorAll('.plc-card');
            let visibleCount = 0; // Counter for debugging/logging
             // Iterate through each PLC card.
            plcCards.forEach(card => {
                 // Get the PLC name stored in the data attribute.
                const plcName = card.getAttribute('data-plc-name');
                 // If name is missing, hide the card (shouldn't happen ideally).
                if (!plcName) { card.style.display = 'none'; return; }

                // Find the corresponding doctor/PLC data in the main data array to get its facility type.
                // Use find() and optional chaining (?.) for safety.
                const plcData = allDoctorsData.find(doc => doc?.plc === plcName);
                // Get the facility type associated with this PLC.
                const plcFacType = plcData?.facility_type;

                // Determine if the card should be visible:
                // Show if no type is selected OR if the PLC's type matches the selected type.
                if (!selectedType || (plcFacType && plcFacType === selectedType)) {
                    card.style.display = 'flex'; // Show the card (use 'flex' as per card styles)
                    visibleCount++; // Increment counter
                } else {
                    card.style.display = 'none'; // Hide the card
                }
            });
            // console.log(`Visible PLC cards for type '${selectedType || 'All'}': ${visibleCount}`); // Debug log
        }

        // ** Facility Type Card Click: Sets filter WITHOUT scrolling **
        // Handles clicks on Facility Type cards.
        // type: The facility type string associated with the clicked card.
        // cardElement: The DOM element of the clicked card.
        function setFacilityTypeFilterAndSearch(type, cardElement) {
            // console.log(`Set Facility Type: ${type}`); // Debug log

            // If the clicked card is already selected, deselect it and clear the filter.
            if (cardElement?.classList.contains('card-selected')) {
                clearFacilityTypeFilterAndSearch(); // Calls the function below
                return; // Stop execution
            }

            // --- Update State & UI ---
            currentSelectedFacilityType = type;     // Store the selected type globally
            currentSelectedPlcName = null;          // Clear any selected PLC
            updateCardSelection(cardElement, 'facility-type-card'); // Highlight this card
            updateCardSelection(null, 'plc-card');                // Deselect any PLC card

            // --- Update Search Inputs ---
            // Set the Facility Type dropdown to match the selected card.
            if (facilityTypeSelect) facilityTypeSelect.value = type;
            // Clear the name input field (as facility type filter is primary now).
            if (doctorNameInput) doctorNameInput.value = '';

            // --- Filter & Search ---
            // Filter the visible PLC cards based on the selected facility type.
            filterPlcCardsByFacilityType(type);
            // Trigger a search, but do NOT scroll the page down (false).
            searchDoctors(null, false, false);
        }

        // Function to clear the facility type filter when a selected card is clicked again or via Clear Filters button.
        function clearFacilityTypeFilterAndSearch() {
            // console.log("Clear Facility Type Filter"); // Debug log
            currentSelectedFacilityType = null;          // Clear global state
            updateCardSelection(null, 'facility-type-card'); // Deselect all facility cards
             // Reset the facility type dropdown.
            if (facilityTypeSelect) facilityTypeSelect.value = "";
            // Show all PLC cards again.
            filterPlcCardsByFacilityType(null);
            // Trigger search without scroll.
            searchDoctors(null, false, false);
        }

        // ** PLC Card Click: Sets filter AND SCROLLS **
        // Handles clicks on PLC (clinic/place) cards.
        // plcName: The name of the clicked PLC.
        // cardElement: The DOM element of the clicked card.
        function setPlcFilterAndSearch(plcName, cardElement) {
            // console.log(`Set PLC: ${plcName}`); // Debug log
             // Basic check for valid input.
            if (!plcName || !cardElement) return;

            // If the clicked card is already selected, deselect it and clear filter.
            if (cardElement.classList.contains('card-selected')) {
                 clearPlcFilterAndSearch(); // Calls the function below
                 return; // Stop execution
            }

            // --- Update State ---
            currentSelectedPlcName = plcName; // Store selected PLC name
            // Find the data for this PLC to determine its associated facility type.
            const plcData = allDoctorsData.find(doc => doc?.plc === plcName);
            const assocFacType = plcData?.facility_type; // Get associated type
            currentSelectedFacilityType = assocFacType; // Update global facility type state

            // --- Update Card UI ---
            updateCardSelection(cardElement, 'plc-card'); // Select this PLC card
            // Also select the corresponding facility type card, if found.
            const facCard = assocFacType ? document.querySelector(`.facility-type-card[data-facility-type="${assocFacType}"]`) : null;
            updateCardSelection(facCard, 'facility-type-card'); // Select associated facility card

            // --- Update Search Inputs ---
            // Set the Doctor/Clinic Name input field to the clicked PLC name.
            if (doctorNameInput) doctorNameInput.value = plcName;
            // Set the Facility Type dropdown to the PLC's associated type (or empty if none).
            if (facilityTypeSelect) facilityTypeSelect.value = assocFacType || '';

            // --- Ensure Collapsible is Open & Search/Scroll ---
            // Find the parent collapsible section of the clicked card.
            const plcSection = cardElement.closest('.collapsible-section');
            // Check if the section exists and is currently closed.
            if (plcSection && !plcSection.classList.contains('is-open')) {
                // If closed, click the header to open it.
                plcSection.querySelector('.collapsible-header').click();
                // Wait for the collapse animation (approx. 400ms) to finish before searching and scrolling.
                setTimeout(() => {
                    // Trigger search WITH scrolling (true).
                    searchDoctors(null, false, true);
                }, 450); // Delay adjusted based on --collapse-transition-speed
            } else {
                 // If the section is already open or the card is not inside a collapsible,
                 // trigger the search WITH scrolling immediately.
                 searchDoctors(null, false, true);
            }
        }

        // Function to clear the PLC filter (e.g., if selected PLC card clicked again).
        function clearPlcFilterAndSearch() {
            // console.log("Clear PLC Filter"); // Debug log
            currentSelectedPlcName = null;          // Clear global PLC state
            updateCardSelection(null, 'plc-card'); // Deselect PLC cards

            // If the name input currently holds a PLC name that was selected, clear it.
             // Avoid clearing it if the user manually typed something different.
            if (doctorNameInput && Array.isArray(allPlcs) && allPlcs.includes(doctorNameInput.value)) {
                 doctorNameInput.value = "";
             }

            // Re-filter PLC cards based on the *currently selected facility type* (if any).
            filterPlcCardsByFacilityType(currentSelectedFacilityType);
             // Trigger search WITHOUT scrolling.
            searchDoctors(null, false, false);
        }


        // --- Typing Effect ---
        // Configuration for the hero section typing animation.
        const textsToType = ["هل تحتاج إلى أخصائي؟", "احجز الفحوصات عبر الإنترنت.", "الوصول إلى أطباء معتمدين.", "صحتك، مجدولة ببساطة."]; // Array of texts to display (translated)
        let textIndex = 0;       // Index of the current text in the array
        let charIndex = 0;       // Index of the current character being typed/deleted
        let isDeleting = false;  // Flag: true if currently deleting, false if typing
        let typingTimeout;       // Holds the timeout ID for the next character action
        const typeSpeed = 90;    // Speed of typing (ms per character)
        const deleteSpeed = 50;  // Speed of deleting (ms per character)
        const pauseBeforeDelete = 2200; // Pause duration after typing completes (ms)
        const pauseBeforeType = 300;  // Pause duration after deleting completes (ms)

        // Function to perform one step of the typing/deleting animation.
        function type() {
             clearTimeout(typingTimeout); // Clear previous timeout
            if (!textElement) return; // Exit if the target element doesn't exist

            const currentText = textsToType[textIndex]; // Get the full text for the current index
            let typeDelay; // Variable to hold the delay before the next step

            // Temporarily pause the CSS blinking cursor animation during character update
            textElement.style.animationPlayState = 'paused';

            if (!isDeleting) {
                 // --- Typing ---
                 // Add the next character to the element's content.
                 textElement.textContent = currentText.slice(0, ++charIndex);
                 // Check if the full text has been typed.
                if (charIndex === currentText.length) {
                     isDeleting = true; // Switch to deleting mode
                     typeDelay = pauseBeforeDelete; // Set delay before starting deletion
                 } else {
                     // Set delay for the next character, adding some randomness.
                     typeDelay = typeSpeed + (Math.random() - 0.5) * 50;
                 }
             } else {
                 // --- Deleting ---
                 // Remove the last character from the element's content.
                 textElement.textContent = currentText.slice(0, --charIndex);
                 // Check if the text has been fully deleted.
                if (charIndex === 0) {
                     isDeleting = false; // Switch back to typing mode
                     // Move to the next text in the array (looping back to 0).
                     textIndex = (textIndex + 1) % textsToType.length;
                     typeDelay = pauseBeforeType; // Set delay before starting to type the new text
                 } else {
                     // Set delay for deleting the next character.
                     typeDelay = deleteSpeed;
                 }
             }

             // Resume the CSS blinking cursor animation
             textElement.style.animationPlayState = 'running';
             // Set the timeout for the next step (typing or deleting).
             typingTimeout = setTimeout(type, typeDelay);
        } // End of type function


        // --- Animated Counter ---
        // Animates a number from 0 up to a target value defined in a data attribute.
        // element: The DOM element containing the number to animate (must have data-target attribute).
        function animateCounter(element) {
             // --- Checks ---
            if (!element) return; // Exit if element doesn't exist
             // Get the target value from the 'data-target' attribute.
            const targetStr = element.dataset.target;
            // Exit if already animated or if target attribute is missing.
            if (element.dataset.animated === 'true' || !targetStr) return;
            // Parse the target value as an integer.
            const target = parseInt(targetStr, 10);
            // Exit if target is not a valid number.
            if (isNaN(target)) return;

            // --- Initialization ---
            element.dataset.animated = 'true'; // Mark as animated to prevent re-running
            // If target is 0, just set the text and exit.
            if (target === 0) { element.textContent = '0'; return; }

            // --- Animation Loop ---
            let startTimestamp = null; // Timestamp when animation started
            const duration = COUNTER_ANIMATION_DURATION; // Get duration from global constant

            // The step function is called repeatedly by requestAnimationFrame.
            const step = (timestamp) => {
                // Record the start time on the first call.
                if (!startTimestamp) startTimestamp = timestamp;
                 // Calculate elapsed time.
                const elapsed = timestamp - startTimestamp;
                 // Calculate progress as a fraction (0 to 1).
                 const progress = Math.min(elapsed / duration, 1);
                 // Apply an easing function (ease-out cubic) to make the animation feel more natural.
                const easedProgress = 1 - Math.pow(1 - progress, 3); // 1 - (1-x)^3
                 // Calculate the current value based on eased progress and target.
                 const currentValue = Math.floor(easedProgress * target);
                 // Update the element's text content with the formatted current value.
                element.textContent = currentValue.toLocaleString('ar'); // Use 'ar' locale for potential Arabic numerals/formatting

                // Continue animation if progress is less than 1.
                if (progress < 1) {
                    window.requestAnimationFrame(step); // Request the next frame
                } else {
                    // Ensure the final value is exactly the target, formatted.
                     element.textContent = target.toLocaleString('ar'); // Use 'ar' locale
                }
            };

            // Start the animation loop.
            window.requestAnimationFrame(step);
        } // End of animateCounter function


        // --- Intersection Observer for Scroll Animations ---
        // Sets up and manages the Intersection Observer to trigger animations when elements scroll into view.
        function setupScrollObserver() {
            // If an observer instance already exists, disconnect it first to avoid duplicate observations.
            if (intersectionObserver) {
                 intersectionObserver.disconnect();
            }

            // Select all elements that need scroll animation AND are not already marked as visible.
            const elements = document.querySelectorAll('.reveal-on-scroll:not(.is-visible)');

            // If no elements need observing, exit.
            if (elements.length === 0) {
                // console.log("Scroll Observer: No new elements to observe."); // Debug log
                return;
            }
             // console.log(`Scroll Observer: Setting up for ${elements.length} elements.`); // Debug log

            // --- Observer Configuration ---
            const options = {
                 root: null, // Observe intersections relative to the viewport.
                threshold: 0.1, // Trigger callback when 10% of the element is visible.
                rootMargin: '0px 0px -30px 0px' // Trigger callback slightly before element fully enters viewport (bottom margin).
            };

            // --- Observer Callback Function ---
            // This function is executed whenever observed elements intersect according to the options.
            const callback = (entries, observer) => {
                // Iterate through each intersection entry.
                entries.forEach(entry => {
                    // Check if the element is currently intersecting the viewport.
                    if (entry.isIntersecting) {
                        const el = entry.target; // Get the target element

                        // --- Apply Animation Class ---
                        // Add the 'is-visible' class to trigger the CSS animation.
                        el.classList.add('is-visible');

                        // --- Specific Actions for Certain Elements ---
                        // If the element is a stat counter number and hasn't been animated yet:
                        if (el.classList.contains('stat-number') && el.dataset.animated !== 'true') {
                            animateCounter(el); // Start the counter animation
                        }
                        // If the element is a PLC card, check if its image failed to load.
                         else if (el.classList.contains('plc-card')) {
                             const img = el.querySelector('img.plc-photo'); // Find the image
                             const icon = el.querySelector('i.icon');      // Find the fallback icon
                              // Check if image exists, icon exists, image is *supposed* to be displayed,
                              // and image is not fully loaded/rendered (broken or loading slow).
                              if (img && icon && img.style.display !== 'none' && (!img.complete || img.naturalHeight === 0 || img.naturalWidth === 0)) {
                                   // console.warn(`Image failed/not loaded: ${img.alt || 'Unknown PLC'}. Showing fallback icon.`); // Debug log
                                   // Hide the broken image and show the fallback icon.
                                   img.style.display = 'none';
                                   icon.style.display = 'flex';
                               }
                        }

                        // --- Stop Observing ---
                        // Once an element is visible and animated, stop observing it for performance.
                        observer.unobserve(el);
                    } // End if isIntersecting
                }); // End forEach entry
            }; // End callback function

            // --- Create and Start Observer ---
            // Create the new IntersectionObserver instance with the callback and options.
            intersectionObserver = new IntersectionObserver(callback, options);
            // Start observing each element found earlier.
            elements.forEach(el => intersectionObserver.observe(el));
        } // End of setupScrollObserver function


        // --- Initial Page Load Logic ---
        // Code to run after the HTML document structure is fully loaded and parsed.
        document.addEventListener('DOMContentLoaded', () => {
            // console.log("DOM Loaded. Initializing..."); // Debug log
            // console.log("Initial allDoctorsData:", allDoctorsData); // Debug log: Check data availability on load

            // --- Setup Event Listeners ---
            // Add change listeners to dropdowns to trigger search (without scroll).
            if (provinceSelect) provinceSelect.addEventListener('change', (e) => searchDoctors(e, false, false));
            if (governorateSelect) governorateSelect.addEventListener('change', (e) => searchDoctors(e, false, false));
            if (specializationSelect) specializationSelect.addEventListener('change', (e) => searchDoctors(e, false, false));
            // Add input listener to the name field to trigger debounced search.
            if (doctorNameInput) doctorNameInput.addEventListener('input', searchDoctorsDebounced);

            // Add change listener specifically for the Facility Type dropdown.
            if (facilityTypeSelect) {
                facilityTypeSelect.addEventListener('change', (e) => {
                    const selectedValue = e.target.value; // Get selected value
                    currentSelectedFacilityType = selectedValue; // Update global state

                    // Find the corresponding facility type card to highlight it.
                    const matchingCard = selectedValue ? document.querySelector(`.facility-type-card[data-facility-type="${selectedValue}"]`) : null;
                    updateCardSelection(matchingCard, 'facility-type-card'); // Update card UI

                    // Deselect any potentially selected PLC card.
                    updateCardSelection(null, 'plc-card');
                    currentSelectedPlcName = null; // Reset selected PLC state

                    // Clear name input if it contains a PLC name (avoid clearing user's manual typing).
                    if (doctorNameInput && Array.isArray(allPlcs) && allPlcs.includes(doctorNameInput.value)) {
                       doctorNameInput.value = "";
                   }

                    // Filter the PLC cards based on the selected facility type.
                    filterPlcCardsByFacilityType(selectedValue);
                    // Trigger search WITHOUT scrolling.
                    searchDoctors(e, false, false);
                 });
            }

             // Add listener for 'Enter' key press in the doctor name input.
             if (doctorNameInput) {
                 doctorNameInput.addEventListener('keypress', function(event) {
                     // Check if the pressed key is Enter.
                     if (event.key === 'Enter') {
                         event.preventDefault(); // Prevent default form submission behavior
                         clearTimeout(searchTimeoutId); // Cancel any pending debounced search
                         // Trigger search immediately WITH scrolling (true).
                         searchDoctors(null, false, true);
                     }
                 });
             }

             // --- Start Typing Animation ---
             // If the text element exists and there are texts to type, start the animation after a delay.
             if (textElement && textsToType.length > 0) {
                 setTimeout(type, pauseBeforeType + 500); // Initial delay before typing starts
             }

            // --- Handle URL Parameters & Initial Search/Display ---
            let initialSearchNeeded = true; // Flag to determine if a default search is needed.
            let triggeredSearchByCard = false; // Flag if URL params caused a card click simulation.

             try {
                 // Get URL search parameters.
                 const urlParams = new URLSearchParams(window.location.search);

                 // --- Helper function to set dropdown value from URL param ---
                 // param: the URL parameter name (e.g., 'province').
                 // el: the select dropdown element.
                 // dataArray: the array of valid options for the dropdown (used for validation).
                 function setDropdown(param, el, dataArray) {
                    const value = urlParams.get(param); // Get value from URL
                    // Check if element exists, value exists, and value is valid (or is '')
                    if (el && value !== null && (value === '' || (Array.isArray(dataArray) && dataArray.includes(value)))) {
                        el.value = value; // Set dropdown value
                         return value; // Return the value that was set
                    }
                    return null; // Return null if not set
                 }

                 // --- Process URL Params ---
                 // Set dropdown values based on URL parameters.
                 const initProv = setDropdown('province', provinceSelect, ['Bagmati', 'Gandaki', 'Lumbini', 'Koshi', 'Madhesh', 'Sudurpashchim', 'Karnali']);
                 const initGov = setDropdown('governorate', governorateSelect, allGovernorates);
                 const initSpec = setDropdown('specialization', specializationSelect, allSpecialties);
                 let initFac = setDropdown('facility_type', facilityTypeSelect, allFacilityTypes);
                 const initName = urlParams.get('name'); // Get potential name query

                 let plcSetFromUrl = false; // Flag if name param matched a PLC

                 // --- Priority 1: Name matches a known PLC ---
                 // Check if a name parameter exists and matches a name in the PLC list.
                 if (initName && Array.isArray(allPlcs) && allPlcs.includes(initName)) {
                     // Find the corresponding PLC card element.
                     const plcCard = document.querySelector(`.plc-card[data-plc-name="${initName}"]`);
                     if (plcCard) { // If the card exists:
                         // Find its parent collapsible section.
                         const plcSection = plcCard.closest('.collapsible-section');
                         // If section exists and is closed, open it first.
                         if (plcSection && !plcSection.classList.contains('is-open')) {
                             plcSection.querySelector('.collapsible-header').click();
                         }
                         // Simulate a click on the PLC card after a short delay (for collapse animation).
                         // This will trigger `setPlcFilterAndSearch`, which includes search and scroll.
                         setTimeout(() => { plcCard.click(); }, 100);
                         triggeredSearchByCard = true; // Mark that search was handled by card click
                         plcSetFromUrl = true;        // Mark that name was used for PLC
                         initialSearchNeeded = false;   // No default search needed now
                          // console.log("URL Init: PLC card click triggered."); // Debug log
                     }
                 }

                 // --- Priority 2: Facility Type is set (and no PLC match occurred) ---
                 // Check if facility type was set and no PLC card click was triggered above.
                 if (!triggeredSearchByCard && initFac) {
                     // Find the corresponding facility type card.
                     const facCard = document.querySelector(`.facility-type-card[data-facility-type="${initFac}"]`);
                     if (facCard) { // If the card exists:
                          // Find its parent collapsible section.
                         const facSection = facCard.closest('.collapsible-section');
                         // If section exists and is closed, open it.
                         if (facSection && !facSection.classList.contains('is-open')) {
                             facSection.querySelector('.collapsible-header').click();
                         }
                          // Simulate a click on the facility type card after a short delay.
                          // This triggers `setFacilityTypeFilterAndSearch` (no scroll).
                         setTimeout(() => { facCard.click(); }, 100);
                         triggeredSearchByCard = true; // Mark that search was handled by card click
                         initialSearchNeeded = false;   // No default search needed now
                         // console.log("URL Init: Facility Type card click triggered."); // Debug log
                     } else {
                         // If facility type was in URL but no card found (e.g., dynamic data issue),
                         // manually update the state and filter the PLC cards.
                         // console.log("URL Init: Facility Type set, card not found, filtering PLCs manually."); // Debug log
                         currentSelectedFacilityType = initFac;
                         filterPlcCardsByFacilityType(initFac);
                     }
                 }

                 // --- Fallback: Filter PLCs if only facility type URL param exists ---
                 // If no card click was simulated, ensure PLC cards are filtered based on facility type URL param if present.
                 if (!triggeredSearchByCard) {
                     // console.log("URL Init: No card click, filtering PLCs based on URL Facility Type (if any)."); // Debug log
                     filterPlcCardsByFacilityType(initFac);
                 }

                 // --- Set Name Input (if not used for PLC) ---
                 // If name param exists but wasn't identified as a specific PLC.
                 if (initName && !plcSetFromUrl && doctorNameInput) {
                     // console.log("URL Init: Setting name input from URL."); // Debug log
                     doctorNameInput.value = initName; // Set the name input field value
                 }

                 // --- Check if Initial Search is Still Needed ---
                 // If any filter dropdowns were set by URL OR the name field was set,
                 // but NO card click simulation happened, then a search *is* still needed
                 // to reflect these non-card URL parameters.
                 if (!triggeredSearchByCard && (initProv || initGov || initSpec || initFac || initName)) {
                      // console.log(`URL Init: Non-card params present, marking initial search as needed.`); // Debug log
                     initialSearchNeeded = true;
                 }

             } catch (e) { // Catch errors during URL processing
                 console.error("Error processing URL parameters:", e);
                 filterPlcCardsByFacilityType(null); // Reset PLC filters on error
                 initialSearchNeeded = true;        // Ensure default display on error
             }

             // --- Perform Initial Search (if determined necessary) ---
             if (initialSearchNeeded) {
                  // console.log("Performing initial search (default or from non-card URL params)."); // Debug log
                  // Run the search function, marking it as initial (true) and disabling scroll (false).
                 searchDoctors(null, true, false);
             } else {
                  // console.log("Initial search was handled by card click simulation from URL params."); // Debug log
                 // No search needed here; it was triggered by the simulated card click.
             }

            // --- Final Setup Steps ---
             // Set up the Intersection Observer for scroll animations after a short delay
             // to allow initial DOM rendering and potential search results to be added.
             setTimeout(() => {
                  // console.log("Setting up scroll observer..."); // Debug log
                 setupScrollObserver();
             }, 300);

             // console.log("Initialization complete."); // Debug log
        }); // End DOMContentLoaded listener
    </script>
    <!-- JavaScript End -->

</body>
</html>
```