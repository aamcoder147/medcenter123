<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareConnect - Book Your Clinic Appointment Seamlessly</title>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- :root Variables --- */
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-accent-light: #e0f2f2;
            --bg-accent-very-light: #f0fafa;
            --border-color: #e5e7eb;
            --border-color-strong: #d1d5db;
            --text-dark: #1f2937;
            --text-medium: #4b5563;
            --text-light: #ffffff;
            --accent-primary: #007A7A;
            --accent-primary-dark: #005F5F;
            --accent-primary-light: #4DB6AC;
            --accent-warm: #F2A900;
            --accent-warm-dark: #D99700;
            --success: #10b981;
            --error: #ef4444;
            --info: #3b82f6;
            --shadow-color: rgba(0, 50, 50, 0.06);
            --shadow-color-medium: rgba(0, 50, 50, 0.1);
            --shadow-color-strong: rgba(0, 50, 50, 0.15);
            --transition-speed: 0.3s;
            --transition-ease: ease-in-out;
            --scroll-animation-duration: 0.6s;
            --stagger-delay: 0.12s;
            --counter-animation-duration: 1500ms;
            --collapse-transition-speed: 0.4s; /* Updated speed */
        }

        /* --- Base & Global Styles --- */
        html { scroll-behavior: smooth; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background-color: var(--bg-secondary);
            color: var(--text-dark);
            font-family: 'Open Sans', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            padding-bottom: 80px;
        }
        .container { width: 90%; max-width: 1280px; margin: 0 auto; padding: 0 1rem; }
        .section-padding { padding: 5rem 0; }
        .section-padding-sm { padding: 3rem 0; }
        .section-title { text-align: center; margin-bottom: 3rem; font-size: 2rem; font-weight: 700; color: var(--text-dark); font-family: 'Lato', sans-serif; position: relative; padding-bottom: 0.8rem; }
        .section-title::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 70px; height: 4px; background-color: var(--accent-primary); border-radius: 2px; }
        .section-subtitle { text-align: center; color: var(--text-medium); max-width: 600px; margin: -2rem auto 3rem auto; font-size: 1.05rem; }

        /* --- Subtle Section Background Gradients --- */
        .featured-plcs-section, .doctors-section, .site-reviews-section { background: linear-gradient(to bottom, var(--bg-primary) 0%, #fdfdfd 100%); }
        .featured-facility-types-section { background: linear-gradient(to bottom, var(--bg-secondary) 0%, #f7f8fa 100%); }
        .how-it-works-section { background: linear-gradient(to bottom, var(--bg-primary) 0%, #fbfcfc 100%); }
        .trust-factors-section, #site-review-form-section { background: linear-gradient(to bottom, var(--bg-accent-very-light) 0%, #eafafa 100%); }

        /* --- Accessibility: Focus Styles --- */
        *:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 2px; box-shadow: 0 0 0 3px rgba(0, 122, 122, 0.25); border-radius: 4px; }
        select:focus, input[type="text"]:focus { outline: none; }
        select:focus-visible, input[type="text"]:focus-visible { outline: none; border-color: var(--accent-primary); box-shadow: 0 0 0 3px rgba(0, 122, 122, 0.15); }
        .btn:focus-visible, button.collapsible-header:focus-visible { box-shadow: 0 2px 4px var(--shadow-color), 0 0 0 3px rgba(0, 122, 122, 0.25); }
        .specialty-card:focus-visible, .facility-type-card:focus-visible, .plc-card:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 1px; box-shadow: 0 8px 15px var(--shadow-color-medium), 0 0 0 3px rgba(0, 122, 122, 0.15); }
        .doctor-card:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 2px; box-shadow: 0 8px 15px var(--shadow-color-strong), 0 0 0 3px rgba(0, 122, 122, 0.15); }

        /* --- Animations --- */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInLeft { from { opacity: 0; transform: translateX(-35px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeInRight { from { opacity: 0; transform: translateX(35px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.85); } to { opacity: 1; transform: scale(1); } }
        @keyframes blinkCursor { 50% { border-color: transparent; } }

        /* Scroll Reveal Base Class */
        .reveal-on-scroll { opacity: 0; will-change: opacity, transform; animation-fill-mode: forwards; }
        .reveal-on-scroll.is-visible { animation-name: fadeInUp; animation-duration: var(--scroll-animation-duration); animation-timing-function: ease-out; }
        .reveal-left.is-visible { animation-name: fadeInLeft; }
        .reveal-right.is-visible { animation-name: fadeInRight; }
        .reveal-zoom.is-visible { animation-name: zoomIn; }

        /* --- Navbar --- */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%; /* Base padding */
            background: var(--bg-primary);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: box-shadow var(--transition-speed) var(--transition-ease), padding var(--transition-speed) var(--transition-ease), background-color var(--transition-speed) var(--transition-ease);
            border-bottom: 1px solid var(--border-color);
        }
        .navbar.scrolled {
            box-shadow: 0 4px 10px var(--shadow-color-medium); /* Slightly enhanced shadow */
            padding: 0.7rem 5%; /* Slightly reduced padding on scroll */
            background: rgba(255, 255, 255, 0.97); /* Slightly more opaque */
            backdrop-filter: blur(8px); /* Stronger blur */
            border-bottom-color: transparent; /* Hide border when shadow appears */
        }
        .logo {
            font-size: 1.8rem; /* Slightly adjusted size */
            font-weight: 700;
            color: var(--accent-primary);
            font-family: 'Lato', sans-serif;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            transition: transform var(--transition-speed) var(--transition-ease);
            margin-right: auto; /* Keeps pushing buttons right */
        }
        .logo i {
            font-size: 1.6rem; /* Adjusted icon size */
        }
        .logo:hover {
            transform: scale(1.03);
        }
        .nav-login-buttons {
            display: flex;
            gap: 1rem; /* Consistent gap */
            align-items: center;
            margin-left: 1.5rem; /* Ensure some space from logo */
        }

        /* --- Buttons --- */
        .btn { padding: 0.7rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.95rem; text-align: center; transition: all var(--transition-speed) var(--transition-ease); border: 1px solid transparent; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 0.6rem; line-height: 1.2; box-shadow: 0 2px 4px var(--shadow-color); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 12px var(--shadow-color-medium); }
        .btn:active { transform: translateY(0px); box-shadow: 0 2px 4px var(--shadow-color); }
        .btn[disabled] { cursor: not-allowed; opacity: 0.6; background-color: #ccc !important; border-color: #ccc !important; box-shadow: none; pointer-events: none; } /* Disabled style */
        .btn-primary { background-color: var(--accent-primary); color: var(--text-light); border-color: var(--accent-primary); margin: 0; }
        .btn-primary:hover:not([disabled]) { background-color: var(--accent-primary-dark); border-color: var(--accent-primary-dark); }
        .btn-secondary { background-color: var(--bg-primary); color: var(--text-medium); border-color: var(--border-color-strong); box-shadow: none; } /* Default for 'Clear'/'For Providers' */
        .btn-secondary:hover:not([disabled]) { background-color: var(--bg-secondary); border-color: var(--text-medium); color: var(--text-dark); }
        .btn-link { background: none; border: none; box-shadow: none; color: var(--accent-primary); padding: 0; font-weight: 600; }
        .btn-link:hover { color: var(--accent-primary-dark); text-decoration: underline;}
        .btn-small { padding: 0.4rem 0.9rem; font-size: 0.85rem; gap: 0.4rem; }

        /* --- Hero Section --- */
        .hero-section { background-color: var(--bg-primary); padding: 6rem 5% 5rem; text-align: center; border-bottom: 1px solid var(--border-color); overflow: visible; }
        .hero-title, .hero-subtitle, .typing-effect-container { opacity: 0; animation: fadeInUp 0.8s ease-out 0.2s forwards; }
        .hero-subtitle { animation-delay: 0.35s; }
        .typing-effect-container { animation-delay: 0.5s; }
        .hero-title { font-size: 2.8rem; margin-bottom: 1rem; color: var(--text-dark); font-weight: 700; font-family: 'Lato', sans-serif; line-height: 1.3; }
        .hero-title span { color: var(--accent-primary); }
        .hero-subtitle { font-size: 1.2rem; color: var(--text-medium); margin-bottom: 2rem; max-width: 700px; margin-left: auto; margin-right: auto; }
        .typing-effect-container { min-height: 32px; margin-bottom: 3rem; font-size: 1.2rem; color: var(--accent-primary-dark); font-weight: 600; }
        #text { border-right: 3px solid var(--accent-primary); padding-right: 6px; display: inline-block; white-space: nowrap; overflow: hidden; vertical-align: bottom; animation: blinkCursor 0.7s infinite steps(1); }

        /* --- Search Area Container --- */
        .search-area-container { border: 1px solid var(--border-color-strong); border-radius: 12px; padding: 2.5rem 2rem; margin: 3rem auto 0 auto; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(4px); max-width: 1100px; box-shadow: 0 8px 25px rgba(0, 50, 50, 0.1); display: flex; flex-direction: column; gap: 1.5rem; align-items: center; opacity: 0; animation: fadeInUp 0.8s ease-out 0.65s forwards; }
        .search-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem; width: 100%; align-items: center; }
        .input-group { position: relative; width: 100%; }
        .input-group i { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: var(--text-medium); font-size: 1em; transition: color var(--transition-speed) var(--transition-ease); pointer-events: none; }
        select, input[type="text"] { width: 100%; padding: 0.9rem 0.9rem 0.9rem 2.8rem; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-primary); color: var(--text-dark); font-size: 1rem; transition: border-color var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease); height: 48px; }
        select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%234b5563' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M7.646 11.854a.5.5 0 0 0 .708 0l4-4a.5.5 0 0 0-.708-.708L8 10.793 4.354 7.146a.5.5 0 1 0-.708.708l4 4z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; padding-right: 3rem; cursor: pointer; }
        .input-group:focus-within i { color: var(--accent-primary); }
        .search-button-container { display: flex; justify-content: center; flex-wrap: wrap; width: 100%; margin-top: 1rem; gap: 1rem; }
        .search-button-container .btn { flex-grow: 0; flex-basis: auto; padding: 0.8rem 1.8rem; font-size: 1rem; min-width: 140px; }
        .search-button-container .btn-secondary { background-color: var(--bg-primary); color: var(--text-medium); border-color: var(--border-color-strong); }
        .search-button-container .btn-secondary:hover:not([disabled]) { background-color: var(--bg-secondary); border-color: var(--text-medium); color: var(--text-dark); }

        /* --- Collapsible Section Styles --- */
        .collapsible-section {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 1.5rem;
            background-color: var(--bg-primary);
            box-shadow: 0 2px 4px var(--shadow-color);
            overflow: hidden; /* Prevent content overflow during transition */
        }
        button.collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 1.2rem 1.5rem;
            background-color: transparent;
            border: none;
            /* border-bottom: 1px solid var(--border-color); REMOVED - border managed by section */
            text-align: left;
            cursor: pointer;
            font-family: inherit;
            /* border-radius: 8px 8px 0 0; REMOVED - handled by section */
            transition: background-color var(--transition-speed) ease-in-out;
        }
        /* Add bottom border ONLY when closed */
         .collapsible-section:not(.is-open) button.collapsible-header {
             border-bottom: 1px solid var(--border-color);
         }

        button.collapsible-header:hover {
            background-color: var(--bg-secondary);
        }
        .collapsible-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-dark);
            font-family: 'Lato', sans-serif;
            margin: 0;
        }
        .collapsible-icon {
            font-size: 1.1rem;
            color: var(--text-medium);
            transition: transform var(--collapse-transition-speed) ease-in-out;
            margin-left: 1rem;
        }
        .collapsible-section.is-open .collapsible-icon {
            transform: rotate(180deg);
            color: var(--accent-primary);
        }
        .collapsible-content {
            /* REMOVED max-height */
            display: grid; /* Use grid for smooth height transition */
            grid-template-rows: 0fr; /* Start collapsed */
            transition: grid-template-rows var(--collapse-transition-speed) ease-in-out,
                        padding-top var(--collapse-transition-speed) ease-in-out,
                        padding-bottom var(--collapse-transition-speed) ease-in-out;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
             padding-top: 0; /* Start with no top/bottom padding */
             padding-bottom: 0;
            background-color: var(--bg-primary);
            /* border-radius: 0 0 8px 8px; REMOVED - handled by section */
        }
        /* Inner wrapper needed for grid transition to work correctly */
        .collapsible-content-inner {
             overflow: hidden;
        }

        .collapsible-section.is-open .collapsible-content {
            grid-template-rows: 1fr; /* Expand to content height */
            padding-top: 2rem; /* Add padding when open */
             padding-bottom: 2rem;
            border-top: 1px solid var(--border-color); /* Add separator */
        }

        /* --- How It Works Section --- */
        .how-it-works-grid, .how-it-works-grid-standalone { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2.5rem; text-align: center; margin-top: 4rem; }
        .how-it-works-step { padding: 2rem; transition: transform 0.3s ease, box-shadow 0.3s ease; background: var(--bg-primary); border-radius: 8px; box-shadow: 0 4px 8px var(--shadow-color); border: 1px solid var(--border-color); }
        .how-it-works-step .icon { font-size: 3rem; color: var(--accent-primary); margin-bottom: 1.5rem; display: inline-block; transition: transform 0.3s ease; }
        .how-it-works-step h3 { font-size: 1.2rem; font-weight: 700; margin-bottom: 0.8rem; color: var(--text-dark); }
        .how-it-works-step p { color: var(--text-medium); font-size: 0.95rem; }
        .how-it-works-step:hover { transform: translateY(-10px); box-shadow: 0 10px 20px var(--shadow-color-medium); }
        .how-it-works-step:hover .icon { transform: scale(1.15) rotate(-8deg); color: var(--accent-primary-dark); }
        .how-it-works-section { border-top: 1px solid var(--border-color); }

        /* --- Featured Grids --- */
        .featured-specialties-grid, .featured-facility-types-grid, .featured-plcs-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.8rem; }
        .clear-filter-button-container { text-align: center; margin-top: 2.5rem; }


        /* --- Individual Cards (Base) --- */
        .specialty-card, .facility-type-card, .plc-card {
             background: var(--bg-primary);
             border: 1px solid var(--border-color);
             border-radius: 8px;
             text-align: center;
             transition: all var(--transition-speed) var(--transition-ease);
             box-shadow: 0 2px 5px var(--shadow-color);
             display: flex;
             flex-direction: column;
             align-items: center;
             cursor: pointer;
             justify-content: space-between; /* Adjust content spacing */
             overflow: hidden;
             position: relative;
            padding: 1rem; /* Base padding */
        }

         /* --- Facility Type Card Specifics (Smaller) --- */
         .facility-type-card {
             min-height: 140px; /* Make noticeably shorter */
             padding: 0.8rem; /* Slightly less padding */
         }
         .facility-type-card .icon {
             font-size: 2.2rem; /* Slightly smaller icon */
             margin-top: 0.8rem;
             color: var(--accent-primary-light);
             transition: all 0.3s ease;
             flex-grow: 1;
             display: flex;
             align-items: center;
             justify-content: center;
         }
        .facility-type-card h4 {
             font-size: 0.95rem; /* Slightly smaller text */
             font-weight: 600;
             color: var(--text-dark);
             line-height: 1.3;
             padding: 0 0.5rem;
             margin-top: auto;
             margin-bottom: 0.5rem;
             transition: color 0.3s ease;
        }

        /* --- PLC Card Specifics (Larger) --- */
        .plc-card {
            min-height: 240px; /* Maintain or slightly increase height */
            padding: 0; /* Remove base padding, handle internally */
        }
        .plc-card .icon { /* Icon shown if image fails */
            font-size: 2.5rem;
            color: var(--accent-primary-light);
            margin-top: 1rem;
            transition: all 0.3s ease;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
         .plc-card h4 {
            font-size: 1.0rem;
            font-weight: 600;
            color: var(--text-dark);
            line-height: 1.3;
            padding: 0 1rem; /* Padding for title */
            margin-top: auto; /* Pushes title down */
            margin-bottom: 0rem; /* Space before button container */
            transition: color 0.3s ease;
         }
         .plc-photo {
             width: 100%;
             height: 120px; /* Slightly taller image */
             object-fit: cover;
             /* border-radius: 4px 4px 0 0; handled by card */
             display: block;
             border-bottom: 1px solid var(--border-color);
             margin-bottom: 0.8rem;
             transition: transform 0.3s ease;
         }
         /* Adjust title margin if icon is shown instead of photo */
         .plc-card .icon + h4 { margin-top: 0.8rem; }
         .plc-details-button-container {
             width: 100%;
             margin-top: 0.8rem; /* Space above button */
             padding: 0 1rem 1rem 1rem; /* Padding around button */
         }
         .plc-details-btn {
             width: 100%; /* Button takes full width within padding */
             margin: 0 auto;
         }

        /* --- Shared Hover/Selected Styles --- */
        .specialty-card:hover, .facility-type-card:hover, .plc-card:hover { transform: translateY(-8px) scale(1.03); border-color: var(--accent-primary); box-shadow: 0 8px 18px var(--shadow-color-medium); }
        .specialty-card:hover h4, .facility-type-card:hover h4, .plc-card:hover h4 { color: var(--accent-primary); }
        .specialty-card:hover .icon, .facility-type-card:hover .icon, .plc-card:hover .icon { color: var(--accent-primary); transform: scale(1.18); }
        .plc-card:hover .plc-photo { transform: scale(1.05); }

        /* --- Selected Card Style --- */
        .facility-type-card.card-selected, .plc-card.card-selected { border-color: var(--accent-primary-dark); box-shadow: 0 6px 12px var(--shadow-color-medium); background-color: var(--bg-accent-very-light); transform: translateY(-5px) scale(1.02); position: relative; }
        .facility-type-card.card-selected h4, .plc-card.card-selected h4 { color: var(--accent-primary-dark); font-weight: 700; }
        .facility-type-card.card-selected::after, .plc-card.card-selected::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; top: 8px; right: 8px; font-size: 0.8rem; color: var(--bg-primary); background-color: var(--accent-primary); border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; box-shadow: 0 1px 3px rgba(0,0,0,0.2); z-index: 2; animation: zoomIn 0.3s ease-out; }
        .facility-type-card.card-selected:hover, .plc-card.card-selected:hover { transform: translateY(-6px) scale(1.02); box-shadow: 0 8px 18px var(--shadow-color-medium); border-color: var(--accent-primary-dark); background-color: var(--bg-accent-very-light); }

        /* --- Trust Factors --- */
        .trust-factors-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; }
        .trust-factor { display: flex; align-items: flex-start; gap: 1.5rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.6); border-radius: 8px; transition: background-color 0.3s ease; border: 1px solid transparent; }
        .trust-factor:hover { background: var(--bg-primary); border-color: var(--border-color); }
        .trust-factor .icon { font-size: 2rem; color: var(--accent-primary); flex-shrink: 0; margin-top: 0.1rem; }
        .trust-factor h4 { font-size: 1.15rem; font-weight: 700; margin-bottom: 0.4rem; }
        .trust-factor p { color: var(--text-medium); font-size: 0.95rem; }

        /* --- Stats Section --- */
        .stats-section { background: var(--accent-primary); color: var(--text-light); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; text-align: center; }
        .stat-item { padding: 1rem; }
        .stat-item .icon { font-size: 2.8rem; margin-bottom: 1rem; opacity: 0.85; transition: transform 0.3s ease; }
        .stat-item:hover .icon { transform: scale(1.1); }
        .stat-item .stat-number { font-size: 2.8rem; font-weight: 700; font-family: 'Lato', sans-serif; margin-bottom: 0.3rem; }
        .stat-item .stat-label { font-size: 1rem; font-weight: 600; opacity: 0.9; }

        /* --- Site Reviews --- */
        .site-reviews-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 2rem; }
        .site-review-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-left: 4px solid var(--accent-primary-light); border-radius: 8px; padding: 2rem; position: relative; box-shadow: 0 4px 10px var(--shadow-color); transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease; display: flex; flex-direction: column; }
        .site-review-card:hover { transform: translateY(-8px); box-shadow: 0 10px 22px var(--shadow-color-medium); border-left-color: var(--accent-primary); }
        .site-review-card::before { content: '\f10d'; font-family: 'Font Awesome 6 Free'; font-weight: 900; font-size: 3rem; color: var(--accent-primary); opacity: 0.1; position: absolute; top: 0.8rem; left: 1.2rem; z-index: 0; }
        .site-review-card .stars { display: flex; gap: 4px; font-size: 1.3em; margin-bottom: 1.2rem; justify-content: flex-start; position: relative; z-index: 1; }
        .site-review-card .stars .fas.fa-star, .site-review-card .stars .fas.fa-star-half-alt { color: var(--accent-warm); }
        .site-review-card .stars .far.fa-star { color: var(--border-color-strong); }
        .site-review-comment { font-style: italic; color: var(--text-medium); margin-bottom: 1.5rem; position: relative; z-index: 1; flex-grow: 1; font-size: 1.05rem; }
        .site-review-author { display: flex; align-items: center; gap: 1rem; margin-top: auto; z-index: 1; padding-top: 1rem; border-top: 1px solid var(--border-color); }
        .site-review-author i { font-size: 1.5rem; color: var(--text-medium); width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background-color: var(--border-color); border-radius: 50%; flex-shrink: 0; }
        .site-review-author h5 { font-size: 1.05rem; font-weight: 700; margin: 0; color: var(--text-dark); }
        .site-review-author span { display: none; }

        /* --- Review Form --- */
        #site-review-form-section .form-container { max-width: 700px; margin: 0 auto; background-color: var(--bg-primary); padding: 3rem; border-radius: 12px; box-shadow: 0 6px 18px var(--shadow-color-medium); border: 1px solid var(--border-color); }
        #site-review-form-section h3 { text-align: center; font-size: 1.8rem; border-bottom: none; margin-bottom: 2.5rem; color: var(--text-dark); }
        #site-review-form-section h3::after { display: none; }
        #site-review-form-section .form-group { margin-bottom: 1.8rem; }
        #site-review-form-section label { font-weight: 600; margin-bottom: 0.6rem; display: block; color: var(--text-dark); }
        #site-review-form-section input[type="text"], #site-review-form-section textarea { width: 100%; padding: 0.9rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; background: var(--bg-primary); color: var(--text-dark); }
        #site-review-form-section textarea { min-height: 130px; resize: vertical; }
        #site-review-form-section .rating-input { display: flex; justify-content: center; align-items: center; gap: 8px; margin-bottom: 1.5rem; flex-direction: row-reverse; }
        #site-review-form-section .rating-input input[type="radio"] { display: none; }
        #site-review-form-section .rating-input label { font-size: 2rem; color: var(--border-color-strong); cursor: pointer; transition: color 0.2s ease, transform 0.2s ease; }
        #site-review-form-section .rating-input label:hover { transform: scale(1.15); }
        #site-review-form-section .rating-input input[type="radio"]:checked ~ label, #site-review-form-section .rating-input label:hover ~ label { color: var(--accent-warm); transform: scale(1.15); }
        #site-review-form button[type="submit"] { background-color: var(--accent-primary-dark); width: 100%; }

        /* --- Doctors Grid --- */
        .doctors-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.8rem; align-items: stretch; }

        /* --- Doctor Card --- */
        .doctor-card { cursor: pointer; background: var(--bg-primary); border-radius: 10px; overflow: hidden; border: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 1.2rem; transition: transform var(--transition-speed) var(--transition-ease), box-shadow var(--transition-speed) var(--transition-ease), border-color var(--transition-speed) var(--transition-ease); box-shadow: 0 4px 10px var(--shadow-color); height: 100%; }
        .doctor-card:hover { transform: translateY(-6px); border-color: var(--accent-primary-light); box-shadow: 0 10px 20px var(--shadow-color-medium); }
        .doctor-card-top { display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1rem; width: 100%; }
        .doctor-photo { width: 75px; height: 75px; border-radius: 50%; object-fit: cover; display: block; flex-shrink: 0; border: 2px solid var(--border-color); transition: border-color var(--transition-speed) var(--transition-ease), transform var(--transition-speed) var(--transition-ease); }
        .doctor-card:hover .doctor-photo { border-color: var(--accent-primary); transform: scale(1.05); }
        .doctor-primary-info { display: flex; flex-direction: column; align-items: flex-start; flex-grow: 1; min-width: 0; line-height: 1.4; }
        .doctor-primary-info h3 { color: var(--text-dark); margin-bottom: 0.15rem; font-size: 1.15rem; font-weight: 700; transition: color var(--transition-speed) var(--transition-ease); }
        .doctor-card:hover .doctor-primary-info h3 { color: var(--accent-primary-dark); }
        .doctor-primary-info .specialization { color: var(--accent-primary); font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .doctor-primary-info .rating-display { display: flex; align-items: center; gap: 0.4rem; margin-bottom: 0; font-size: 0.85rem; }
        .doctor-primary-info .rating-display .stars { display: flex; gap: 2px; font-size: 1em; }
        .doctor-primary-info .rating-display .stars .fas.fa-star, .doctor-primary-info .rating-display .stars .fas.fa-star-half-alt { color: var(--accent-warm); }
        .doctor-primary-info .rating-display .stars .far.fa-star { color: var(--border-color-strong); }
        .doctor-primary-info .rating-display .review-count { color: var(--text-medium); font-size: 0.8rem; }
        .doctor-primary-info .rating-display .no-reviews { font-style: italic; color: var(--text-medium); font-size: 0.8rem; }
        .doctor-info { padding-top: 1rem; border-top: 1px solid var(--border-color); width: 100%; display: flex; flex-direction: column; flex-grow: 1; margin-top: auto; }
        .doctor-info-columns { display: flex; width: 100%; gap: 1rem; margin-bottom: 1rem; flex-grow: 1; }
        .doctor-info-left { flex: 1 1 55%; display: flex; flex-direction: column; min-width: 0; }
        .doctor-details { font-size: 0.85rem; color: var(--text-medium); line-height: 1.5; margin-bottom: 0; width: 100%; text-align: left; }
        .doctor-details p { margin-bottom: 0.4rem; display: flex; align-items: center; justify-content: flex-start; }
        .doctor-details i { margin-right: 0.6rem; color: var(--accent-primary-light); width: 1.3em; text-align: center; transition: color var(--transition-speed) var(--transition-ease); flex-shrink: 0; }
        .doctor-card:hover .doctor-details i { color: var(--accent-primary); }
        .doctor-details i.fa-map-pin, .doctor-details i.fa-map-marker-alt, .doctor-details i.fa-hospital, .doctor-details i.fa-clinic-medical { color: var(--accent-primary); }
        .doctor-details p:last-child { margin-bottom: 0; }
        .vertical-divider { border-left: 1px solid var(--border-color); align-self: stretch; margin: 0 0.2rem; }
        .doctor-info-right { flex: 1 1 40%; display: flex; flex-direction: column; min-width: 0; }
        .availability-details { font-size: 0.85rem; color: var(--text-medium); margin-bottom: 0; width: 100%; text-align: left; }
        .availability-details .availability-title { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: var(--text-dark); margin-bottom: 0.4rem; }
        .availability-details .availability-title i { color: var(--accent-primary); font-size: 1em; }
        .availability-details p { margin-bottom: 0.3rem; padding-left: 0; line-height: 1.4; }
        .availability-details p:last-child { margin-bottom: 0; }
        .book-btn { margin-top: auto; padding-top: 0.8rem; width: auto; font-size: 0.9rem; padding: 0.5rem 1.2rem; align-self: flex-start; }

        /* --- No Results Message --- */
        #noResultsMessage { color: var(--text-medium); text-align: center; padding: 6rem 1rem; font-size: 1.15rem; display: none; }
        #noResultsMessage i { display: block; font-size: 4rem; margin-bottom: 1.5rem; color: var(--border-color-strong); animation: zoomIn 0.8s ease-out; }
        #noResultsMessage p { line-height: 1.6; }

        /* --- Footer --- */
        .footer { background: #1A202C; color: #a0aec0; padding: 5rem 5% 2rem; margin-top: 0; border-top: 5px solid var(--accent-primary); }
        .footer-content { max-width: 1280px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 3.5rem; margin-bottom: 4rem; }
        .footer-section h3 { color: var(--text-light); margin-bottom: 1.5rem; font-size: 1.25rem; font-weight: 700; position: relative; padding-bottom: 0.7rem; }
        .footer-section h3::after { content: ''; position: absolute; bottom: 0; left: 0; width: 45px; height: 3px; background-color: var(--accent-primary); border-radius: 1px; }
        .footer-section p { font-size: 0.95rem; line-height: 1.7; margin-bottom: 1rem; }
        .footer-links { display: flex; flex-direction: column; gap: 0.9rem; }
        .footer-links a { color: #cbd5e0; text-decoration: none; transition: color var(--transition-speed) var(--transition-ease), padding-left var(--transition-speed) var(--transition-ease), transform var(--transition-speed) var(--transition-ease); display: flex; align-items: center; gap: 0.7rem; }
        .footer-links a i { font-size: 0.8em; opacity: 0.7; transition: opacity 0.3s ease; }
        .footer-links a:hover { color: var(--text-light); padding-left: 8px; transform: translateX(2px); text-decoration: none; }
        .footer-links a:hover i { opacity: 1; }
        .social-links { display: flex; gap: 1.3rem; margin-top: 1.5rem; }
        .social-links a { font-size: 1.6rem; color: #cbd5e0; transition: color var(--transition-speed) var(--transition-ease), transform var(--transition-speed) var(--transition-ease); }
        .social-links a:hover { color: var(--accent-primary-light); transform: translateY(-4px) rotate(-5deg); }
        .copyright { text-align: center; padding-top: 2.5rem; border-top: 1px solid #4a5568; color: #a0aec0; font-size: 0.9rem; }

        /* --- Flash Messages --- */
        .flash-messages { position: fixed; top: 90px; right: 20px; z-index: 1050; width: clamp(300px, 90%, 420px); }
        .flash-message { padding: 1rem 1.5rem; margin-bottom: 1rem; border-radius: 8px; font-weight: 600; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.18); opacity: 0; transform: translateX(100%); animation: slideInFadeOut 5s ease-in-out forwards; border: 1px solid transparent; display: flex; align-items: center; gap: 1rem; background-color: var(--bg-primary); }
        .flash-message::before { font-family: "Font Awesome 6 Free"; font-weight: 900; font-size: 1.3em; }
        .flash-message.success { border-left: 6px solid var(--success); color: #046c4e; }
        .flash-message.success::before { content: '\f058'; color: var(--success); }
        .flash-message.error { border-left: 6px solid var(--error); color: #9b1c1c; }
        .flash-message.error::before { content: '\f071'; color: var(--error); }
        .flash-message.info { border-left: 6px solid var(--info); color: #1e40af; }
        .flash-message.info::before { content: '\f05a'; color: var(--info); }
        @keyframes slideInFadeOut { 0% { opacity: 0; transform: translateX(100%); } 10% { opacity: 1; transform: translateX(0); } 90% { opacity: 1; transform: translateX(0); } 100% { opacity: 0; transform: translateX(100%); } }

        /* --- Floating 'Go to Results' Button --- */
        #goToResultsBtn { position: fixed; bottom: 25px; right: 25px; z-index: 999; background-color: var(--accent-primary-dark); color: var(--text-light); border: none; border-radius: 8px; padding: 0.7rem 1.2rem; font-size: 0.95rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0, 50, 50, 0.25); display: inline-flex; align-items: center; gap: 0.6rem; transition: transform var(--transition-speed) var(--transition-ease), background-color var(--transition-speed) var(--transition-ease); }
        #goToResultsBtn:hover { background-color: var(--accent-primary); transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0, 50, 50, 0.3); }
        #goToResultsBtn:focus-visible { outline: 2px solid var(--accent-primary); outline-offset: 3px; box-shadow: 0 4px 12px rgba(0, 50, 50, 0.25), 0 0 0 3px rgba(0, 122, 122, 0.25); }

        /* --- Responsive Design --- */
        @media (max-width: 1024px) {
             /* Card Grid Adjustments */
             .featured-facility-types-grid { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1.5rem; }
             .featured-plcs-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }

            .doctors-grid { gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
            .doctor-card { padding: 1.1rem; }
            .doctor-photo { width: 70px; height: 70px; }
            .doctor-card-top { gap: 0.9rem; margin-bottom: 0.9rem;}
            .doctor-primary-info h3 { font-size: 1.1rem;}
            .doctor-info { padding-top: 0.9rem;}
            .doctor-info-columns { gap: 1rem; }
            .doctor-details { font-size: 0.83rem;}
            .availability-details { font-size: 0.83rem; }
            .book-btn { font-size: 0.88rem; }
            .search-button-container .btn { min-width: 130px; padding: 0.8rem 1.5rem; }
        }

        @media (max-width: 768px) {
             /* Card Grid Adjustments */
             .featured-facility-types-grid { grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; }
             .featured-plcs-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
             .facility-type-card { min-height: 130px; }
             .plc-card { min-height: 220px; }
             .plc-photo { height: 110px; }

            .doctors-grid { grid-template-columns: 1fr; gap: 1.2rem;}
            .doctor-photo { width: 65px; height: 65px; }
            .doctor-card-top { gap: 0.8rem; margin-bottom: 0.8rem;}
            .doctor-primary-info h3 { font-size: 1.05rem;}
            .doctor-info { padding-top: 0.8rem; }
            .doctor-info-columns { flex-direction: column; gap: 0.8rem; margin-bottom: 1rem; }
            .doctor-info-left, .doctor-info-right { flex-basis: auto; width: 100%; }
            .vertical-divider { display: none; }
             .availability-details { margin-top: 0.2rem; }
             .doctor-details { margin-bottom: 0.5rem;}
            .book-btn { align-self: center; margin-top: 1rem; }
            .search-button-container { max-width: 400px; margin-left: auto; margin-right: auto; }
            .search-button-container .btn { flex-grow: 1; flex-basis: 0; }
            #goToResultsBtn { font-size: 0.85rem; padding: 0.6rem 1rem; bottom: 20px; right: 20px; gap: 0.5rem; }
            .featured-facility-types-section .section-title { font-size: 1.8rem; } /* Non-collapsible title */
            .collapsible-title { font-size: 1.3rem; } /* Smaller collapsible title */
             .collapsible-header { padding: 1rem 1.2rem; }
             .collapsible-content { padding-left: 1.2rem; padding-right: 1.2rem; }
             .collapsible-section.is-open .collapsible-content { padding-top: 1.5rem; padding-bottom: 1.5rem; }

        }

        @media (max-width: 480px) {
             /* --- Navbar Responsive Adjustments --- */
             .navbar { padding: 0.8rem 5%; } /* Slightly more padding on mobile */
             .navbar.scrolled { padding: 0.6rem 5%; }
             .logo { font-size: 1.5rem; gap: 0.4rem; } /* Smaller logo */
             .logo i { font-size: 1.3rem; }
             .nav-login-buttons {
                 flex-direction: column; /* Stack buttons */
                 align-items: flex-end; /* Align to the right */
                 gap: 0.6rem; /* Space between stacked buttons */
                 margin-left: 1rem; /* Ensure some space from logo */
             }
             .nav-login-buttons .btn {
                 width: auto; /* Allow button to size naturally */
                 min-width: 110px; /* Ensure minimum tappable width */
                 font-size: 0.85rem; /* Smaller text */
                 padding: 0.5rem 1rem; /* Adjust padding */
                 text-align: center; /* Center text */
             }
             /* Optionally hide 'For Providers' if really needed, but often better to keep */
             /* .nav-login-buttons .btn-secondary { display: none; } */


             /* Card Grid Adjustments */
            .featured-facility-types-grid { grid-template-columns: repeat(2, 1fr); gap: 0.8rem; } /* Force 2 columns */
             .featured-plcs-grid { grid-template-columns: repeat(2, 1fr); gap: 0.8rem; } /* Force 2 columns */
             .facility-type-card { min-height: 120px; padding: 0.6rem; }
             .facility-type-card .icon { font-size: 1.8rem; }
             .facility-type-card h4 { font-size: 0.85rem; }
             .plc-card { min-height: 190px; }
             .plc-photo { height: 90px; margin-bottom: 0.5rem; }
             .plc-card h4 { font-size: 0.9rem; padding: 0 0.6rem; }
             .plc-details-button-container { padding: 0 0.6rem 0.6rem 0.6rem; margin-top: 0.5rem; }
             .btn-small.plc-details-btn { font-size: 0.75rem; padding: 0.3rem 0.7rem; }

            .doctors-grid { gap: 1rem; }
            .doctor-card { padding: 0.9rem; }
             .doctor-card-top { gap: 0.7rem; margin-bottom: 0.7rem; }
             .doctor-photo { width: 60px; height: 60px; }
             .doctor-primary-info h3 { font-size: 1rem; }
             .doctor-primary-info .specialization { font-size: 0.8rem; margin-bottom: 0.3rem; }
             .doctor-primary-info .rating-display { font-size: 0.8rem; }
             .doctor-info { padding-top: 0.7rem;}
             .doctor-info-columns { gap: 0.6rem; }
             .doctor-details { font-size: 0.8rem; }
             .availability-details { font-size: 0.8rem; }
             .book-btn { font-size: 0.85rem; padding: 0.4rem 1rem; }
             .search-button-container { flex-direction: column; align-items: center; max-width: 300px; }
             .search-button-container .btn { width: 100%; max-width: 300px; flex-grow: 0; }
             .collapsible-header { padding: 1rem 1.2rem;}
             .collapsible-title { font-size: 1.2rem; }
             .collapsible-icon { font-size: 1rem;}
             .collapsible-content { padding-left: 1.2rem; padding-right: 1.2rem; }
             .collapsible-section.is-open .collapsible-content { padding-top: 1.5rem; padding-bottom: 1.5rem; }
             .featured-facility-types-section .section-title { font-size: 1.5rem; margin-bottom: 2rem;}
             #goToResultsBtn { /* Slightly smaller floating button */
                padding: 0.5rem 0.9rem;
                font-size: 0.8rem;
                gap: 0.4rem;
                bottom: 15px;
                right: 15px;
            }
             #goToResultsBtn .fa-arrow-down { /* Ensure icon isn't too large */
                 font-size: 1em;
            }

        }

    </style>

</head>
<body>

    <!-- Flash Messages Container -->
    <div class="flash-messages">
        {# Flask/Jinja specific: Render flashed messages passed from the backend #}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    {% set category_class = category if category in ['success', 'error', 'info'] else 'info' %}
                    <div class="flash-message {{ category_class }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>
    <!-- Flash Messages Container End -->

    <!-- Navbar Start -->
    <nav class="navbar" id="navbar">
        <a href="/" class="logo"><i class="fas fa-heart-pulse"></i> CareConnect</a>
        <!-- Login Buttons Container -->
        <div class="nav-login-buttons">
            <button class="btn btn-secondary btn-small" onclick="window.location.href='/doctor-login'">For Providers</button> <!-- Made slightly smaller -->
            <button class="btn btn-primary btn-small" onclick="window.location.href='/patient-login'">Patient Login</button> <!-- Made slightly smaller -->
        </div>
    </nav>
    <!-- Navbar End -->

    <!-- Hero Section Start -->
    <section class="hero-section" id="search-section">

             <h1 class="hero-title">Find & Book <span>Clinic Appointments</span>, Effortlessly.</h1>
             <p class="hero-subtitle">Access a network of trusted doctors and specialists near you. Your health journey starts here.</p>
             <div class="typing-effect-container"> <span id="text"></span> </div>

                <div class="container"> <!-- Container for search area -->
                    <!-- Collapsible Clinics/Centers Section -->
                    <div class="collapsible-section">
                       <button type="button" class="collapsible-header" aria-expanded="false" aria-controls="plcs-content">
                           <h3 class="collapsible-title">Explore Clinics & Centers</h3>
                           <i class="fas fa-chevron-down collapsible-icon"></i>
                       </button>
                       <div class="collapsible-content" id="plcs-content">
                            <!-- Add an inner wrapper for grid transition -->
                            <div class="collapsible-content-inner">
                                <h2 class="section-title reveal-on-scroll" style="font-size: 1.6rem; margin-bottom: 2rem;">Explore Facility Types</h2>
                                <div class="featured-facility-types-grid">
                                    {% if facility_types %}
                                       {% for f_type in facility_types %}
                                            <div class="facility-type-card reveal-on-scroll" data-facility-type="{{ f_type }}" onclick="setFacilityTypeFilterAndSearch('{{ f_type }}', this)" role="button" tabindex="0" aria-pressed="false">
                                                {% set icon_class = 'fas fa-clinic-medical' %}
                                                {% if 'hospital' in f_type|lower %}{% set icon_class = 'fas fa-hospital' %} {% elif 'clinic' in f_type|lower %}{% set icon_class = 'fas fa-clinic-medical' %} {% elif 'center' in f_type|lower or 'centre' in f_type|lower or 'hub' in f_type|lower %}{% set icon_class = 'fas fa-building' %} {% elif 'post' in f_type|lower %}{% set icon_class = 'fas fa-plus-square' %} {% elif 'lab' in f_type|lower %}{% set icon_class = 'fas fa-flask-vial' %} {% endif %}
                                                <i class="{{ icon_class }} icon"></i> <h4>{{ f_type }}</h4>
                                            </div>
                                       {% endfor %}
                                    {% else %} <p class="section-subtitle" style="grid-column: 1 / -1;">Could not load facility types.</p> {% endif %}
                                </div>

                                <h2 class="section-title reveal-on-scroll" style="font-size: 1.6rem; margin-top: 3rem; margin-bottom: 2rem;">Featured Clinics</h2>
                               <div class="featured-plcs-grid">
                                   {% if plcs %}
                                       {% for plc in plcs %}
                                           {% set plc_slug = plc | lower | replace(' ', '_') | replace('&', 'and') | replace('.', '') | replace("'", '') %}
                                           <div class="plc-card reveal-on-scroll" data-plc-name="{{ plc }}" onclick="setPlcFilterAndSearch('{{ plc }}', this)" role="button" tabindex="0" aria-pressed="false">
                                                <img src="{{ url_for('static', filename='plc_photos/' + plc_slug + '.jpg') }}" alt="Photo of {{ plc }}" class="plc-photo" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                                <i class="fas fa-hospital-user icon" style="display: none;"></i> <!-- Fallback Icon -->
                                                <h4>{{ plc }}</h4>
                                                <div class="plc-details-button-container">
                                                    <a href="{{ url_for('center_details', plc_name=plc) }}" class="btn btn-secondary btn-small plc-details-btn" onclick="event.stopPropagation();"><i class="fas fa-info-circle"></i> View Details</a>
                                                </div>
                                            </div>
                                       {% endfor %}
                                   {% else %}
                                       <p class="section-subtitle" style="grid-column: 1 / -1;">Could not load clinics.</p>
                                   {% endif %}
                               </div>
                               <div class="clear-filter-button-container">
                                   <button class="btn btn-secondary" onclick="clearPlcFilterAndSearch()">View All Clinics & Centers</button>
                               </div>
                            </div> <!-- End .collapsible-content-inner -->
                        </div> <!-- End .collapsible-content -->
                   </div> <!-- End .collapsible-section -->

                    <!-- Doctor Search Form Area -->
                    <div> <!-- Removed extra div -->
                        <h2 class="section-title" style="margin-bottom: 1.5rem; font-size: 1.6rem;">Find Your Doctor</h2>
                        <form class="search-form" id="searchForm" onsubmit="event.preventDefault(); searchDoctors(null, false, true);">
                            <div class="input-group"> <i class="fas fa-map-location-dot"></i> <select id="province" aria-label="Select Province"> <option value="">All Provinces</option> {% for prov in ['Bagmati', 'Gandaki', 'Lumbini', 'Koshi', 'Madhesh', 'Sudurpashchim', 'Karnali'] %} <option value="{{ prov }}">{{ prov }}</option> {% endfor %} </select> </div>
                            <div class="input-group"> <i class="fas fa-map-pin"></i> <select id="governorate" aria-label="Select Governorate"> <option value="">All Governorates</option> {% if governorates %} {% for gov in governorates %} <option value="{{ gov }}">{{ gov }}</option> {% endfor %} {% else %} <option value="" disabled>Loading...</option> {% endif %} </select> </div>
                            <div class="input-group"> <i class="fas fa-stethoscope"></i> <select id="specialization" aria-label="Select Specialization"> <option value="">All Specialties</option> {% if specialties %} {% for spec in specialties %} <option value="{{ spec }}">{{ spec }}</option> {% endfor %} {% else %} <option value="" disabled>Loading...</option> {% endif %} </select> </div>
                            <div class="input-group"> <i class="fas fa-hospital"></i> <select id="facilityType" aria-label="Select Facility Type"> <option value="">All Facility Types</option> {% if facility_types %} {% for f_type in facility_types %} <option value="{{ f_type }}">{{ f_type }}</option> {% endfor %} {% else %} <option value="" disabled>Loading...</option> {% endif %} </select> </div>
                            <div class="input-group"> <i class="fas fa-user-doctor"></i> <input type="text" id="doctorName" placeholder="Doctor, Clinic Name..." aria-label="Doctor or Clinic Name"> </div>
                        </form>
                        <div class="search-button-container">
                            <button type="button" class="btn btn-primary search-btn" onclick="searchDoctors(null, false, true)"><i class="fas fa-search"></i> Find Care</button>
                            <button type="button" id="clearFiltersBtn" class="btn btn-secondary" onclick="clearAllFilters()"><i class="fas fa-eraser"></i> Clear Filters</button>
                        </div>
                    </div>
                </div> <!-- End .container for search -->
   </section>
    <!-- Hero Section End -->

    <!-- Featured PLCs Section Placeholder (Content now inside collapsible) -->
    <section class="featured-plcs-section section-padding-sm" style="padding-top: 0; padding-bottom: 0; height: 0; overflow: hidden;">
        <!-- Content moved into the collapsible section above -->
    </section>
    <!-- Featured PLCs Section End -->

    <!-- Doctors Results Section Start -->
    <section class="doctors-section section-padding" id="doctors-results">
        <div class="container">
            <h2 class="section-title" id="resultsTitle" style="display: none;">Available Doctors</h2>
            <div class="doctors-grid" id="resultsContainer" aria-live="polite">
                <!-- Doctor cards will be inserted here by JavaScript -->
            </div>
            <div id="noResultsMessage" style="display: none;" aria-live="assertive">
                <i class="fas fa-user-times"></i>
                <p>We couldn't find doctors matching your criteria.<br>Try adjusting the filters above or clear them.</p>
            </div>
         </div>
    </section>
    <!-- Doctors Results Section End -->

    <!-- How It Works Section Start -->
    <section class="how-it-works-section section-padding">
        <div class="container">
            <h2 class="section-title reveal-on-scroll">Booking in 3 Simple Steps</h2> <p class="section-subtitle reveal-on-scroll">Finding healthcare is easier than ever.</p>
            <div class="how-it-works-grid-standalone">
                 <div class="how-it-works-step reveal-on-scroll"> <i class="fas fa-search-location icon"></i> <h3>1. Search & Filter</h3> <p>Use location, specialty, facility type, or name.</p> </div>
                 <div class="how-it-works-step reveal-on-scroll"> <i class="fas fa-calendar-check icon"></i> <h3>2. Select & Book</h3> <p>See real-time slots and book instantly.</p> </div>
                 <div class="how-it-works-step reveal-on-scroll"> <i class="fas fa-notes-medical icon"></i> <h3>3. Visit Clinic</h3> <p>Attend your appointment and manage bookings online.</p> </div>
            </div>
        </div>
    </section>
    <!-- How It Works Section End -->

     <!-- Trust Factors Section Start -->
    <section class="trust-factors-section section-padding">
        <div class="container">
            <h2 class="section-title reveal-on-scroll">Why Choose CareConnect?</h2>
            <div class="trust-factors-grid">
                <div class="trust-factor reveal-on-scroll reveal-left"> <i class="fas fa-user-shield icon"></i> <div> <h4>Verified Professionals</h4> <p>Connect with licensed doctors and specialists vetted for quality.</p> </div> </div>
                <div class="trust-factor reveal-on-scroll reveal-right"> <i class="fas fa-calendar-alt icon"></i> <div> <h4>Easy Online Booking</h4> <p>Schedule appointments 24/7, hassle-free, from any device.</p> </div> </div>
                <div class="trust-factor reveal-on-scroll reveal-left"> <i class="fas fa-clock icon"></i> <div> <h4>Real-Time Availability</h4> <p>See instantly available slots and secure your appointment right away.</p> </div> </div>
                <div class="trust-factor reveal-on-scroll reveal-right"> <i class="fas fa-lock icon"></i> <div> <h4>Secure & Private</h4> <p>Your health information is kept confidential and secure.</p> </div> </div>
            </div>
        </div>
    </section>
    <!-- Trust Factors Section End -->

    <!-- Stats Section Start -->
    <section class="stats-section section-padding-sm">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item reveal-on-scroll reveal-zoom"> <i class="fas fa-user-doctor icon"></i> <div class="stat-number" data-target="{{ stats.doctor_count | default(0) }}">{{ stats.doctor_count | default(0) }}</div> <div class="stat-label">Verified Doctors</div> </div>
                <div class="stat-item reveal-on-scroll reveal-zoom"> <i class="fas fa-stethoscope icon"></i> <div class="stat-number" data-target="{{ stats.specialty_count | default(0) }}">{{ stats.specialty_count | default(0) }}</div> <div class="stat-label">Specialties Available</div> </div>
                <div class="stat-item reveal-on-scroll reveal-zoom"> <i class="fas fa-calendar-check icon"></i> <div class="stat-number" data-target="{{ stats.total_bookings | default(0) }}">{{ stats.total_bookings | default(0) }}</div> <div class="stat-label">Appointments Booked</div> </div>
                <div class="stat-item reveal-on-scroll reveal-zoom"> <i class="fas fa-star icon"></i> <div class="stat-number" data-target="{{ stats.review_count | default(0) }}">0</div> <div class="stat-label">Patient Reviews</div> </div>
            </div>
        </div>
    </section>
    <!-- Stats Section End -->

    <!-- Site Reviews Display Section Start -->
<section class="site-reviews-section section-padding" id="site-reviews-section">
    <div class="container">
        <h2 class="section-title reveal-on-scroll">What People Say About CareConnect</h2>
        <p class="section-subtitle reveal-on-scroll">General feedback about our platform and service.</p>
        <div class="site-reviews-grid">
            {# --- Check 1: Is site_reviews even defined and not empty? --- #}
            {% if site_reviews and site_reviews|length > 0 %}
                {# --- Check 2: Loop variable name matches --- #}
                {% for review in site_reviews %}
                    <div class="site-review-card reveal-on-scroll">
                        <div class="stars" title="{{ review.rating }}/5 Stars">
                            {# --- Check 3: Custom function access --- #}
                            {% set stars = get_stars(review.rating) %} {# Call function explicitly #}
                            {% if stars %} {# Check if function returned something #}
                                {% for star_class in stars %} <i class="{{ star_class }}"></i> {% endfor %}
                            {% else %}
                                <span>(Rating: {{ review.rating }})</span> {# Fallback #}
                            {% endif %}
                        </div>
                        {# --- Check 4: Attribute names match data --- #}
                        <p class="site-review-comment">"{{ review.comment | default('No comment provided.') | truncate(250) }}"</p>
                        <div class="site-review-author">
                            <i class="fas fa-user-check"></i>
                            <div class="author-info">
                                <h5>{{ review.reviewer_name | default('Verified User') | title }}</h5>
                            </div>
                        </div>
                    </div>
                {% endfor %} {# End of the loop #}
            {% else %} {# If site_reviews is empty or not defined #}
                <p class="section-subtitle" style="grid-column: 1 / -1; margin-top: 2rem;">No platform feedback submitted yet. Be the first to share your thoughts!</p>
            {% endif %} {# End of the main if #}
        </div>
    </div>
</section>
<!-- Site Reviews Display Section End -->

    <!-- Site Review FORM Section Start -->
    <section class="section-padding" id="site-review-form-section">
        <div class="container">
            <div class="form-container reveal-on-scroll">
                 <h3>Share Your Feedback About CareConnect</h3>
                 <form id="site-review-form" method="POST" action="{{ url_for('submit_site_review') }}">
                    <div class="form-group"> <label for="siteReviewerName">Your Name:</label> <input type="text" id="siteReviewerName" name="reviewer_name" required placeholder="E.g., Jane D."> </div>
                    <div class="form-group"> <label>Overall Rating:</label> <div class="rating-input"> <input type="radio" id="siteStar5" name="rating" value="5" required><label for="siteStar5" title="5 stars - Excellent"></label> <input type="radio" id="siteStar4" name="rating" value="4"><label for="siteStar4" title="4 stars - Good"></label> <input type="radio" id="siteStar3" name="rating" value="3"><label for="siteStar3" title="3 stars - Average"></label> <input type="radio" id="siteStar2" name="rating" value="2"><label for="siteStar2" title="2 stars - Fair"></label> <input type="radio" id="siteStar1" name="rating" value="1"><label for="siteStar1" title="1 star - Poor"></label> </div> </div>
                    <div class="form-group"> <label for="siteComment">Your Comments (Optional):</label> <textarea id="siteComment" name="comment" rows="5" placeholder="Tell us about your experience using the CareConnect platform..." maxlength="1000"></textarea> </div>
                    <button type="submit" class="btn btn-primary"> <i class="fas fa-paper-plane"></i> Submit Feedback </button>
                 </form>
             </div>
         </div>
    </section>
    <!-- Site Review FORM Section End -->

    <!-- Footer Start -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section reveal-on-scroll"> <h3><i class="fas fa-heart-pulse"></i> CareConnect</h3> <p>Simplifying access to healthcare. Find and book trusted doctors near you.</p> <p><i class="fas fa-phone" style="margin-right: 0.5rem;"></i> +977-1-XXXXXX</p> <p><i class="fas fa-envelope" style="margin-right: 0.5rem;"></i> support@careconnect.com</p> </div>
                <div class="footer-section reveal-on-scroll"> <h3>Quick Links</h3> <div class="footer-links"> <a href="/"><i class="fas fa-home"></i> Home</a> <a href="#search-section"><i class="fas fa-search"></i> Find Doctor</a> <a href="/patient-login"><i class="fas fa-user-circle"></i> Patient Portal</a> <a href="#"><i class="fas fa-question-circle"></i> FAQs</a> <a href="#site-reviews-section"><i class="fas fa-comments"></i> Feedback</a> </div> </div>
                <div class="footer-section reveal-on-scroll"> <h3>For Providers</h3> <div class="footer-links"> <a href="/doctor-login"><i class="fas fa-clinic-medical"></i> Provider Login</a> <a href="#"><i class="fas fa-notes-medical"></i> List Practice</a> <a href="#"><i class="fas fa-cogs"></i> Features</a> <a href="#"><i class="fas fa-hands-helping"></i> Partnership</a> </div> </div>
                <div class="footer-section reveal-on-scroll"> <h3>Follow Us</h3> <p>Stay updated:</p> <div class="social-links"> <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a> <a href="#" aria-label="Twitter"><i class="fab fa-x-twitter"></i></a> <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a> </div> <h3 style="margin-top: 1.5rem;">Legal</h3> <div class="footer-links"> <a href="#"><i class="fas fa-user-shield"></i> Privacy Policy</a> <a href="#"><i class="fas fa-file-contract"></i> Terms of Service</a> </div> </div>
            </div>
        </div>
        <div class="copyright">  <span id="copyright-year"></span> CareConnect Nepal. All Rights Reserved. </div>
    </footer>
    <!-- Footer End -->

    <!-- Floating "Go to Results" Button -->
     <button id="goToResultsBtn" aria-label="Go to Search Results" title="Go to Search Results">
         <i class="fas fa-arrow-down"></i> Go to Results
     </button>

    <!-- JavaScript Start -->
    <script>
        /**
         * CareConnect Frontend Script
         * Handles: Navbar scroll, Dynamic content (Doctors), Card selections, Animations, Forms, Initialization, Collapsible Sections, Floating Button, Doctor Sorting.
         */

        // --- Constants & Global Variables ---
        const SCROLL_THRESHOLD = 50;
        const STAGGER_BASE_DELAY = 100; // Slightly faster stagger
        const COUNTER_ANIMATION_DURATION = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--counter-animation-duration').trim() || '1500', 10);
        const DEBOUNCE_DELAY = 400;

        let intersectionObserver;
        let searchTimeoutId = null;
        let currentSelectedFacilityType = null;
        let currentSelectedPlcName = null;
        let isInitialLoadSearch = true;

        // --- Backend Data ---
        // Ensure allDoctorsData is treated as an array, even if empty
        const allDoctorsData = Array.isArray({{ doctors | default([]) | tojson | safe }}) ? {{ doctors | default([]) | tojson | safe }} : [];
        const allGovernorates = {{ governorates | tojson | safe if governorates else '[]' }};
        const allSpecialties = {{ specialties | tojson | safe if specialties else '[]' }};
        const allFacilityTypes = {{ facility_types | tojson | safe if facility_types else '[]' }};
        const allPlcs = {{ plcs | tojson | safe if plcs else '[]' }};
        const pageStats = {{ stats | tojson | safe if stats else '{}' }};

        // --- DOM Element References ---
        const navbar = document.getElementById('navbar');
        const copyrightYearEl = document.getElementById('copyright-year');
        const resultsContainer = document.getElementById('resultsContainer');
        const noResultsMessage = document.getElementById('noResultsMessage');
        const resultsTitle = document.getElementById('resultsTitle');
        const resultsSection = document.getElementById('doctors-results');
        const heroSection = document.getElementById('search-section');
        const textElement = document.getElementById("text");
        const doctorNameInput = document.getElementById('doctorName');
        const facilityTypeSelect = document.getElementById('facilityType');
        const specializationSelect = document.getElementById('specialization');
        const governorateSelect = document.getElementById('governorate');
        const provinceSelect = document.getElementById('province');
        const searchButton = document.querySelector('.search-btn');
        const clearFiltersButton = document.getElementById('clearFiltersBtn');
        const collapsibleHeaders = document.querySelectorAll('.collapsible-header');
        const goToResultsBtn = document.getElementById('goToResultsBtn');


        // --- Navbar Scroll Effect & Copyright Year ---
        if (navbar) { window.addEventListener('scroll', () => navbar.classList.toggle('scrolled', window.scrollY > SCROLL_THRESHOLD)); }
        if (copyrightYearEl) { copyrightYearEl.textContent = new Date().getFullYear(); }


        // --- Collapsible Section Logic (Using Grid for Smooth Height) ---
        collapsibleHeaders.forEach(header => {
            header.addEventListener('click', () => {
                const section = header.closest('.collapsible-section');
                if (!section) return;
                const icon = header.querySelector('.collapsible-icon');
                const isOpen = section.classList.contains('is-open');

                header.setAttribute('aria-expanded', !isOpen);

                if (isOpen) {
                    section.classList.remove('is-open');
                    if(icon) icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                } else {
                    section.classList.add('is-open');
                    if(icon) icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                    // Re-observe newly visible elements inside the content
                    const contentInner = section.querySelector('.collapsible-content-inner');
                    if (intersectionObserver && contentInner) {
                         contentInner.querySelectorAll('.reveal-on-scroll:not(.is-visible)').forEach(el => intersectionObserver.observe(el));
                    }
                }
            });
        });


         // --- Floating "Go to Results" Button Logic ---
         if (goToResultsBtn) {
             goToResultsBtn.addEventListener('click', () => {
                if (resultsSection) { resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); }
            });
         }


        // --- Debounced Search Function ---
        function searchDoctorsDebounced() { clearTimeout(searchTimeoutId); searchTimeoutId = setTimeout(() => searchDoctors(null, false, false), DEBOUNCE_DELAY); }


        // --- Doctor Search/Filter ---
        function searchDoctors(event = null, isInitial = false, triggerScroll = false) {
             // console.log("Attempting search..."); // DEBUG

             // Check if data is ready
             if (!allDoctorsData) {
                console.error("Doctor data is not available yet.");
                // Optionally disable button permanently or show a message
                 return;
             }
             if (!Array.isArray(allDoctorsData)) { // FIX: Ensure it's an array
                console.error("Doctor data is not an array:", allDoctorsData);
                return;
             }

             // Prevent multiple rapid clicks
            if ((searchButton && searchButton.disabled) && !isInitial) return;

             // Disable buttons immediately
            if (searchButton) { searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...'; searchButton.disabled = true; }
            if (clearFiltersButton) clearFiltersButton.disabled = true;

            isInitialLoadSearch = isInitial; // Track if this is the very first page load search
            const province = provinceSelect?.value || '';
            const governorate = governorateSelect?.value || '';
            const specialization = specializationSelect?.value || '';
            const facilityType = facilityTypeSelect?.value || '';
            const nameQuery = doctorNameInput?.value.toLowerCase().trim() || '';

             // console.log(`Searching with (initial=${isInitial}, scroll=${triggerScroll}):`, { province, governorate, specialization, facilityType, nameQuery }); // DEBUG

             // Use requestAnimationFrame to ensure UI updates before heavy lifting
            requestAnimationFrame(() => {
                 let filteredDoctors = [];
                 try {
                     // --- Filtering Logic ---
                     filteredDoctors = allDoctorsData.filter(doctor => {
                         if (!doctor) return false; // Skip null/undefined entries

                          // Use optional chaining and provide default empty strings for safe comparison
                         const dProvince = doctor.province || '';
                         const dGov = doctor.governorate || '';
                         const dSpec = doctor.specialization || '';
                         const dFac = doctor.facility_type || '';
                         const dName = (doctor.name || '').toLowerCase();
                         const dClinic = (doctor.plc || '').toLowerCase();

                         const provMatch = !province || dProvince === province;
                         const govMatch = !governorate || dGov === governorate;
                         const specMatch = !specialization || dSpec === specialization;
                         const facMatch = !facilityType || dFac === facilityType;
                         // Name query matches doctor name OR clinic/PLC name
                         const nameMatch = !nameQuery || dName.includes(nameQuery) || dClinic.includes(nameQuery);

                         return provMatch && govMatch && specMatch && facMatch && nameMatch;
                     });

                      // console.log("Found doctors after filter:", filteredDoctors.length); // DEBUG
                     displayResults(filteredDoctors); // Pass filtered list

                 } catch (error) {
                     console.error("Error during doctor filtering or display:", error);
                     // Display an error message to the user if desired
                      if(resultsContainer) resultsContainer.innerHTML = '<p style="color: var(--error); text-align: center; padding: 2rem;">An error occurred while searching. Please try again.</p>';
                      if(noResultsMessage) noResultsMessage.style.display = 'none';
                      if(resultsTitle) resultsTitle.style.display = 'none';
                 } finally {
                     // --- FIX: Re-enable buttons REGARDLESS of errors ---
                      // console.log("Re-enabling buttons..."); // DEBUG
                     if (searchButton) { searchButton.innerHTML = '<i class="fas fa-search"></i> Find Care'; searchButton.disabled = false; }
                     if (clearFiltersButton) clearFiltersButton.disabled = false;

                     // --- Conditional Scroll to Results ---
                     if (!isInitialLoadSearch && triggerScroll && filteredDoctors.length > 0 && resultsSection) {
                          // console.log("Scrolling to results triggered..."); // DEBUG
                         setTimeout(() => { resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start', inline: 'nearest' }); }, 150);
                     } else if (!isInitialLoadSearch && triggerScroll && filteredDoctors.length === 0 && noResultsMessage) {
                          // console.log("Scrolling to 'No Results' triggered..."); // DEBUG
                         setTimeout(() => { noResultsMessage.scrollIntoView({ behavior: 'smooth', block: 'center' }); }, 150);
                     }
                 }
                  isInitialLoadSearch = false; // Mark subsequent searches as not initial
            });
        }


        // --- Clear All Search Filters ---
        function clearAllFilters() {
            // console.log("Clearing all search filters."); // DEBUG
            if (provinceSelect) provinceSelect.value = ''; if (governorateSelect) governorateSelect.value = ''; if (specializationSelect) specializationSelect.value = ''; if (facilityTypeSelect) facilityTypeSelect.value = ''; if (doctorNameInput) doctorNameInput.value = '';
            currentSelectedFacilityType = null; currentSelectedPlcName = null;
            updateCardSelection(null, 'facility-type-card'); updateCardSelection(null, 'plc-card');
            filterPlcCardsByFacilityType(null); // Show all PLC cards
            searchDoctors(null, false, false); // Trigger search, NO SCROLL
             const searchArea = document.getElementById('search-section');
             // Scroll back to search area gently
             if(searchArea) { setTimeout(() => { searchArea.scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 50); }
        }


        // --- Star Rating HTML Generator ---
        function getStarsHTML(rating) {
             // console.log("getStarsHTML called with rating:", rating, typeof rating); // DEBUG
            if (rating === null || typeof rating !== 'number' || isNaN(rating) || rating < 0 || rating > 5) {
                 // console.log("Invalid rating, returning default stars."); // DEBUG
                 return '<span class="stars" title="No rating yet"><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i></span>';
            }
            const safeRating = Math.max(0, Math.min(5, rating));
            const full = Math.floor(safeRating);
            const half = (safeRating - full) >= 0.4 ? 1 : 0; // Use 0.4 threshold for half star visibility
            const empty = 5 - full - half;
            let html = `<span class="stars" title="${safeRating.toFixed(1)}/5 Stars">`;
            html += '<i class="fas fa-star"></i>'.repeat(full);
            html += half ? '<i class="fas fa-star-half-alt"></i>' : '';
            html += '<i class="far fa-star"></i>'.repeat(empty);
            html += '</span>';
             // console.log("Generated stars HTML:", html); // DEBUG
            return html;
        }


        // --- Display Search Results ---
        function displayResults(doctors) {
            // console.log("Starting displayResults with doctors:", doctors); // DEBUG
            if (!resultsContainer || !noResultsMessage || !resultsTitle) {
                console.error("Missing display elements for results (resultsContainer, noResultsMessage, or resultsTitle).");
                return;
            }

            resultsContainer.innerHTML = ''; // Clear previous results immediately
            resultsContainer.style.opacity = '0'; // Prepare for fade-in

            // Sort doctors by average rating (descending), handle null/undefined ratings
            const sortedDoctors = [...doctors].sort((a, b) => {
                const ratingA = (a?.average_rating === null || a?.average_rating === undefined || isNaN(a.average_rating)) ? -1 : a.average_rating;
                const ratingB = (b?.average_rating === null || b?.average_rating === undefined || isNaN(b.average_rating)) ? -1 : b.average_rating;
                // Sort higher ratings first
                return ratingB - ratingA;
            });
            // console.log("Sorted doctors:", sortedDoctors); // DEBUG

            if (sortedDoctors.length === 0) {
                noResultsMessage.style.display = 'block';
                resultsContainer.style.display = 'none'; // Hide grid container
                resultsTitle.style.display = 'none';
                // console.log("Displaying 'No Results' message."); // DEBUG
            } else {
                noResultsMessage.style.display = 'none';
                resultsContainer.style.display = 'grid'; // Ensure grid is visible
                resultsTitle.style.display = 'block';
                resultsTitle.textContent = `Found ${sortedDoctors.length} Doctor${sortedDoctors.length !== 1 ? 's' : ''}`;
                // console.log(`Displaying ${sortedDoctors.length} doctor cards.`); // DEBUG

                sortedDoctors.forEach((doctor, index) => {
                    if (!doctor || !doctor.id) {
                        // console.warn("Skipping invalid doctor object:", doctor); // DEBUG
                        return; // Skip invalid doctor objects
                    }
                    const card = document.createElement('div');
                    card.className = 'doctor-card reveal-on-scroll';
                    // Apply staggered animation delay
                    card.style.animationDelay = `${index * STAGGER_BASE_DELAY}ms`;

                    // --- Safely access properties using optional chaining and defaults ---
                    const photoUrl = doctor.photo || `https://ui-avatars.com/api/?name=${encodeURIComponent(doctor.name || 'Doctor')}&background=e0f2f2&color=005f5f&size=150`;
                    const name = doctor.name || 'Doctor Name Unavailable';
                    const spec = doctor.specialization || 'General Practice';
                    const ratingValue = doctor.average_rating; // Keep as potentially number/null/undefined
                    const reviewCount = doctor.review_count || 0;
                    const prov = doctor.province || '';
                    const gov = doctor.governorate || '';
                    const facType = doctor.facility_type || 'N/A';
                    const avail = doctor.availability1shortform || null;
                    const clinic = doctor.plc || null;
                    const bookingUrl = `/booking/${doctor.id}`;

                    // --- Generate Rating HTML ---
                    let ratingHTML = '';
                    if (reviewCount > 0 && typeof ratingValue === 'number' && !isNaN(ratingValue)) {
                        ratingHTML = `<div class="rating-display">${getStarsHTML(ratingValue)} <span class="review-count">(${reviewCount} review${reviewCount !== 1 ? 's' : ''})</span></div>`;
                    } else {
                        ratingHTML = `<div class="rating-display"><span class="review-count no-reviews"><i class="far fa-star" style="color: var(--text-medium); margin-right: 4px;"></i>No reviews yet</span></div>`;
                    }

                    // --- Generate Details HTML (Left Column) ---
                    let detailsLeftHTML = `<div class="doctor-details">`;
                    if (prov || gov) {
                        detailsLeftHTML += `<p><i class="fas fa-map-marker-alt"></i> ${prov}${prov && gov ? ', ' : ''}${gov}</p>`;
                    }
                    if (clinic) {
                        detailsLeftHTML += `<p><i class="fas fa-clinic-medical"></i> ${clinic}</p>`;
                    }
                    detailsLeftHTML += `<p><i class="fas fa-hospital"></i> Facility: ${facType}</p>`;
                    detailsLeftHTML += `</div>`;

                    // --- Generate Availability HTML (Right Column) ---
                    let availabilityRightHTML = '';
                    if (avail && typeof avail === 'string' && avail.trim() !== '') {
                        const availabilityLines = avail.split(',')
                            .map(part => part.trim())
                            .filter(part => part !== '')
                            .map(part => `<p>${part}</p>`)
                            .join('');
                        if (availabilityLines) {
                            availabilityRightHTML = `<div class="availability-details"><div class="availability-title"><i class="far fa-clock"></i>Availability:</div>${availabilityLines}</div>`;
                        } else {
                            availabilityRightHTML = `<div class="availability-details"><div class="availability-title"><i class="far fa-clock"></i>Availability:</div><p>Click Book Now for details</p></div>`;
                        }
                    } else {
                        availabilityRightHTML = `<div class="availability-details"><div class="availability-title"><i class="far fa-clock"></i>Availability:</div><p>Not specified</p></div>`;
                    }

                    // --- Assemble Card HTML ---
                    card.innerHTML = `
                        <div class="doctor-card-top">
                            <img src="${photoUrl}" class="doctor-photo" alt="Photo of ${name}" loading="lazy" onerror="this.onerror=null; this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=e0f2f2&color=005f5f&size=150';">
                            <div class="doctor-primary-info">
                                <h3>${name}</h3>
                                <p class="specialization">${spec}</p>
                                ${ratingHTML}
                            </div>
                        </div>
                        <div class="doctor-info">
                            <div class="doctor-info-columns">
                                <div class="doctor-info-left">
                                    ${detailsLeftHTML}
                                </div>
                                <div class="vertical-divider"></div>
                                <div class="doctor-info-right">
                                    ${availabilityRightHTML}
                                </div>
                            </div>
                            <button class="btn btn-primary book-btn" onclick="window.location.href='${bookingUrl}'">
                                <i class="far fa-calendar-check"></i> Book Now
                            </button>
                        </div>`;

                     // console.log("Appending card for doctor:", doctor.id); // DEBUG
                    resultsContainer.appendChild(card);
                });

                 // console.log("Finished appending cards. Setting up observer and fading in."); // DEBUG
                setupScrollObserver(); // Re-setup observer for newly added cards
                setTimeout(() => { resultsContainer.style.opacity = '1'; }, 50); // Fade in results smoothly
            }
        }

        // --- Card Selection & Filtering Helpers ---
        function updateCardSelection(selectedCard, categoryClass) {
            document.querySelectorAll(`.${categoryClass}`).forEach(card => {
                card.classList.remove('card-selected');
                card.setAttribute('aria-pressed', 'false');
            });
            if (selectedCard && selectedCard.classList.contains(categoryClass)) {
                 selectedCard.classList.add('card-selected');
                 selectedCard.setAttribute('aria-pressed', 'true');
            }
        }

        function filterPlcCardsByFacilityType(selectedType) {
            const plcCards = document.querySelectorAll('.plc-card');
            let visibleCount = 0;
            plcCards.forEach(card => {
                const plcName = card.getAttribute('data-plc-name');
                if (!plcName) { card.style.display = 'none'; return; }

                // Find the facility type associated with this PLC
                const plcData = allDoctorsData.find(doc => doc?.plc === plcName);
                const plcFacType = plcData?.facility_type; // Use optional chaining

                if (!selectedType || (plcFacType && plcFacType === selectedType)) {
                     card.style.display = 'flex';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            // console.log(`Visible PLC cards for type '${selectedType || 'All'}': ${visibleCount}`); // DEBUG
        }

        // ** Facility Type Card Click: NO SCROLL **
        function setFacilityTypeFilterAndSearch(type, cardElement) {
            // console.log(`Set Facility Type: ${type}`); // DEBUG
            if (cardElement?.classList.contains('card-selected')) {
                clearFacilityTypeFilterAndSearch();
                return;
            }
            currentSelectedFacilityType = type;
            currentSelectedPlcName = null;
            updateCardSelection(cardElement, 'facility-type-card');
            updateCardSelection(null, 'plc-card');

            if (facilityTypeSelect) facilityTypeSelect.value = type;
            if (doctorNameInput) doctorNameInput.value = '';

            filterPlcCardsByFacilityType(type);
            searchDoctors(null, false, false); // Trigger search (NO SCROLL)
        }

        function clearFacilityTypeFilterAndSearch() {
             // console.log("Clear Facility Type Filter"); // DEBUG
             currentSelectedFacilityType = null;
             updateCardSelection(null, 'facility-type-card');
             if (facilityTypeSelect) facilityTypeSelect.value = "";
             filterPlcCardsByFacilityType(null);
             searchDoctors(null, false, false);
        }

        // ** PLC Card Click: SCROLL **
        function setPlcFilterAndSearch(plcName, cardElement) {
             // console.log(`Set PLC: ${plcName}`); // DEBUG
             if (!plcName || !cardElement) return;

             if (cardElement.classList.contains('card-selected')) {
                 clearPlcFilterAndSearch();
                 return;
            }

            currentSelectedPlcName = plcName;
            const plcData = allDoctorsData.find(doc => doc?.plc === plcName);
            const assocFacType = plcData?.facility_type;
            currentSelectedFacilityType = assocFacType;

            updateCardSelection(cardElement, 'plc-card');
            const facCard = assocFacType ? document.querySelector(`.facility-type-card[data-facility-type="${assocFacType}"]`) : null;
            updateCardSelection(facCard, 'facility-type-card');

             if (doctorNameInput) doctorNameInput.value = plcName;
             if (facilityTypeSelect) facilityTypeSelect.value = assocFacType || '';

             // Ensure collapsible section is open if needed
             const plcSection = cardElement.closest('.collapsible-section');
             if (plcSection && !plcSection.classList.contains('is-open')) {
                plcSection.querySelector('.collapsible-header').click();
                // Wait for animation before searching and scrolling
                setTimeout(() => {
                    searchDoctors(null, false, true); // Trigger search (WITH SCROLL)
                }, 450); // Adjust timing based on collapse speed
             } else {
                 // Already open or not in collapsible, search immediately
                 searchDoctors(null, false, true); // Trigger search (WITH SCROLL)
             }
        }

        function clearPlcFilterAndSearch() {
             // console.log("Clear PLC Filter"); // DEBUG
             currentSelectedPlcName = null;
             updateCardSelection(null, 'plc-card');

             if (doctorNameInput && allPlcs.includes(doctorNameInput.value)) {
                 doctorNameInput.value = "";
             }

             filterPlcCardsByFacilityType(currentSelectedFacilityType);
             searchDoctors(null, false, false); // Trigger search (NO SCROLL)
        }


        // --- Typing Effect ---
        const textsToType = ["Need a specialist?", "Book check-ups online.", "Access verified doctors.", "Your health, scheduled simply."]; let textIndex = 0; let charIndex = 0; let isDeleting = false; let typingTimeout; const typeSpeed = 90; const deleteSpeed = 50; const pauseBeforeDelete = 2200; const pauseBeforeType = 300;
        function type() { clearTimeout(typingTimeout); if (!textElement) return; const currentText = textsToType[textIndex]; let typeDelay; textElement.style.animationPlayState = 'paused'; if (!isDeleting) { textElement.textContent = currentText.slice(0, ++charIndex); if (charIndex === currentText.length) { isDeleting = true; typeDelay = pauseBeforeDelete; } else { typeDelay = typeSpeed + (Math.random() - 0.5) * 50; } } else { textElement.textContent = currentText.slice(0, --charIndex); if (charIndex === 0) { isDeleting = false; textIndex = (textIndex + 1) % textsToType.length; typeDelay = pauseBeforeType; } else { typeDelay = deleteSpeed; } } textElement.style.animationPlayState = 'running'; typingTimeout = setTimeout(type, typeDelay); }

        // --- Animated Counter ---
        function animateCounter(element) { if (!element) return; const targetStr = element.dataset.target; if (element.dataset.animated === 'true' || !targetStr) return; const target = parseInt(targetStr, 10); if (isNaN(target)) return; element.dataset.animated = 'true'; if (target === 0) { element.textContent = '0'; return; } let startTimestamp = null; const duration = COUNTER_ANIMATION_DURATION; const step = (timestamp) => { if (!startTimestamp) startTimestamp = timestamp; const elapsed = timestamp - startTimestamp; const progress = Math.min(elapsed / duration, 1); const easedProgress = 1 - Math.pow(1 - progress, 3); const currentValue = Math.floor(easedProgress * target); element.textContent = currentValue.toLocaleString(); if (progress < 1) { window.requestAnimationFrame(step); } else { element.textContent = target.toLocaleString(); } }; window.requestAnimationFrame(step); }

        // --- Intersection Observer ---
        function setupScrollObserver() {
            if (intersectionObserver) {
                 intersectionObserver.disconnect();
            }
            const elements = document.querySelectorAll('.reveal-on-scroll:not(.is-visible)');
            if (elements.length === 0) {
                 // console.log("Scroll Observer: No new elements to observe."); // DEBUG
                 return;
            }
             // console.log(`Scroll Observer: Setting up for ${elements.length} elements.`); // DEBUG

            const options = { root: null, threshold: 0.1, rootMargin: '0px 0px -30px 0px' };

            const callback = (entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const el = entry.target;
                        el.classList.add('is-visible');

                        if (el.classList.contains('stat-number') && el.dataset.animated !== 'true') {
                            animateCounter(el);
                        } else if (el.classList.contains('plc-card')) {
                             const img = el.querySelector('img.plc-photo');
                             const icon = el.querySelector('i.icon');
                             if (img && icon && img.style.display !== 'none' && (!img.complete || img.naturalHeight === 0 || img.naturalWidth === 0)) {
                                  // console.warn(`Image failed/not loaded: ${img.alt || 'Unknown PLC'}. Showing fallback icon.`); // DEBUG
                                 img.style.display = 'none';
                                 icon.style.display = 'flex';
                             }
                        }
                        observer.unobserve(el);
                     }
                });
            };

            intersectionObserver = new IntersectionObserver(callback, options);
            elements.forEach(el => intersectionObserver.observe(el));
        }

        // --- Initial Page Load Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // console.log("DOM Loaded. Initializing..."); // DEBUG
            // console.log("Initial allDoctorsData:", allDoctorsData); // DEBUG: Check data on load

            // Event Listeners
            if (provinceSelect) provinceSelect.addEventListener('change', (e) => searchDoctors(e, false, false));
            if (governorateSelect) governorateSelect.addEventListener('change', (e) => searchDoctors(e, false, false));
            if (specializationSelect) specializationSelect.addEventListener('change', (e) => searchDoctors(e, false, false));
            if (doctorNameInput) doctorNameInput.addEventListener('input', searchDoctorsDebounced);

            if (facilityTypeSelect) {
                facilityTypeSelect.addEventListener('change', (e) => {
                    const selectedValue = e.target.value;
                     currentSelectedFacilityType = selectedValue;
                     const matchingCard = selectedValue ? document.querySelector(`.facility-type-card[data-facility-type="${selectedValue}"]`) : null;

                    updateCardSelection(matchingCard, 'facility-type-card');
                     updateCardSelection(null, 'plc-card');
                     currentSelectedPlcName = null;

                     if (doctorNameInput && allPlcs.includes(doctorNameInput.value)) {
                        doctorNameInput.value = "";
                    }

                    filterPlcCardsByFacilityType(selectedValue);
                     searchDoctors(e, false, false); // NO SCROLL
                 });
            }

             if (doctorNameInput) {
                 doctorNameInput.addEventListener('keypress', function(event) {
                     if (event.key === 'Enter') {
                         event.preventDefault();
                         clearTimeout(searchTimeoutId);
                         searchDoctors(null, false, true); // Trigger immediate search (WITH SCROLL)
                     }
                 });
             }

            if (textElement && textsToType.length > 0) {
                 setTimeout(type, pauseBeforeType + 500);
             }

            // Handle URL Params & Initial Search/Display
            let initialSearchNeeded = true; // Assume default search is needed unless params trigger one
             try {
                 const urlParams = new URLSearchParams(window.location.search);
                 let triggeredSearchByCard = false;

                 function setDropdown(param, el, dataArray) { /* ... (no change needed here) ... */ }
                 const initProv = setDropdown('province', provinceSelect, ['Bagmati', 'Gandaki', 'Lumbini', 'Koshi', 'Madhesh', 'Sudurpashchim', 'Karnali']);
                 const initGov = setDropdown('governorate', governorateSelect, allGovernorates);
                 const initSpec = setDropdown('specialization', specializationSelect, allSpecialties);
                 let initFac = setDropdown('facility_type', facilityTypeSelect, allFacilityTypes); // Let it be mutable
                 const initName = urlParams.get('name');

                let plcSetFromUrl = false;

                // Priority: Name matches PLC
                 if (initName && Array.isArray(allPlcs) && allPlcs.includes(initName)) {
                     const plcCard = document.querySelector(`.plc-card[data-plc-name="${initName}"]`);
                     if (plcCard) {
                         const plcSection = plcCard.closest('.collapsible-section');
                         if (plcSection && !plcSection.classList.contains('is-open')) {
                             plcSection.querySelector('.collapsible-header').click();
                         }
                         setTimeout(() => { plcCard.click(); }, 100); // Triggers setPlcFilterAndSearch (WITH SCROLL)
                         triggeredSearchByCard = true;
                         plcSetFromUrl = true;
                         initialSearchNeeded = false; // Search handled by card click
                         // console.log("URL Init: PLC card click triggered."); // DEBUG
                     }
                 }

                 // Else if Facility Type is set (and no PLC match handled it)
                 if (!triggeredSearchByCard && initFac) {
                     const facCard = document.querySelector(`.facility-type-card[data-facility-type="${initFac}"]`);
                     if (facCard) {
                        const facSection = facCard.closest('.collapsible-section');
                         if (facSection && !facSection.classList.contains('is-open')) {
                             facSection.querySelector('.collapsible-header').click();
                         }
                        setTimeout(() => { facCard.click(); }, 100); // Triggers setFacilityTypeFilterAndSearch (NO SCROLL)
                         triggeredSearchByCard = true;
                         initialSearchNeeded = false; // Search handled by card click
                         // console.log("URL Init: Facility Type card click triggered."); // DEBUG
                     } else {
                          // console.log("URL Init: Facility Type set, card not found, filtering PLCs manually."); // DEBUG
                         currentSelectedFacilityType = initFac;
                         filterPlcCardsByFacilityType(initFac);
                     }
                 }

                 // Filter PLCs if not triggered by card click but facility type was in URL
                 if (!triggeredSearchByCard) {
                      // console.log("URL Init: No card click, filtering PLCs based on URL Facility Type (if any)."); // DEBUG
                     filterPlcCardsByFacilityType(initFac);
                 }

                 // Set name input if not handled as PLC
                 if (initName && !plcSetFromUrl && doctorNameInput) {
                      // console.log("URL Init: Setting name input from URL."); // DEBUG
                     doctorNameInput.value = initName;
                 }

                 // If any dropdowns were set from URL but no card click happened, we still need an initial search
                 if (!triggeredSearchByCard && (initProv || initGov || initSpec || initFac || initName)) {
                      // console.log(`URL Init: Non-card params present, marking initial search as needed.`); // DEBUG
                     initialSearchNeeded = true;
                 }

             } catch (e) {
                 console.error("Error processing URL parameters:", e);
                 filterPlcCardsByFacilityType(null); // Reset PLC filter on error
                 initialSearchNeeded = true; // Ensure default display on error
             }

            // Perform initial search IF needed (either default or triggered by non-card URL params)
            if (initialSearchNeeded) {
                 // console.log("Performing initial search (default or from non-card URL params)."); // DEBUG
                 searchDoctors(null, true, false); // Initial display, NO SCROLL
            } else {
                 // console.log("Initial search was handled by card click simulation from URL params."); // DEBUG
             }

            // Setup Scroll Observer after initial setup/potential search
             setTimeout(() => {
                 // console.log("Setting up scroll observer..."); // DEBUG
                 setupScrollObserver();
             }, 300);

             // console.log("Initialization complete."); // DEBUG
        });
    </script>
    <!-- JavaScript End -->

</body>
</html>